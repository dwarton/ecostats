<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecostats">
<title>Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes • ecostats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes">
<meta property="og:description" content="ecostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecostats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/ecostats.html">About ecostats</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Chapter Solutions</h6>
    <a class="dropdown-item" href="../articles/Chapter1Solutions.html">Chapter 1 -- 'STATS 101' Revision -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter2Solutions.html">Chapter 2 -- An importance equivalence result -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter3Solutions.html">Chapter 3 -- Regression with multiple predictor variables -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter4Solutions.html">Chapter 4 -- Linear models -- anything goes -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter5Solutions.html">Chapter 5 -- Model selection -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter6Solutions.html">Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter7Solutions.html">Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter8Solutions.html">Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter9Solutions.html">Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter10Solutions.html">Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter11Solutions.html">Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter12Solutions.html">Chapter 12 -- Visualising many responses -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter13Solutions.html">Chapter 13 -- Allometric line-fitting -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter14Solutions.html">Chapter 14 -- Multivariate abundances -- inference about environmental associations -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter15Solutions.html">Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter16Solutions.html">Chapter 16 -- Understanding variation in environmental response across taxa -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter17Solutions.html">Chapter 17 -- Studying co-occurrence patterns -- Exercise solutions and Code Boxes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Glossary of functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dwarton/ecostats">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes</h1>
                        <h4 data-toc-skip class="author">David Warton</h4>
            
            <h4 data-toc-skip class="date">2022-08-25</h4>
      
      
      <div class="d-none name"><code>Chapter8Solutions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="code-box-8-1-fitting-a-spline-smoother-to-the-mauna-loa-annual-data-of-exercise-8-1-on-r-">Code Box 8.1: Fitting a spline smoother to the Mauna Loa annual data of Exercise 8.1 on <code>R</code>.<a class="anchor" aria-label="anchor" href="#code-box-8-1-fitting-a-spline-smoother-to-the-mauna-loa-annual-data-of-exercise-8-1-on-r-"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: nlme</span></span>
<span><span class="co">#&gt; This is mgcv 1.8-40. For overview type 'help("mgcv-package")'.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dwarton.github.io/ecostats/">ecostats</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: mvabund</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">maunaloa</span><span class="op">)</span></span>
<span><span class="va">maunaJan</span> <span class="op">=</span> <span class="va">maunaloa</span><span class="op">[</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">month</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">ft_maunagam</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, data<span class="op">=</span><span class="va">maunaJan</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_maunagam</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: gaussian </span></span>
<span><span class="co">#&gt; Link function: identity </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; co2 ~ s(year)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 356.68048    0.05378    6632   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;           edf Ref.df     F p-value    </span></span>
<span><span class="co">#&gt; s(year) 8.427  8.908 33847  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-sq.(adj) =      1   Deviance explained =  100%</span></span>
<span><span class="co">#&gt; GCV = 0.2143  Scale est. = 0.18223   n = 63</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-8-2-residual-plot-from-a-gam-of-the-annual-mauna-loa-data-of-exercise-8-1">Code Box 8.2: Residual plot from a GAM of the annual Mauna Loa data of Exercise 8.1<a class="anchor" aria-label="anchor" href="#code-box-8-2-residual-plot-from-a-gam-of-the-annual-mauna-loa-data-of-exercise-8-1"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_maunagam</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box82-1.png" width="700"><img src="Chapter8Solutions_files/figure-html/box82-2.png" width="700"></p>
<p><em>Do you think assumptions are satisfied?</em></p>
<p>It generally looks good, although there are a couple of lines of points fanning out on the residuals vs fits plot for <code>co2&lt;320</code>. (The method of taking measurements actually changed in 1974, at about <code>co2=330</code>, so it is possible that this could be artefacts due to changes in the measurement or recording process for data in the 1950’s and 1960’s.)</p>
<p>Note the simulation envelope around the trend line in the residual vs fits plot is hard to see – this is because it falls very close to the horizontal line at zero. This happens because of the way the smoother against year is fitted – it is done in such a way that the residual trend is (nearly) completely removed.</p>
</div>
<div class="section level2">
<h2 id="code-box-8-3-comparing-curves-for-the-mauna-loa-data-">Code Box 8.3: Comparing curves for the Mauna Loa data.<a class="anchor" aria-label="anchor" href="#code-box-8-3-comparing-curves-for-the-mauna-loa-data-"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maunaJan</span><span class="op">$</span><span class="va">year00</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">2000</span>,<span class="va">maunaJan</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">ft_maunaPiece</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="va">year</span><span class="op">+</span><span class="va">year00</span>,data<span class="op">=</span><span class="va">maunaJan</span><span class="op">)</span></span>
<span><span class="va">ft_maunagam20</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">year</span>,k<span class="op">=</span><span class="fl">20</span><span class="op">)</span>, data<span class="op">=</span><span class="va">maunaJan</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_maunagam20</span><span class="op">)</span><span class="op">$</span><span class="va">edf</span> <span class="co"># this gam added about 6 extra knots:</span></span>
<span><span class="co">#&gt; [1] 15.01983</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_maunaPiece</span>,<span class="va">ft_maunagam</span>,<span class="va">ft_maunagam20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     df      BIC</span></span>
<span><span class="co">#&gt; ft_maunaPiece  4.00000 252.2672</span></span>
<span><span class="co">#&gt; ft_maunagam   10.42712 104.5190</span></span>
<span><span class="co">#&gt; ft_maunagam20 17.01983 104.7728</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">isTrain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">maunaJan</span><span class="op">$</span><span class="va">year</span><span class="op">&lt;=</span><span class="fl">2006</span><span class="op">)</span></span>
<span><span class="va">datTrain</span> <span class="op">=</span> <span class="va">maunaJan</span><span class="op">[</span><span class="va">isTrain</span>,<span class="op">]</span></span>
<span><span class="va">datTest</span> <span class="op">=</span> <span class="va">maunaJan</span><span class="op">[</span><span class="op">-</span><span class="va">isTrain</span>,<span class="op">]</span></span>
<span><span class="va">ft_piece</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="va">year</span><span class="op">+</span><span class="va">year00</span>,dat<span class="op">=</span><span class="va">datTrain</span><span class="op">)</span></span>
<span><span class="va">ft_gam</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,dat<span class="op">=</span><span class="va">datTrain</span><span class="op">)</span></span>
<span><span class="va">ft_gam20</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">year</span>,k<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,dat<span class="op">=</span><span class="va">datTrain</span><span class="op">)</span></span>
<span><span class="va">pr_piece</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_piece</span>,newdata<span class="op">=</span><span class="va">datTest</span><span class="op">)</span></span>
<span><span class="va">pr_gam</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_gam</span>,newdata<span class="op">=</span><span class="va">datTest</span><span class="op">)</span></span>
<span><span class="va">pr_gam20</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_gam20</span>,newdata<span class="op">=</span><span class="va">datTest</span><span class="op">)</span></span>
<span><span class="va">preds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_piece</span>,newdata<span class="op">=</span><span class="va">datTest</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_gam</span>,newdata<span class="op">=</span><span class="va">datTest</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_gam20</span>,newdata<span class="op">=</span><span class="va">datTest</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="op">(</span><span class="va">datTest</span><span class="op">$</span><span class="va">co2</span><span class="op">-</span><span class="va">preds</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="co"># getting SS by column</span></span>
<span><span class="co">#&gt; [1] 233.36905  99.43189  15.72148</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-8-2-eucalypt-richness-as-a-function-of-the-environment">Exercise 8.2: Eucalypt richness as a function of the environment<a class="anchor" aria-label="anchor" href="#exercise-8-2-eucalypt-richness-as-a-function-of-the-environment"></a>
</h2>
<p><em>How does  species richness vary from one area to the next, and what are the main environmental correlates of richness? [Ian] thinks species richness could respond to temperature and rainfall in a non-linear fashion, and may interact. What sort of model should Ian consider using?</em></p>
<p>He could try a GAM, as in Code Box 8.4. Note that this doesn’t allow him to account for spatial autocorrelation at the same time, maybe he could try <code>gamm</code> as a way forward.</p>
</div>
<div class="section level2">
<h2 id="code-box-8-4-handling-interactions-in-a-gam-when-modelling-ians-richness-data-as-a-function-of-minimum-temperature-and-rainfall-for-exercise-8-2">Code Box 8.4: Handling interactions in a GAM, when modelling Ian’s richness data as a function of minimum temperature and rainfall, for Exercise 8.2<a class="anchor" aria-label="anchor" href="#code-box-8-4-handling-interactions-in-a-gam-when-modelling-ians-richness-data-as-a-function-of-minimum-temperature-and-rainfall-for-exercise-8-2"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="va">ft_tmprain</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">richness</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">te</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,<span class="va">RAIN_ANN</span><span class="op">)</span>,data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/vis.gam.html" class="external-link">vis.gam</a></span><span class="op">(</span><span class="va">ft_tmprain</span>,theta<span class="op">=</span><span class="op">-</span><span class="fl">135</span><span class="op">)</span> <span class="co">#rotating the plot to find a nice view</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box84-1.png" width="576"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_tmprain</span><span class="op">)</span><span class="op">$</span><span class="va">edf</span></span>
<span><span class="co">#&gt; [1] 14.89171</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_tmprain2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">richness</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">TMP_MIN</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">RAIN_ANN</span><span class="op">)</span><span class="op">+</span><span class="va">TMP_MIN</span><span class="op">*</span><span class="va">RAIN_ANN</span>,</span>
<span>      data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_tmprain2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: gaussian </span></span>
<span><span class="co">#&gt; Link function: identity </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; log(richness + 1) ~ s(TMP_MIN) + s(RAIN_ANN) + TMP_MIN * RAIN_ANN</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;                   Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)      6.970e-02  3.268e-02   2.133   0.0332 *  </span></span>
<span><span class="co">#&gt; TMP_MIN          2.045e-02  7.029e-02   0.291   0.7712    </span></span>
<span><span class="co">#&gt; RAIN_ANN         1.333e-03  1.501e-04   8.883   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; TMP_MIN:RAIN_ANN 1.415e-05  4.060e-05   0.348   0.7276    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;               edf Ref.df     F p-value    </span></span>
<span><span class="co">#&gt; s(TMP_MIN)  3.945  5.054 2.838  0.0145 *  </span></span>
<span><span class="co">#&gt; s(RAIN_ANN) 5.295  6.459 9.695  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank: 20/22</span></span>
<span><span class="co">#&gt; R-sq.(adj) =   0.12   Deviance explained = 12.9%</span></span>
<span><span class="co">#&gt; GCV = 0.15261  Scale est. = 0.15076   n = 1000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-8-3-smoothers-for-climate-effects-on-plant-height">Exercise 8.3: Smoothers for climate effects on plant height<a class="anchor" aria-label="anchor" href="#exercise-8-3-smoothers-for-climate-effects-on-plant-height"></a>
</h2>
<p><em>[Angela] would like to know how plant height relates to climate – in particular, are there interactions between predictors, and is the relationship non-linear?</em></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_1temprain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">temp</span><span class="op">+</span><span class="va">rain</span>, dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span> <span class="co">#linear model</span></span>
<span><span class="va">ft_2tempPlusrain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">temp</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">rain</span>,<span class="fl">2</span><span class="op">)</span>, dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span> <span class="co">#quadratic, no interaction</span></span>
<span><span class="va">ft_2temprain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">temp</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">rain</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="va">rain</span><span class="op">:</span><span class="va">temp</span>, dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span> <span class="co">#quadratic, interactions</span></span>
<span><span class="va">ft_stempPlusrain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">rain</span><span class="op">)</span>, dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span> <span class="co">#smoother+no interaction</span></span>
<span><span class="va">ft_stemprain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">rain</span><span class="op">)</span><span class="op">+</span><span class="va">rain</span><span class="op">:</span><span class="va">temp</span>, dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span> <span class="co">#smoother+interaction</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_1temprain</span>,<span class="va">ft_2tempPlusrain</span>,<span class="va">ft_2temprain</span>,<span class="va">ft_stempPlusrain</span>,<span class="va">ft_stemprain</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        df      BIC</span></span>
<span><span class="co">#&gt; ft_1temprain     4.000000 482.6809</span></span>
<span><span class="co">#&gt; ft_2tempPlusrain 6.000000 489.5603</span></span>
<span><span class="co">#&gt; ft_2temprain     7.000000 494.0549</span></span>
<span><span class="co">#&gt; ft_stempPlusrain 4.495239 483.6918</span></span>
<span><span class="co">#&gt; ft_stemprain     5.000000 484.6240</span></span></code></pre></div>
<p>And the winner is a linear model.</p>
</div>
<div class="section level2">
<h2 id="code-box-8-5-residual-plot-with-a-smoother-to-diagnose-a-model-">Code Box 8.5: Residual plot with a smoother to diagnose a model.<a class="anchor" aria-label="anchor" href="#code-box-8-5-residual-plot-with-a-smoother-to-diagnose-a-model-"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span><span class="va">globalPlants</span><span class="op">$</span><span class="va">logHt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">$</span><span class="va">height</span><span class="op">)</span></span>
<span><span class="va">ft_heightlm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logHt</span><span class="op">~</span><span class="va">lat</span>,dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ft_heightlm</span>,which<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box85-1.png" width="480"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_temp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">logHt</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>, dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span><span class="fu">ecostats</span><span class="fu">::</span><span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_temp</span>, which<span class="op">=</span><span class="fl">1</span>, main<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box85-2.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="exercise-8-4-nonlinear-predictors-of-species-richness">Exercise 8.4: Nonlinear predictors of species richness?<a class="anchor" aria-label="anchor" href="#exercise-8-4-nonlinear-predictors-of-species-richness"></a>
</h2>
<p><em>Refit the model using smoothers for each environmental variable and compare to a model with additive quadratic terms (assume conditional independence for the moment).</em></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">logrich</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">richness</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">ft_richAdd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="va">ft_richSmooth</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">TMP_MAX</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">TMP_MIN</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">RAIN_ANN</span><span class="op">)</span>,</span>
<span>                    data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_richAdd</span>,<span class="va">ft_richSmooth</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     df      BIC</span></span>
<span><span class="co">#&gt; ft_richAdd    16.00000 1002.806</span></span>
<span><span class="co">#&gt; ft_richSmooth 21.89962 1013.921</span></span></code></pre></div>
<p>It looks like the model with additive terms is a better fit.</p>
<p><em>We could try refitting the model to account for this, using the <code>gamm</code> function in the <code>mgcv</code> package. Do you think this would make any difference to our conclusion? Justify your argument.</em></p>
<p>I’m not going to try refitting, I don’t think it would make any difference. The main thing that happens if you have spatial structure in your data that you haven’t accounted for is that you get <em>false confidence</em>: standard errors and <em>P</em>-values are too small. In a model selection context, this means that you can end up saying terms should be in the model that you don’t actually need in there, so you end up with an overly complicated model. But in this case, we have already concluded that we don’t need the more complicated model, with the extra smoother terms in it.</p>
</div>
<div class="section level2">
<h2 id="exercise-8-5-carbon-dioxide-measurements-at-mauna-loa-observatory">Exercise 8.5: Carbon dioxide measurements at Mauna Loa observatory<a class="anchor" aria-label="anchor" href="#exercise-8-5-carbon-dioxide-measurements-at-mauna-loa-observatory"></a>
</h2>
<p><em>We would like to model the dataset to characterise the key trends within as well as across years, taking into account that carbon dioxide does not follow a linear trend over time, and that there is a periodic seasonal oscillation… What sort of model would you use?</em></p>
<p>We can fit an additive model with a smoother for the long-term trend, and harmonics (sin/cos terms) for the seasonal trend.</p>
</div>
<div class="section level2">
<h2 id="code-box-8-6-a-simple-model-for-the-mauna-loa-monthly-data-with-a-cyclical-predictor">Code Box 8.6: A simple model for the Mauna Loa monthly data with a cyclical predictor<a class="anchor" aria-label="anchor" href="#code-box-8-6-a-simple-model-for-the-mauna-loa-monthly-data-with-a-cyclical-predictor"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">maunaloa</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="va">ft_cyclic</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">DateNum</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>,</span>
<span>  data<span class="op">=</span><span class="va">maunaloa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">co2</span><span class="op">~</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">Date</span>,type<span class="op">=</span><span class="st">"l"</span>,</span>
<span>  ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">CO</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">"Time"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_cyclic</span><span class="op">)</span><span class="op">~</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">Date</span>,type<span class="op">=</span><span class="st">"l"</span>,col<span class="op">=</span><span class="st">"red"</span>,lwd<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box86-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="code-box-8-7-residual-plots-across-time-and-season-for-the-mauna-loa-monthly-data">Code Box 8.7: Residual plots across time and season for the Mauna Loa monthly data<a class="anchor" aria-label="anchor" href="#code-box-8-7-residual-plots-across-time-and-season-for-the-mauna-loa-monthly-data"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_cyclic</span><span class="op">)</span><span class="op">~</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">Date</span>,type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"Time"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_cyclic</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>,</span>
<span>       type<span class="op">=</span><span class="st">"l"</span>,xlab<span class="op">=</span><span class="st">"Season"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box87-1.png" width="864"></p>
<p>Here is some code to produce a simulated dataset from this model, for comparison:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maunaloa</span><span class="op">$</span><span class="va">simCO2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">ft_cyclic</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ft_simCyclic</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">simCO2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">DateNum</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>,</span>
<span>  data<span class="op">=</span><span class="va">maunaloa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_simCyclic</span><span class="op">)</span><span class="op">~</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">Date</span>,type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"Time"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_simCyclic</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>,</span>
<span>       type<span class="op">=</span><span class="st">"l"</span>,xlab<span class="op">=</span><span class="st">"Season"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box87%20sim-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="code-box-8-8-another-model-for-the-mauna-loa-monthly-data-with-an-extra-sine-curve-in-there-to-better-handle-irregularities-in-the-seasonal-effect">Code Box 8.8: Another model for the Mauna Loa monthly data, with an extra sine curve in there to better handle irregularities in the seasonal effect}<a class="anchor" aria-label="anchor" href="#code-box-8-8-another-model-for-the-mauna-loa-monthly-data-with-an-extra-sine-curve-in-there-to-better-handle-irregularities-in-the-seasonal-effect"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_cyclic2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">DateNum</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>,data<span class="op">=</span><span class="va">maunaloa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_cyclic2</span><span class="op">)</span><span class="op">~</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">Date</span>,type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"Time"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_cyclic2</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>,</span>
<span>       type<span class="op">=</span><span class="st">"l"</span>,xlab<span class="op">=</span><span class="st">"Season"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box88-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="code-box-8-9-mauna-loa-model-with-autocorrelation">Code Box 8.9: Mauna Loa model with autocorrelation}<a class="anchor" aria-label="anchor" href="#code-box-8-9-mauna-loa-model-with-autocorrelation"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_gamm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">gamm</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">DateNum</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>,correlation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/corAR1.html" class="external-link">corAR1</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                data<span class="op">=</span><span class="va">maunaloa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_gamm</span><span class="op">$</span><span class="va">gam</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box89-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_gamm</span><span class="op">$</span><span class="va">lme</span>,type<span class="op">=</span><span class="st">"normalized"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/box89-2.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="exercise-8-6-mauna-loa-monthly-data-an-extra-term-in-seasonal-trend">Exercise 8.6: Mauna Loa monthly data – an extra term in seasonal trend?<a class="anchor" aria-label="anchor" href="#exercise-8-6-mauna-loa-monthly-data-an-extra-term-in-seasonal-trend"></a>
</h2>
<p><em>We tried modelling the trend by fitting sine curves with two frequencies… Is this sufficient, or should we add another frequency too, like <code>month/12*6*pi</code> (for curves with three cycles a year)?</em></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_cyclic3</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">DateNum</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span> <span class="op">+</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">6</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">6</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>, data<span class="op">=</span><span class="va">maunaloa</span><span class="op">)</span></span>
<span><span class="va">ft_cyclic4</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">DateNum</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span> <span class="op">+</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">6</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">6</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">8</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">8</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>, data<span class="op">=</span><span class="va">maunaloa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_cyclic4</span><span class="op">)</span><span class="op">~</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">Date</span>,type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"Time"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_cyclic4</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span>,</span>
<span>       type<span class="op">=</span><span class="st">"l"</span>,xlab<span class="op">=</span><span class="st">"Season"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/ex86-1.png" width="864"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_cyclic</span>,<span class="va">ft_cyclic2</span>,<span class="va">ft_cyclic3</span>,<span class="va">ft_cyclic4</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  df      BIC</span></span>
<span><span class="co">#&gt; ft_cyclic  12.85033 1773.254</span></span>
<span><span class="co">#&gt; ft_cyclic2 14.93624 1135.151</span></span>
<span><span class="co">#&gt; ft_cyclic3 16.93686 1138.438</span></span>
<span><span class="co">#&gt; ft_cyclic4 18.93753 1141.922</span></span></code></pre></div>
<p>According to BIC, 2 harmonics is the winner, there isn’t much to gain from adding a third or fourth.</p>
</div>
<div class="section level2">
<h2 id="exercise-8-7-mauna-loa-annual-data-temporal-autocorrelation">Exercise 8.7: Mauna Loa annual data – temporal autocorrelation?}<a class="anchor" aria-label="anchor" href="#exercise-8-7-mauna-loa-annual-data-temporal-autocorrelation"></a>
</h2>
<p><em>Consider the annual Mauna Loa monthly data of Code Box 8.1, which uses the measurements from January only… Is there evidence of temporal autocorrelation in this dataset?</em></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maunaJan</span> <span class="op">=</span> <span class="va">maunaloa</span><span class="op">[</span><span class="va">maunaloa</span><span class="op">$</span><span class="va">month</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">ft_gammJan</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">gamm</a></span><span class="op">(</span><span class="va">co2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,correlation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/corAR1.html" class="external-link">corAR1</a></span><span class="op">(</span><span class="op">)</span>, data<span class="op">=</span><span class="va">maunaJan</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_gammJan</span><span class="op">$</span><span class="va">gam</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/ex87-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_gammJan</span><span class="op">$</span><span class="va">lme</span>,type<span class="op">=</span><span class="st">"normalized"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter8Solutions_files/figure-html/ex87-2.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_gammJan</span><span class="op">$</span><span class="va">lme</span></span>
<span><span class="co">#&gt; Linear mixed-effects model fit by maximum likelihood</span></span>
<span><span class="co">#&gt;   Data: strip.offset(mf) </span></span>
<span><span class="co">#&gt;   Log-likelihood: -51.70909</span></span>
<span><span class="co">#&gt;   Fixed: y ~ X - 1 </span></span>
<span><span class="co">#&gt; X(Intercept)  Xs(year)Fx1 </span></span>
<span><span class="co">#&gt;     356.6783      29.9981 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Formula: ~Xr - 1 | g</span></span>
<span><span class="co">#&gt;  Structure: pdIdnot</span></span>
<span><span class="co">#&gt;              Xr1      Xr2      Xr3      Xr4      Xr5      Xr6      Xr7      Xr8</span></span>
<span><span class="co">#&gt; StdDev: 14.15851 14.15851 14.15851 14.15851 14.15851 14.15851 14.15851 14.15851</span></span>
<span><span class="co">#&gt;          Residual</span></span>
<span><span class="co">#&gt; StdDev: 0.4428823</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation Structure: AR(1)</span></span>
<span><span class="co">#&gt;  Formula: ~1 | g </span></span>
<span><span class="co">#&gt;  Parameter estimate(s):</span></span>
<span><span class="co">#&gt;       Phi </span></span>
<span><span class="co">#&gt; 0.2638297 </span></span>
<span><span class="co">#&gt; Number of Observations: 63</span></span>
<span><span class="co">#&gt; Number of Groups: 1</span></span></code></pre></div>
<p>There isn’t really an autocorrelation signal here – the lags represent years now rather than months, and consecutive years (lag 1) have a correlation of less than 0.1 so it looks like not much is happening. The mixed effects model doesn’t really do much here. The estimated autocorrelation is surprisingly large given this (0.26) but it is much smaller than in the monthly analysis (0.76) and decays to negligible levels quickly (correlation at two years is 0.26^2=0.07).</p>
</div>
<div class="section level2">
<h2 id="exercise-8-8-aspect-as-a-predictor-of-species-richness">Exercise 8.8: Aspect as a predictor of species richness<a class="anchor" aria-label="anchor" href="#exercise-8-8-aspect-as-a-predictor-of-species-richness"></a>
</h2>
<p><em>Consider Ian’s species richness data… How would you enter <code>aspect</code> into the model?</em> This is a cyclical variable so we would add <code>cos</code> and <code>sin</code> terms to the model.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">aspect</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">#&gt;   0.0652  91.0725 176.0736 181.5191 271.8024 359.8948</span></span></code></pre></div>
<p>It seems to have been entered in degrees so has period 360. Maybe we can consider two harmonics to try to account for non-sinusoidal response. We will keep soil, temperature and rainfall variables from previously:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">logrich</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">richness</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">ft_richAsp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span><span class="op">)</span>,</span>
<span>     data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="va">ft_richAdd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_richAsp</span>,<span class="va">ft_richAdd</span><span class="op">)</span></span>
<span><span class="co">#&gt;            df      BIC</span></span>
<span><span class="co">#&gt; ft_richAsp 20 1026.860</span></span>
<span><span class="co">#&gt; ft_richAdd 16 1002.806</span></span></code></pre></div>
<p>It looks like there isn’t really an <code>aspect</code> signal in the data, BIC is much smaller without any aspect terms being in the model.</p>
<p><em>Recall that species richness had some spatial structure to it. Refit the model using the <code>gls</code> function from the <code>nlme</code> package to account for spatially structured correlation. Did this change your inferences about <code>aspect</code> in any appreciable way?</em></p>
<p>Well it won’t change our inferences because ignoring spatial correlation risks giving you false confidence in the importance of terms, but we already decided that <code>aspect</code> is not important. But anyway. We decided last time around that an exponential model with a nugget effect did OK:</p>
<p><em>This code chunk is not run, because it will take several minutes:</em></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span></span>
<span><span class="va">ft_richNugg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html" class="external-link">gls</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,data<span class="op">=</span><span class="va">Myrtaceae</span>,</span>
<span>         correlation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/corExp.html" class="external-link">corExp</a></span><span class="op">(</span>form<span class="op">=</span><span class="op">~</span><span class="va">X</span><span class="op">+</span><span class="va">Y</span>,nugget<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ft_richAspNugg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html" class="external-link">gls</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span><span class="op">)</span>,data<span class="op">=</span><span class="va">Myrtaceae</span>,</span>
<span>         correlation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/corExp.html" class="external-link">corExp</a></span><span class="op">(</span>form<span class="op">=</span><span class="op">~</span><span class="va">X</span><span class="op">+</span><span class="va">Y</span>,nugget<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_richNugg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_richAspNugg</span><span class="op">)</span></span></code></pre></div>
<p>As expected, this did not change inference in any appreciable way!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
