<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecostats">
<title>Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes • ecostats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes">
<meta property="og:description" content="ecostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecostats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/ecostats.html">About ecostats</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Chapter Solutions</h6>
    <a class="dropdown-item" href="../articles/Chapter1Solutions.html">Chapter 1 -- 'STATS 101' Revision -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter2Solutions.html">Chapter 2 -- An importance equivalence result -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter3Solutions.html">Chapter 3 -- Regression with multiple predictor variables -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter4Solutions.html">Chapter 4 -- Linear models -- anything goes -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter5Solutions.html">Chapter 5 -- Model selection -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter6Solutions.html">Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter7Solutions.html">Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter8Solutions.html">Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter9Solutions.html">Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter10Solutions.html">Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter11Solutions.html">Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter12Solutions.html">Chapter 12 -- Visualising many responses -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter13Solutions.html">Chapter 13 -- Allometric line-fitting -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter14Solutions.html">Chapter 14 -- Multivariate abundances -- inference about environmental associations -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter15Solutions.html">Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter16Solutions.html">Chapter 16 -- Understanding variation in environmental response across taxa -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter17Solutions.html">Chapter 17 -- Studying co-occurrence patterns -- Exercise solutions and Code Boxes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Glossary of functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dwarton/ecostats">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes</h1>
                        <h4 data-toc-skip class="author">David Warton</h4>
            
            <h4 data-toc-skip class="date">2022-08-24</h4>
      
      
      <div class="d-none name"><code>Chapter9Solutions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="exercise-9-1-smoking-in-pregnancy">Exercise 9.1: Smoking in pregnancy<a class="anchor" aria-label="anchor" href="#exercise-9-1-smoking-in-pregnancy"></a>
</h2>
<p><em>Consider again the guinea pig experiment… How can we make inferences about the treatment effect, without assuming normality?</em></p>
<p>Design-based inference allows us to relax distributional assumptions. Specifically, if we use a permutation test as in Code Box 9.1, or a bootstrap test as in Code Box 9.3, we do not assume normality.</p>
</div>
<div class="section level2">
<h2 id="exercise-9-2-three-example-permutations-of-treatment-labels-in-the-guinea-pig-data">Exercise 9.2: Three example permutations of treatment labels in the guinea pig data<a class="anchor" aria-label="anchor" href="#exercise-9-2-three-example-permutations-of-treatment-labels-in-the-guinea-pig-data"></a>
</h2>
<p><em>Does the observed statistic of 2.67 seem large compared to these values? What does this tell you?</em></p>
<p>The three statistics obtained by permuting data were 0.76, -2.09 and -1.08. These are all smaller than 2.67, suggesting that 2.67 is unusually large compared to what we would expect if there were no treatment effect. However, to say something more precise about how unusual this is we should do many more permutations…</p>
</div>
<div class="section level2">
<h2 id="code-behind-figure-9-1">Code behind Figure 9.1<a class="anchor" aria-label="anchor" href="#code-behind-figure-9-1"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dwarton.github.io/ecostats/">ecostats</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">guineapig</span><span class="op">)</span></span>
<span><span class="va">ft_guinea</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">errors</span><span class="op">~</span><span class="va">treatment</span>,data<span class="op">=</span><span class="va">guineapig</span><span class="op">)</span></span>
<span><span class="va">tObs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_guinea</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="co">#store observed t-statistic</span></span>
<span></span>
<span><span class="va">nPerm</span> <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="va">tStats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">nPerm</span><span class="op">)</span></span>
<span><span class="va">tStats</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">tObs</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">iPerm</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">nPerm</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">guineapig</span><span class="op">$</span><span class="va">treatPerm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">guineapig</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span> <span class="co">#permute treatment labels</span></span>
<span>  <span class="va">ft_guineaPerm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">errors</span><span class="op">~</span><span class="va">treatPerm</span>,data<span class="op">=</span><span class="va">guineapig</span><span class="op">)</span> <span class="co">#re-fit model</span></span>
<span>  <span class="va">tStats</span><span class="op">[</span><span class="va">iPerm</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_guineaPerm</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="co">#store t-stat</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1.2</span>,lwd<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">tStats</span>,main<span class="op">=</span><span class="st">"Null distribution of t under permutation"</span>,xlab<span class="op">=</span><span class="st">"t"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">tObs</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="co">#put a red line on plot for observed t-stat</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/fig91-1.png" alt=""><p class="caption">plot of chunk fig91</p>
</div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span> <span class="va">tStats</span> <span class="op">&gt;=</span> <span class="va">tObs</span> <span class="op">)</span> <span class="co">#compute P-value</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.01</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-9-1-a-permutation-test-for-the-guinea-pig-data-using-mvabund">Code Box 9.1: A permutation test for the guinea pig data using <code>mvabund</code><a class="anchor" aria-label="anchor" href="#code-box-9-1-a-permutation-test-for-the-guinea-pig-data-using-mvabund"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">guineapig</span><span class="op">)</span></span>
<span><span class="va">ft_guinea</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">errors</span><span class="op">~</span><span class="va">treatment</span>,data<span class="op">=</span><span class="va">guineapig</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_guinea</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = errors ~ treatment, data = guineapig)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;             Res.Df Df.diff val(F) Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; (Intercept)     19                        </span></span>
<span><span class="co">#&gt; treatment       18       1  7.134  0.016 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via residual (without replacement) resampling.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-9-2-permutation-test-for-a-relationship-between-latitude-and-plant-height">Code Box 9.2: Permutation test for a relationship between latitude and plant height<a class="anchor" aria-label="anchor" href="#code-box-9-2-permutation-test-for-a-relationship-between-latitude-and-plant-height"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span><span class="va">ft_height</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">height</span><span class="op">~</span><span class="va">lat</span>, data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_height</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = height ~ lat, data = globalPlants)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;             Res.Df Df.diff val(F) Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; (Intercept)    130                         </span></span>
<span><span class="co">#&gt; lat            129       1  9.271  0.007 **</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via residual (without replacement) resampling.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-9-3-using-the-mvabund-package-for-a-bootstrap-test-of-guinea-pig-data">Code Box 9.3: Using the <code>mvabund</code> package for a bootstrap test of guinea pig data<a class="anchor" aria-label="anchor" href="#code-box-9-3-using-the-mvabund-package-for-a-bootstrap-test-of-guinea-pig-data"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="va">ft_guinea</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">errors</span><span class="op">~</span><span class="va">treatment</span>, data<span class="op">=</span><span class="va">guineapig</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_guinea</span>, resamp<span class="op">=</span><span class="st">"residual"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = errors ~ treatment, data = guineapig)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;             Res.Df Df.diff val(F) Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; (Intercept)     19                        </span></span>
<span><span class="co">#&gt; treatment       18       1  7.134  0.013 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via residual resampling.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-9-3-case-resampling-in-the-guinea-pig-data">Exercise 9.3: Case resampling in the guinea pig data<a class="anchor" aria-label="anchor" href="#exercise-9-3-case-resampling-in-the-guinea-pig-data"></a>
</h2>
<p><em>We can… resample cases… Below are three examples.</em></p>
<p>C N N N C N N C N N C C N N C C N N N N 10 33 28 33 47 66 33 26 63 66 36 20 38 28 35 15 66 33 43 26</p>
<p>N N N N C N N N N N C C C C N C C C N C 33 89 34 89 35 43 38 33 23 63 10 26 11 10 43 47 10 19 66 35</p>
<p>N N C C N N N C N C N C N N N C C C C C 66 66 19 47 63 43 43 20 33 15 28 26 89 38 43 47 20 20 11 20</p>
<p><em>Count the number of Controls in each case resampled dataset. Did you get the number you expected to?</em></p>
<p>OK so the first one has 8 Control sites, second one has 9 Control sites, third has 10 Control sites. This is not expected in the sense that the original study was planned with 10 Control and 10 Treatment guinea pigs, so we have messed with the design by doing case resampling :(</p>
</div>
<div class="section level2">
<h2 id="exercise-9-4-global-plant-height-does-rainfall-explain-latitude-effect">Exercise 9.4: Global plant height – does rainfall explain latitude effect?<a class="anchor" aria-label="anchor" href="#exercise-9-4-global-plant-height-does-rainfall-explain-latitude-effect"></a>
</h2>
<p><em>She wants to know: Does latitude explain any variation in plant height beyond that due to rainfall?</em></p>
<p><em>What is the model that should be fitted under the null hypothesis? Does it include any predictor variables?</em></p>
<p>The model under the null hypothesis, as in Code Box, includes rainfall:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_heightR</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">height</span><span class="op">~</span><span class="va">rain</span>, data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span></span></code></pre></div>
<p>and we want to see if there is significant additional variation in plant height that is explained by latitude, beyond that explained by rainfall.</p>
</div>
<div class="section level2">
<h2 id="code-box-9-4-residual-resampling-using-mvabund-for-exercise-9-4-">Code Box 9.4: Residual resampling using <code>mvabund</code> for Exercise 9.4.<a class="anchor" aria-label="anchor" href="#code-box-9-4-residual-resampling-using-mvabund-for-exercise-9-4-"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_heightRL</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">height</span><span class="op">~</span><span class="va">rain</span><span class="op">+</span><span class="va">lat</span>, data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_heightRL</span>, resamp<span class="op">=</span><span class="st">"perm.resid"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = height ~ rain + lat, data = globalPlants)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;             Res.Df Df.diff val(F) Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; (Intercept)    130                         </span></span>
<span><span class="co">#&gt; rain           129       1 20.983  0.002 **</span></span>
<span><span class="co">#&gt; lat            128       1  0.429  0.515   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via residual (without replacement) resampling.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-9-5-plant-height-data-checking-assumptions">Code Box 9.5: Plant height data – checking assumptions<a class="anchor" aria-label="anchor" href="#code-box-9-5-plant-height-data-checking-assumptions"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_heightRLlm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">height</span><span class="op">~</span><span class="va">lat</span>, data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_heightRLlm</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/box95-1.png" alt="plot of chunk box95"><img src="../reference/figures/box95-2.png" alt="plot of chunk box95"></p>
<p>(Note that <code>plotenvelope</code> was run on just <code>99</code> iterations to save on compilation time)</p>
</div>
<div class="section level2">
<h2 id="exercise-9-5-plant-height-data-log-transformation">Exercise 9.5: Plant height data – log transformation<a class="anchor" aria-label="anchor" href="#exercise-9-5-plant-height-data-log-transformation"></a>
</h2>
<p>Refit the linear model to the plant height data, available as the <code>globalPlants</code> dataset in the <code>ecostats</code> package, using a log-transformation of the response. Use residual resampling to test for an effect of latitude after controlling for the effect of rainfall.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">globalPlants</span><span class="op">$</span><span class="va">loght</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">$</span><span class="va">height</span><span class="op">)</span></span>
<span><span class="va">ft_loghtRL</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">loght</span><span class="op">~</span><span class="va">rain</span><span class="op">+</span><span class="va">lat</span>, data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_loghtRL</span>, resamp<span class="op">=</span><span class="st">"perm.resid"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = loght ~ rain + lat, data = globalPlants)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;             Res.Df Df.diff val(F) Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; (Intercept)    130                         </span></span>
<span><span class="co">#&gt; rain           129       1  32.01  0.002 **</span></span>
<span><span class="co">#&gt; lat            128       1   9.62  0.002 **</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via residual (without replacement) resampling.</span></span>
<span><span class="va">ft_loghtRLlm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">loght</span><span class="op">~</span><span class="va">rain</span><span class="op">+</span><span class="va">lat</span>, data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_loghtRLlm</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ex95-1.png" alt="plot of chunk ex95"><img src="../reference/figures/ex95-2.png" alt="plot of chunk ex95"></p>
<p><em>How do results compare to the analysis without a log-transformation?</em></p>
<p>Now the test statistics are larger and more significant (which I guess because we can better see the signal in data when we are closer to satisfying our assumptions).</p>
<p><em>How do results compare to what you would have got if you used model-based inference, by applying <code>anova</code> to the <code>lm</code> function? Is this what you expected?</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_loghtRLlm</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: loght</span></span>
<span><span class="co">#&gt;            Df  Sum Sq Mean Sq F value    Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; rain        1  70.761  70.761 34.1497 3.989e-08 ***</span></span>
<span><span class="co">#&gt; lat         1  19.934  19.934  9.6203  0.002368 ** </span></span>
<span><span class="co">#&gt; Residuals 128 265.226   2.072                      </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Results are nearly identical, which is as expected, because there weren’t any violations of distributional assumptions that might have warranted resampling.</p>
</div>
<div class="section level2">
<h2 id="exercise-9-6-guinea-pig-data-log-transformation">Exercise 9.6: Guinea pig data – log transformation<a class="anchor" aria-label="anchor" href="#exercise-9-6-guinea-pig-data-log-transformation"></a>
</h2>
<p><em>Log-transform number of errors and check assumptions. Does this better satisfy assumptions than the model on untransformed data?</em></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">guineapig</span><span class="op">)</span></span>
<span><span class="va">guineapig</span><span class="op">$</span><span class="va">logErrors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">guineapig</span><span class="op">$</span><span class="va">errors</span><span class="op">)</span></span>
<span><span class="va">ft_guineaLog</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logErrors</span><span class="op">~</span><span class="va">treatment</span>,data<span class="op">=</span><span class="va">guineapig</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_guineaLog</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ex96-1.png" alt="plot of chunk ex96"><img src="../reference/figures/ex96-2.png" alt="plot of chunk ex96"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">guineapig</span><span class="op">$</span><span class="va">logErrors</span>,<span class="va">guineapig</span><span class="op">$</span><span class="va">treatment</span>,<span class="va">sd</span><span class="op">)</span></span>
<span><span class="co">#&gt; guineapig$treatment: C</span></span>
<span><span class="co">#&gt; [1] 0.521912</span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------------- </span></span>
<span><span class="co">#&gt; guineapig$treatment: N</span></span>
<span><span class="co">#&gt; [1] 0.445521</span></span></code></pre></div>
<p>This looks a <em>lot</em> better. Standard deviations are similar now, no obvious non-normal trend on quantile plot.</p>
<p><em>Repeat the permutation test of Code Box 9.2 on log-transformed data.</em></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="va">ftMany_guineaLog</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">logErrors</span><span class="op">~</span><span class="va">treatment</span>,data<span class="op">=</span><span class="va">guineapig</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ftMany_guineaLog</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = logErrors ~ treatment, data = guineapig)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;             Res.Df Df.diff val(F) Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; (Intercept)     19                         </span></span>
<span><span class="co">#&gt; treatment       18       1  9.434  0.006 **</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via residual (without replacement) resampling.</span></span></code></pre></div>
<p><em>How do results compare to the analysis without a log-transformation? Is this what you expected to happen?</em></p>
<p>Results are similar, but the test statistic is slightly larger and slightly more significant. This is expected because by fitting a model for the data that is closer to satisfying assumptions, it will work better and more clearly see any signal in the data.</p>
</div>
<div class="section level2">
<h2 id="exercise-9-7-revisiting-linear-models-past">Exercise 9.7: Revisiting linear models past<a class="anchor" aria-label="anchor" href="#exercise-9-7-revisiting-linear-models-past"></a>
</h2>
<p><em>Go back to a couple of linear models (with fixed effects terms only) you have previously fitted, e.g. in the exercises of Chapter 4, and reanalyse using (residual) resampling for inference.</em></p>
<div class="section level3">
<h3 id="repeating-exercise-4-9">Repeating Exercise 4.9:<a class="anchor" aria-label="anchor" href="#repeating-exercise-4-9"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">snowmelt</span><span class="op">)</span></span>
<span> <span class="va">snowmelt</span><span class="op">$</span><span class="va">logFlow</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">snowmelt</span><span class="op">$</span><span class="va">flow</span><span class="op">)</span></span>
<span> <span class="va">snowmelt</span><span class="op">$</span><span class="va">logFlow</span><span class="op">[</span><span class="va">snowmelt</span><span class="op">$</span><span class="va">logFlow</span><span class="op">==</span><span class="op">-</span><span class="cn">Inf</span><span class="op">]</span><span class="op">=</span><span class="cn">NA</span></span>
<span> <span class="va">snowReduced</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">snowmelt</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logFlow"</span>,<span class="st">"snow"</span>,<span class="st">"elev"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#this line not normally needed, lm can handle NA's, but seems needed because of a weird conflict with MCMCglmm code in Chapter 11 solutions</span></span>
<span> <span class="va">ft_logsnow</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logFlow</span><span class="op">~</span><span class="va">elev</span><span class="op">+</span><span class="va">snow</span>, data<span class="op">=</span><span class="va">snowReduced</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_logsnow</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ex49-1.png" alt="plot of chunk ex49"><img src="../reference/figures/ex49-2.png" alt="plot of chunk ex49"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_logsnow</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = logFlow ~ elev + snow, data = snowReduced)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -0.90161 -0.15794  0.02338  0.15834  1.08662 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  3.8805208  0.3193019  12.153  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; elev         0.0003357  0.0001226   2.739  0.00651 ** </span></span>
<span><span class="co">#&gt; snow        -0.0103172  0.0007551 -13.663  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.2909 on 316 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.3774, Adjusted R-squared:  0.3735 </span></span>
<span><span class="co">#&gt; F-statistic: 95.78 on 2 and 316 DF,  p-value: &lt; 2.2e-16</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">ft_logsnow</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     2.5 %        97.5 %</span></span>
<span><span class="co">#&gt; (Intercept)  3.252294e+00  4.5087472418</span></span>
<span><span class="co">#&gt; elev         9.457986e-05  0.0005768232</span></span>
<span><span class="co">#&gt; snow        -1.180299e-02 -0.0088315037</span></span></code></pre></div>
<p>Repeating using resampling:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="va">mft_logsnow</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">logFlow</span><span class="op">~</span><span class="va">elev</span><span class="op">+</span><span class="va">snow</span>, data<span class="op">=</span><span class="va">snowReduced</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mft_logsnow</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;             F value Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; (Intercept) 147.699  0.001 ***</span></span>
<span><span class="co">#&gt; elev          7.503  0.007 ** </span></span>
<span><span class="co">#&gt; snow        186.668  0.001 ***</span></span>
<span><span class="co">#&gt; --- </span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 </span></span>
<span><span class="co">#&gt; Arguments: with 999 resampling iterations using residual resampling and response assumed to be uncorrelated </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Hooper's R-squared: 0.3774 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Lawley-Hotelling trace statistic:  95.78, p-value: 0.001 </span></span>
<span><span class="co">#&gt; Arguments: with 999 resampling iterations using residual resampling and response assumed to be uncorrelated</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">mft_logsnow</span><span class="op">)</span></span>
<span><span class="co">#&gt;                             2.5 %        97.5 %</span></span>
<span><span class="co">#&gt; logFlow:(Intercept)  3.252294e+00  4.5087472418</span></span>
<span><span class="co">#&gt; logFlow:elev         9.457986e-05  0.0005768232</span></span>
<span><span class="co">#&gt; logFlow:snow        -1.180299e-02 -0.0088315037</span></span></code></pre></div>
<p><em>Did results work out differently? Is this what you expected? (Think about sample size and the normality assumption.)</em></p>
<p><em>P</em>-values are pretty much the same, which is expected, because we didn’t have concerns about normality and the sample size was big enough for CLT to deal with such concerns anyway.</p>
<p>The confidence intervals are identical, because they are computed in the same way irrespective of resampling.</p>
</div>
<div class="section level3">
<h3 id="now-repeating-exercise-4-10">Now repeating Exercise 4.10:<a class="anchor" aria-label="anchor" href="#now-repeating-exercise-4-10"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">aphidsBACI</span><span class="op">)</span></span>
<span><span class="va">lm_aphids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Plot</span><span class="op">+</span><span class="va">Time</span><span class="op">+</span><span class="va">Treatment</span><span class="op">:</span><span class="va">Time</span>,data<span class="op">=</span><span class="va">aphidsBACI</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">lm_aphids</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: logcount</span></span>
<span><span class="co">#&gt;                Df Sum Sq Mean Sq F value   Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; Plot            7 0.8986  0.1284  0.4603 0.833357   </span></span>
<span><span class="co">#&gt; Time            1 5.4675  5.4675 19.6038 0.004434 **</span></span>
<span><span class="co">#&gt; Time:Treatment  1 0.7397  0.7397  2.6522 0.154527   </span></span>
<span><span class="co">#&gt; Residuals       6 1.6734  0.2789                    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mlm_aphids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Plot</span><span class="op">+</span><span class="va">Time</span><span class="op">+</span><span class="va">Treatment</span><span class="op">:</span><span class="va">Time</span>,data<span class="op">=</span><span class="va">aphidsBACI</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">mlm_aphids</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = logcount ~ Plot + Time + Treatment:Time, data = aphidsBACI)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;                Res.Df Df.diff val(F) Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; (Intercept)        15                         </span></span>
<span><span class="co">#&gt; Plot                8       7  0.130  0.989   </span></span>
<span><span class="co">#&gt; Time                7       1 15.860  0.010 **</span></span>
<span><span class="co">#&gt; Time:Treatment      6       2  1.105  0.166   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via residual (without replacement) resampling.</span></span></code></pre></div>
<p>This looks fairly similar, the test statistic is a bit different (but equivalent) and significance levels generally similar. There is slightly more movement in <em>P</em>-values than last time, which may be related to the sample size being smaller (in fact the residual degrees of freedom is only <code>6</code>.)</p>
</div>
</div>
<div class="section level2">
<h2 id="code-box-9-6-block-resampling-using-mvabund-for-estuary-data">Code Box 9.6: Block resampling using <code>mvabund</code> for estuary data<a class="anchor" aria-label="anchor" href="#code-box-9-6-block-resampling-using-mvabund-for-estuary-data"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">estuaries</span><span class="op">)</span></span>
<span>  <span class="va">ft_estLM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Mod</span>,data<span class="op">=</span><span class="va">estuaries</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_estLM</span>,resamp<span class="op">=</span><span class="st">"case"</span>,block<span class="op">=</span><span class="va">estuaries</span><span class="op">$</span><span class="va">Estuary</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using block resampling...</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = Total ~ Mod, data = estuaries)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;             Res.Df Df.diff val(F) Pr(&gt;F)</span></span>
<span><span class="co">#&gt; (Intercept)     41                      </span></span>
<span><span class="co">#&gt; Mod             40       1  9.916  0.454</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via case block resampling.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-9-7-block-resampling-using-permute-for-raven-data">Code Box 9.7: Block resampling using <code>permute</code> for raven data<a class="anchor" aria-label="anchor" href="#code-box-9-7-block-resampling-using-permute-for-raven-data"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ravens</span><span class="op">)</span></span>
<span><span class="va">crowGun</span> <span class="op">=</span> <span class="va">ravens</span><span class="op">[</span><span class="va">ravens</span><span class="op">$</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="va">crowLong</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">crowGun</span>,measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before"</span>,<span class="st">"After"</span><span class="op">)</span>,</span>
<span>    variable.name<span class="op">=</span><span class="st">"time"</span>,value.name<span class="op">=</span><span class="st">"ravens"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gavinsimpson/permute" class="external-link">permute</a></span><span class="op">)</span></span>
<span><span class="va">CTRL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/permute/man/how.html" class="external-link">how</a></span><span class="op">(</span>blocks<span class="op">=</span><span class="va">crowLong</span><span class="op">$</span><span class="va">site</span><span class="op">)</span></span>
<span><span class="va">permIDs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/permute/man/shuffleSet.html" class="external-link">shuffleSet</a></span><span class="op">(</span><span class="fl">24</span>,nset<span class="op">=</span><span class="fl">999</span>,control<span class="op">=</span><span class="va">CTRL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Set of permutations &lt; 'minperm'. Generating entire set.</span></span>
<span><span class="va">ravenlm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">ravens</span><span class="op">~</span><span class="va">site</span><span class="op">+</span><span class="va">time</span>,data<span class="op">=</span><span class="va">crowLong</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ravenlm</span>,bootID<span class="op">=</span><span class="va">permIDs</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using &lt;int&gt; bootID matrix from input.</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = ravens ~ site + time, data = crowLong)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;             Res.Df Df.diff val(F) Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; (Intercept)     23                        </span></span>
<span><span class="co">#&gt; site            12      11   3.27  0.991  </span></span>
<span><span class="co">#&gt; time            11       1   6.76  0.021 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via residual (without replacement) resampling.</span></span></code></pre></div>
<p><em>How do results compare to what we got previously (Code Box 4.2), using model-based inference?</em></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ravenlm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">ravens</span><span class="op">~</span><span class="va">site</span><span class="op">+</span><span class="va">time</span>,data<span class="op">=</span><span class="va">crowLong</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ravenlm</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: ravens</span></span>
<span><span class="co">#&gt;           Df Sum Sq Mean Sq F value   Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; site      11 55.458  5.0417    4.84 0.007294 **</span></span>
<span><span class="co">#&gt; time       1  7.042  7.0417    6.76 0.024694 * </span></span>
<span><span class="co">#&gt; Residuals 11 11.458  1.0417                    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>We are getting almost the same <em>P</em>-value for the <code>time</code> effect. Interestingly, we get a very different <em>P</em>-value for the <code>site</code> effect. This is because the resampling strategy we used permuted data within sites but did not permute data across sites – this does not give a valid test for a <code>site</code> effect, hence the site <em>P</em>-value from the permutation test is not valid.</p>
</div>
<div class="section level2">
<h2 id="code-box-9-8-moving-block-bootstrap-test-for-species-richness-modelling">Code Box 9.8: Moving block bootstrap test for species richness modelling<a class="anchor" aria-label="anchor" href="#code-box-9-8-moving-block-bootstrap-test-for-species-richness-modelling"></a>
</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="co"># fit a lm:</span></span>
<span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">logrich</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">richness</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mft_richAdd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                                         data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span>                                         </span>
<span><span class="co"># construct a boot ID matrix: </span></span>
<span><span class="va">BootID</span> <span class="op">=</span> <span class="fu"><a href="../reference/BlockBootID.html">BlockBootID</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Myrtaceae</span><span class="op">$</span><span class="va">X</span>, y <span class="op">=</span> <span class="va">Myrtaceae</span><span class="op">$</span><span class="va">Y</span>, block_L <span class="op">=</span> <span class="fl">20</span>,</span>
<span>             nBoot <span class="op">=</span> <span class="fl">99</span>, Grid_space <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">mft_richAdd</span>,resamp<span class="op">=</span><span class="st">"case"</span>,bootID<span class="op">=</span><span class="va">BootID</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using &lt;int&gt; bootID matrix from input.</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: manylm(formula = logrich ~ soil + poly(TMP_MAX, degree = 2) + </span></span>
<span><span class="co">#&gt; Model:     poly(TMP_MIN, degree = 2) + poly(RAIN_ANN, degree = 2), data = Myrtaceae)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test for all response variables</span></span>
<span><span class="co">#&gt; Test statistics:</span></span>
<span><span class="co">#&gt;                            Res.Df Df.diff val(F) Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; (Intercept)                   999                         </span></span>
<span><span class="co">#&gt; soil                          991       8 11.971   0.63   </span></span>
<span><span class="co">#&gt; poly(TMP_MAX, degree = 2)     989       2 18.244   0.01 **</span></span>
<span><span class="co">#&gt; poly(TMP_MIN, degree = 2)     987       2 17.533   0.46   </span></span>
<span><span class="co">#&gt; poly(RAIN_ANN, degree = 2)    985       2  8.208   0.99   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 99 iterations via case resampling.</span></span></code></pre></div>
<p>(Note that <code>BlockBootID</code> was set to only generate <code>99</code> bootstrap samples to save on compilation time, but you should use more in practice.)</p>
<p><em>How does this compare to what you would get if you just used model-based inference, using the <code>lm</code> function?</em></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_richAdd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                                         data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_richAdd</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: logrich</span></span>
<span><span class="co">#&gt;                             Df  Sum Sq Mean Sq F value    Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; soil                         8  15.075 1.88438 12.9887 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; poly(TMP_MAX, degree = 2)    2   5.551 2.77533 19.1299 7.068e-09 ***</span></span>
<span><span class="co">#&gt; poly(TMP_MIN, degree = 2)    2   5.162 2.58082 17.7892 2.573e-08 ***</span></span>
<span><span class="co">#&gt; poly(RAIN_ANN, degree = 2)   2   2.382 1.19081  8.2081 0.0002915 ***</span></span>
<span><span class="co">#&gt; Residuals                  985 142.902 0.14508                      </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Everything is highly significant here, but much less so when using the moving block bootstrap. This is probably partly because the data are spatially autocorrelated, so we are seeing false significance in the <code>lm</code> results because dependence of observations hasn’t been accounted for. But the difference in results is quite extreme (when considering that the spatial signal wasn’t super-strong) so the moving block bootstrap maybe is being overly conservative here too.</p>
</div>
<div class="section level2">
<h2 id="code-box-9-9-moving-block-bootstrap-standard-errors-for-species-richness-predictions">Code Box 9.9: Moving block bootstrap standard errors for species richness predictions<a class="anchor" aria-label="anchor" href="#code-box-9-9-moving-block-bootstrap-standard-errors-for-species-richness-predictions"></a>
</h2>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_richAdd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>          data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span></span>
<span><span class="va">nBoot</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">BootID</span><span class="op">)</span></span>
<span><span class="va">predMat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">logrich</span><span class="op">)</span>,<span class="va">nBoot</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">iBoot</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nBoot</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>   <span class="va">ids</span> <span class="op">=</span> <span class="va">BootID</span><span class="op">[</span><span class="va">iBoot</span>,<span class="op">]</span></span>
<span>   <span class="va">ft_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">ft_richAdd</span>,data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">[</span><span class="va">ids</span>,<span class="op">]</span><span class="op">)</span></span>
<span>   <span class="va">predMat</span><span class="op">[</span><span class="va">ids</span>,<span class="va">iBoot</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_i</span><span class="op">)</span></span>
<span> <span class="op">}</span></span>
<span><span class="va">bootSEs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">predMat</span>,<span class="fl">1</span>,<span class="va">sd</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">lmSEs</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_richAdd</span>,se.fit<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">se.fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">bootSEs</span>,<span class="va">lmSEs</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;          bootSEs      lmSEs</span></span>
<span><span class="co">#&gt;  [1,] 0.04082675 0.02982530</span></span>
<span><span class="co">#&gt;  [2,] 0.03986889 0.02396074</span></span>
<span><span class="co">#&gt;  [3,] 0.04403786 0.02853756</span></span>
<span><span class="co">#&gt;  [4,] 0.05468778 0.03348368</span></span>
<span><span class="co">#&gt;  [5,] 0.06589231 0.06279115</span></span>
<span><span class="co">#&gt;  [6,] 0.03676736 0.03413518</span></span>
<span><span class="co">#&gt;  [7,] 0.05445444 0.02808283</span></span>
<span><span class="co">#&gt;  [8,] 0.07245802 0.08272950</span></span>
<span><span class="co">#&gt;  [9,] 0.03751627 0.02759009</span></span>
<span><span class="co">#&gt; [10,] 0.05979565 0.06622908</span></span></code></pre></div>
<p><em>Is this what you expected to see?</em></p>
<p>The bootstrapped standard errors account for spatial autocorrelation in the data, whereas the <code>lm</code> standard errors are not. The effect of ignoring spatial autocorrelation tends to be to have false confidence in your results – <em>P</em>-values and standard errors too small. <em>P</em>-values were too small in Code Box 9.8, and here we see standard errors tend to be too small (although a couple are bigger). On average, they are about 25% bigger (which is less than I expected given what happened to the <em>P</em>-values).</p>
</div>
<div class="section level2">
<h2 id="exercise-9-8-does-block-length-matter">Exercise 9.8: Does block length matter?<a class="anchor" aria-label="anchor" href="#exercise-9-8-does-block-length-matter"></a>
</h2>
<p><em>For Ian’s species richness data, compute standard errors using a few different block sizes (say 5km, 10km, 20km, 40km) and compare.</em></p>
<p>This will take a while to run – the first three lines will take about three times as long as the relevant line from Code Box 9.8 did :(</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootSEall</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bootSEs</span><span class="op">)</span>,<span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">block_Ls</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">bootSEall</span><span class="op">)</span><span class="op">=</span><span class="va">block_Ls</span></span>
<span><span class="va">bootSEall</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="va">bootSEs</span> <span class="co">#we already did block length 20 in Code Box 9.9</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">iLength</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">BootIDi</span> <span class="op">=</span> <span class="fu"><a href="../reference/BlockBootID.html">BlockBootID</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Myrtaceae</span><span class="op">$</span><span class="va">X</span>, y <span class="op">=</span> <span class="va">Myrtaceae</span><span class="op">$</span><span class="va">Y</span>, block_L <span class="op">=</span> <span class="va">block_Ls</span><span class="op">[</span><span class="va">iLength</span><span class="op">]</span>,</span>
<span>             nBoot <span class="op">=</span> <span class="fl">99</span>, Grid_space <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="va">predMat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">logrich</span><span class="op">)</span>,<span class="va">nBoot</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">iBoot</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nBoot</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>     <span class="va">ids</span> <span class="op">=</span> <span class="va">BootIDi</span><span class="op">[</span><span class="va">iBoot</span>,<span class="op">]</span></span>
<span>     <span class="va">ft_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">ft_richAdd</span>,data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">[</span><span class="va">ids</span>,<span class="op">]</span><span class="op">)</span></span>
<span>     <span class="va">predMat</span><span class="op">[</span><span class="va">ids</span>,<span class="va">iBoot</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_i</span><span class="op">)</span></span>
<span>   <span class="op">}</span></span>
<span>  <span class="va">bootSEall</span><span class="op">[</span>,<span class="va">iLength</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">predMat</span>,<span class="fl">1</span>,<span class="va">sd</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bootSEall</span><span class="op">)</span></span>
<span><span class="co">#&gt;               5         10         20         40</span></span>
<span><span class="co">#&gt; [1,] 0.03136087 0.03698810 0.04082675 0.03107856</span></span>
<span><span class="co">#&gt; [2,] 0.02522205 0.02535885 0.03986889 0.03010555</span></span>
<span><span class="co">#&gt; [3,] 0.03652481 0.04242889 0.04403786 0.04725079</span></span>
<span><span class="co">#&gt; [4,] 0.03222793 0.03755962 0.05468778 0.05101881</span></span>
<span><span class="co">#&gt; [5,] 0.07821894 0.08720262 0.06589231 0.07060333</span></span>
<span><span class="co">#&gt; [6,] 0.03289217 0.03984379 0.03676736 0.03969544</span></span></code></pre></div>
<p><em>Did results change, as you changed block size?</em></p>
<p>Yep, and standard errors tend to be getting a bit bigger as block size increases</p>
<p><em>Compute the mean of the standard errors at each block size. Is there a trend?</em></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bootSEall</span>,<span class="fl">2</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;          5         10         20         40 </span></span>
<span><span class="co">#&gt; 0.04553464 0.04883025 0.05420780 0.05147955</span></span></code></pre></div>
<p>The mean of the standard errors of predictions tends to be getting bigger as block size increases. This makes sense because increasing block size effectively reducing sample size, by reducng the number of units in the spatial domain that are considered as independent.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
