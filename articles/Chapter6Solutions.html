<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecostats">
<title>Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes • ecostats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes">
<meta property="og:description" content="ecostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecostats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/ecostats.html">About ecostats</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Chapter Solutions</h6>
    <a class="dropdown-item" href="../articles/Chapter1Solutions.html">Chapter 1 -- 'STATS 101' Revision -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter2Solutions.html">Chapter 2 -- An importance equivalence result -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter3Solutions.html">Chapter 3 -- Regression with multiple predictor variables -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter4Solutions.html">Chapter 4 -- Linear models -- anything goes -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter5Solutions.html">Chapter 5 -- Model selection -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter6Solutions.html">Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter7Solutions.html">Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter8Solutions.html">Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter9Solutions.html">Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter10Solutions.html">Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter11Solutions.html">Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter12Solutions.html">Chapter 12 -- Visualising many responses -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter13Solutions.html">Chapter 13 -- Allometric line-fitting -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter14Solutions.html">Chapter 14 -- Multivariate abundances -- inference about environmental associations -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter15Solutions.html">Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter16Solutions.html">Chapter 16 -- Understanding variation in environmental response across taxa -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter17Solutions.html">Chapter 17 -- Studying co-occurrence patterns -- Exercise solutions and Code Boxes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Glossary of functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dwarton/ecostats">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes</h1>
                        <h4 data-toc-skip class="author">David Warton</h4>
            
            <h4 data-toc-skip class="date">2022-08-25</h4>
      
      
      <div class="d-none name"><code>Chapter6Solutions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="exercise-6-1-effects-of-water-pollution-on-subtidal-marine-micro-invertebrates">Exercise 6.1: Effects of water pollution on subtidal marine micro-invertebrates<a class="anchor" aria-label="anchor" href="#exercise-6-1-effects-of-water-pollution-on-subtidal-marine-micro-invertebrates"></a>
</h2>
<p><em>What factors are there? Fixed or random?</em></p>
<p>He samples in seven estuaries along the New South Wales coast (three of which are “Pristine”, four are “Modified”), and in each estuary, he takes 4-7 samples and counts the creepy crawlies therein.</p>
<p><em>Modification</em> is a factor, taking levels “Pristine” and “Modified”</p>
<p><em>Estuary</em> is a factor, taking seven levels. If these were sampled randomly, and we want to make inferences across all estuaries on the New South Wales coast, it oculd be treated as a random factor.</p>
<p>The 4-7 samples at each estuary are the replicates, so they shouldn’t be added to the model, variation in replicates will enter through the error term.</p>
</div>
<div class="section level2">
<h2 id="code-for-fig-6-1">code for Fig 6.1<a class="anchor" aria-label="anchor" href="#code-for-fig-6-1"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dwarton.github.io/ecostats/">ecostats</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: mvabund</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">estuaries</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Estuary</span>,data<span class="op">=</span><span class="va">estuaries</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Modified"</span>,<span class="st">"Pristine"</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span>,pch<span class="op">=</span><span class="fl">15</span>,pt.cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter6Solutions_files/figure-html/fig6.1-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="code-box-6-1-fitting-a-linear-mixed-model-to-the-estuary-data-of-exercise-6-1">Code Box 6.1: Fitting a linear mixed model to the estuary data of Exercise 6.1<a class="anchor" aria-label="anchor" href="#code-box-6-1-fitting-a-linear-mixed-model-to-the-estuary-data-of-exercise-6-1"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dwarton.github.io/ecostats/">ecostats</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">estuaries</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="va">ft_estu</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Mod</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>,data<span class="op">=</span><span class="va">estuaries</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_estu</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: Total ~ Mod + (1 | Estuary)</span></span>
<span><span class="co">#&gt;    Data: estuaries</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 314.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.2393 -0.7569  0.1553  0.7372  1.8962 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  Estuary  (Intercept)  10.68    3.268  </span></span>
<span><span class="co">#&gt;  Residual             123.72   11.123  </span></span>
<span><span class="co">#&gt; Number of obs: 42, groups:  Estuary, 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)   39.053      3.237  12.065</span></span>
<span><span class="co">#&gt; ModPristine  -11.243      4.287  -2.622</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;             (Intr)</span></span>
<span><span class="co">#&gt; ModPristine -0.755</span></span></code></pre></div>
<p>There is some evidence of an effect of <code>Mod</code>, since the estimated coefficient is more than double its standard error (so a 95% confidence interval would not cover zero). The effect appears to be a decrease in total abundance in pristine estuaries.</p>
</div>
<div class="section level2">
<h2 id="code-box-6-2-residual-plots-from-a-mixed-model-for-exercise-6-1">Code Box 6.2: Residual plots from a mixed model for Exercise 6.1<a class="anchor" aria-label="anchor" href="#code-box-6-2-residual-plots-from-a-mixed-model-for-exercise-6-1"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ft_estu</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Mod</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>,data<span class="op">=</span><span class="va">estuaries</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html" class="external-link">scatter.smooth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_estu</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">ft_estu</span><span class="op">)</span>,</span>
<span>    xlab<span class="op">=</span><span class="st">"Fitted values"</span>,ylab<span class="op">=</span><span class="st">"Residuals"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html" class="external-link">scatter.smooth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_estu</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_estu</span>,re.form<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>    xlab<span class="op">=</span><span class="st">"Fitted values (no random effects)"</span>,ylab<span class="op">=</span><span class="st">"Residuals"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter6Solutions_files/figure-html/code62-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="code-box-6-3-using-anova-to-compare-mixed-effects-models-for-the-estuary-data">Code Box 6.3: Using <code>anova</code> to compare mixed effects models for the estuary data<a class="anchor" aria-label="anchor" href="#code-box-6-3-using-anova-to-compare-mixed-effects-models-for-the-estuary-data"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_estu</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Mod</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>,data<span class="op">=</span><span class="va">estuaries</span>,REML<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">ft_estuInt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>,data<span class="op">=</span><span class="va">estuaries</span>,REML<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_estuInt</span>,<span class="va">ft_estu</span><span class="op">)</span></span>
<span><span class="co">#&gt; Data: estuaries</span></span>
<span><span class="co">#&gt; Models:</span></span>
<span><span class="co">#&gt; ft_estuInt: Total ~ (1 | Estuary)</span></span>
<span><span class="co">#&gt; ft_estu: Total ~ Mod + (1 | Estuary)</span></span>
<span><span class="co">#&gt;            npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)  </span></span>
<span><span class="co">#&gt; ft_estuInt    3 334.18 339.39 -164.09   328.18                       </span></span>
<span><span class="co">#&gt; ft_estu       4 330.14 337.09 -161.07   322.14 6.0396  1    0.01399 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>There is some evidence of an effect of modification.</p>
</div>
<div class="section level2">
<h2 id="code-box-6-4-confidence-intervals-for-parameters-from-a-mixed-effects-model-for-the-estuary-data">Code Box 6.4: Confidence intervals for parameters from a mixed effects model for the estuary data<a class="anchor" aria-label="anchor" href="#code-box-6-4-confidence-intervals-for-parameters-from-a-mixed-effects-model-for-the-estuary-data"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">ft_estu</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computing profile confidence intervals ...</span></span>
<span><span class="co">#&gt;                  2.5 %    97.5 %</span></span>
<span><span class="co">#&gt; .sig01        0.000000  7.613337</span></span>
<span><span class="co">#&gt; .sigma        8.944066 14.084450</span></span>
<span><span class="co">#&gt; (Intercept)  32.815440 45.246159</span></span>
<span><span class="co">#&gt; ModPristine -19.461059 -2.994392</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-6-5-prediction-intervals-for-random-effects-terms-in-a-mixed-effects-model">Code Box 6.5: Prediction intervals for random effects terms in a mixed effects model<a class="anchor" aria-label="anchor" href="#code-box-6-5-prediction-intervals-for-random-effects-terms-in-a-mixed-effects-model"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rft</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">ft_estu</span>,condVar<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">dotplot</a></span><span class="op">(</span><span class="va">rft</span><span class="op">)</span></span>
<span><span class="co">#&gt; $Estuary</span></span></code></pre></div>
<p><img src="Chapter6Solutions_files/figure-html/code65-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="exercise-6-2-fitting-random-effects-with-different-variances">Exercise 6.2: Fitting random effects with different variances<a class="anchor" aria-label="anchor" href="#exercise-6-2-fitting-random-effects-with-different-variances"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estuaries</span><span class="op">$</span><span class="va">isMod</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">estuaries</span><span class="op">$</span><span class="va">Mod</span><span class="op">==</span><span class="st">"Modified"</span><span class="op">)</span></span>
<span><span class="va">estuaries</span><span class="op">$</span><span class="va">isPri</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">estuaries</span><span class="op">$</span><span class="va">Mod</span><span class="op">!=</span><span class="st">"Modified"</span><span class="op">)</span></span>
<span><span class="va">ft_estuDiff</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Mod</span><span class="op">+</span><span class="op">(</span><span class="fl">0</span><span class="op">+</span><span class="va">isMod</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="fl">0</span><span class="op">+</span><span class="va">isPri</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>,data<span class="op">=</span><span class="va">estuaries</span>,REML<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_estuDiff</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by maximum likelihood  ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: Total ~ Mod + (0 + isMod | Estuary) + (0 + isPri | Estuary)</span></span>
<span><span class="co">#&gt;    Data: estuaries</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;    331.7    340.4   -160.8    321.7       37 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.2790 -0.7211  0.2024  0.6807  1.9407 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups    Name  Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  Estuary   isMod   0.00    0.000  </span></span>
<span><span class="co">#&gt;  Estuary.1 isPri  11.39    3.375  </span></span>
<span><span class="co">#&gt;  Residual        118.84   10.901  </span></span>
<span><span class="co">#&gt; Number of obs: 42, groups:  Estuary, 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)   39.111      2.569   15.22</span></span>
<span><span class="co">#&gt; ModPristine  -11.303      3.806   -2.97</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;             (Intr)</span></span>
<span><span class="co">#&gt; ModPristine -0.675</span></span>
<span><span class="co">#&gt; optimizer (nloptwrap) convergence code: 0 (OK)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_estu</span>,<span class="va">ft_estuDiff</span><span class="op">)</span></span>
<span><span class="co">#&gt;             df      BIC</span></span>
<span><span class="co">#&gt; ft_estu      4 337.0880</span></span>
<span><span class="co">#&gt; ft_estuDiff  5 340.3501</span></span></code></pre></div>
<p>BIC suggests that we didn’t need a different variance term for each level of <code>Mod</code>. (It also estimated the cross-estuary variance to be zero for modified estuaries, leading to a warning in the output.)</p>
</div>
<div class="section level2">
<h2 id="exercise-6-3-bird-exclusion-and-biological-control">Exercise 6.3: Bird exclusion and biological control<a class="anchor" aria-label="anchor" href="#exercise-6-3-bird-exclusion-and-biological-control"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">aphidsBACI</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">aphidsBACI</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    16 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ Plot     : Factor w/ 8 levels "1","2","3","4",..: 1 2 3 4 5 6 7 8 1 2 ...</span></span>
<span><span class="co">#&gt;  $ Treatment: Factor w/ 2 levels "excluded","present": 2 2 2 2 1 1 1 1 2 2 ...</span></span>
<span><span class="co">#&gt;  $ Time     : Factor w/ 2 levels "X18.06.","X15.07.": 1 1 1 1 1 1 1 1 2 2 ...</span></span>
<span><span class="co">#&gt;  $ counts   : int  78 71 122 271 119 152 120 202 60 48 ...</span></span>
<span><span class="co">#&gt;  $ logcount : num  4.37 4.28 4.81 5.61 4.79 ...</span></span></code></pre></div>
<p>OK so we are looking for a <code>Treatment:Time</code> interaction, but to account for repeated measures of each plot, we want a random effect for <code>Plot</code> in the model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_aphids</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Time</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,data<span class="op">=</span><span class="va">aphidsBACI</span><span class="op">)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="va">ft_aphidNull</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Time</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,data<span class="op">=</span><span class="va">aphidsBACI</span><span class="op">)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_aphidNull</span>,<span class="va">ft_aphids</span><span class="op">)</span></span>
<span><span class="co">#&gt; refitting model(s) with ML (instead of REML)</span></span>
<span><span class="co">#&gt; Data: aphidsBACI</span></span>
<span><span class="co">#&gt; Models:</span></span>
<span><span class="co">#&gt; ft_aphidNull: logcount ~ Time + (1 | Plot)</span></span>
<span><span class="co">#&gt; ft_aphids: logcount ~ Treatment * Time + (1 | Plot)</span></span>
<span><span class="co">#&gt;              npar    AIC    BIC   logLik deviance  Chisq Df Pr(&gt;Chisq)  </span></span>
<span><span class="co">#&gt; ft_aphidNull    4 28.204 31.294 -10.1020   20.204                       </span></span>
<span><span class="co">#&gt; ft_aphids       6 26.974 31.609  -7.4868   14.973 5.2304  2    0.07315 .</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Which gives us marginal evidence of an effect of bird exclusion of aphid counts.</p>
<p>Compare this to what we got when adding <code>Plot</code> as a fixed effect:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_aphids</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Plot</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Time</span>,data<span class="op">=</span><span class="va">aphidsBACI</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">lm_aphids</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: logcount</span></span>
<span><span class="co">#&gt;                Df Sum Sq Mean Sq F value   Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; Plot            7 0.8986  0.1284  0.4603 0.833357   </span></span>
<span><span class="co">#&gt; Time            1 5.4675  5.4675 19.6038 0.004434 **</span></span>
<span><span class="co">#&gt; Treatment:Time  1 0.7397  0.7397  2.6522 0.154527   </span></span>
<span><span class="co">#&gt; Residuals       6 1.6734  0.2789                    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Interestingly, this <span class="math inline">\(P\)</span>-value is a lot smaller.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_aphids</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = logcount ~ Plot + Treatment * Time, data = aphidsBACI)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -0.5527 -0.1929  0.0000  0.1929  0.5527 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients: (1 not defined because of singularities)</span></span>
<span><span class="co">#&gt;                              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)                    4.6097     0.4175  11.041 3.28e-05 ***</span></span>
<span><span class="co">#&gt; Plot2                         -0.1559     0.5281  -0.295  0.77776    </span></span>
<span><span class="co">#&gt; Plot3                          0.3378     0.5281   0.640  0.54600    </span></span>
<span><span class="co">#&gt; Plot4                          0.4433     0.5281   0.839  0.43336    </span></span>
<span><span class="co">#&gt; Plot5                          0.2127     0.5904   0.360  0.73105    </span></span>
<span><span class="co">#&gt; Plot6                          0.3530     0.5904   0.598  0.57179    </span></span>
<span><span class="co">#&gt; Plot7                          0.6593     0.5904   1.117  0.30685    </span></span>
<span><span class="co">#&gt; Plot8                          0.2631     0.5904   0.446  0.67154    </span></span>
<span><span class="co">#&gt; Treatmentpresent                   NA         NA      NA       NA    </span></span>
<span><span class="co">#&gt; TimeX15.07.                   -1.5992     0.3734  -4.282  0.00519 ** </span></span>
<span><span class="co">#&gt; Treatmentpresent:TimeX15.07.   0.8601     0.5281   1.629  0.15453    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.5281 on 6 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.8094, Adjusted R-squared:  0.5235 </span></span>
<span><span class="co">#&gt; F-statistic: 2.831 on 9 and 6 DF,  p-value: 0.1091</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_aphids</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: logcount ~ Treatment * Time + (1 | Plot)</span></span>
<span><span class="co">#&gt;    Data: aphidsBACI</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 20.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -1.2314 -0.4755 -0.2367  0.3187  1.8824 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  Plot     (Intercept) 0.000    0.0000  </span></span>
<span><span class="co">#&gt;  Residual             0.199    0.4461  </span></span>
<span><span class="co">#&gt; Number of obs: 16, groups:  Plot, 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;                              Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)                    4.9817     0.2231  22.334</span></span>
<span><span class="co">#&gt; Treatmentpresent              -0.2157     0.3155  -0.684</span></span>
<span><span class="co">#&gt; TimeX15.07.                   -1.5992     0.3155  -5.069</span></span>
<span><span class="co">#&gt; Treatmentpresent:TimeX15.07.   0.8601     0.4461   1.928</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;             (Intr) Trtmnt TX15.0</span></span>
<span><span class="co">#&gt; Trtmntprsnt -0.707              </span></span>
<span><span class="co">#&gt; TimeX15.07. -0.707  0.500       </span></span>
<span><span class="co">#&gt; Tr:TX15.07.  0.500 -0.707 -0.707</span></span>
<span><span class="co">#&gt; optimizer (nloptwrap) convergence code: 0 (OK)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span></code></pre></div>
<p>We get the same point estimate for the <code>Treatment:Time</code> effect, but the standard error is slightly smaller in the random effects model.</p>
</div>
<div class="section level2">
<h2 id="exercise-6-4-estuary-data-in-different-zones">Exercise 6.4: Estuary data in different zones<a class="anchor" aria-label="anchor" href="#exercise-6-4-estuary-data-in-different-zones"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">estuaryZone</span><span class="op">)</span></span>
<span><span class="va">cols</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span>,<span class="st">"lightblue"</span>,<span class="st">"pink"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Estuary</span>,<span class="va">Zone</span><span class="op">)</span>,data<span class="op">=</span><span class="va">estuaryZone</span>,col<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mod-Inner"</span>,<span class="st">"Prist-Inner"</span>,<span class="st">"Mod-Outer"</span>,<span class="st">"Pris-Outer"</span><span class="op">)</span>,col<span class="op">=</span><span class="va">cols</span>,pch<span class="op">=</span><span class="fl">15</span>,pt.cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter6Solutions_files/figure-html/ex64%20plot-1.png" width="768"></p>
<p>It looks like there is an effect of Modification, not sure if there is an interaction (the effect seems more striking in Outer than Inner zones)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="va">lme_MZ</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Zone</span><span class="op">*</span><span class="va">Mod</span> <span class="op">+</span> <span class="op">(</span><span class="va">Zone</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>, data<span class="op">=</span><span class="va">estuaryZone</span> <span class="op">)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html" class="external-link">scatter.smooth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">lme_MZ</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">lme_MZ</span><span class="op">)</span>,</span>
<span>    xlab<span class="op">=</span><span class="st">"Fitted values"</span>,ylab<span class="op">=</span><span class="st">"Residuals"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/scatter.smooth.html" class="external-link">scatter.smooth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">lme_MZ</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">lme_MZ</span>,re.form<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>    xlab<span class="op">=</span><span class="st">"Fitted values (no random effects)"</span>,ylab<span class="op">=</span><span class="st">"Residuals"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter6Solutions_files/figure-html/ex64%20lme-1.png" width="768"></p>
<p>There is a suggestion of less total abundance as fitted values increase, which is super-weird. But it’s not too alarming…</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lme_MplusZ</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Zone</span><span class="op">+</span><span class="va">Mod</span> <span class="op">+</span> <span class="op">(</span><span class="va">Zone</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>, data<span class="op">=</span><span class="va">estuaryZone</span> <span class="op">)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">lme_MplusZ</span>,<span class="va">lme_MZ</span><span class="op">)</span></span>
<span><span class="co">#&gt; refitting model(s) with ML (instead of REML)</span></span>
<span><span class="co">#&gt; Data: estuaryZone</span></span>
<span><span class="co">#&gt; Models:</span></span>
<span><span class="co">#&gt; lme_MplusZ: Total ~ Zone + Mod + (Zone | Estuary)</span></span>
<span><span class="co">#&gt; lme_MZ: Total ~ Zone * Mod + (Zone | Estuary)</span></span>
<span><span class="co">#&gt;            npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)</span></span>
<span><span class="co">#&gt; lme_MplusZ    7 595.91 612.31 -290.95   581.91                     </span></span>
<span><span class="co">#&gt; lme_MZ        8 597.14 615.89 -290.57   581.14 0.7618  1     0.3828</span></span></code></pre></div>
<p>No evidence of an interaction between Zone and Modification. Testing for a <code>Mod</code> main effect:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lme_Z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Zone</span> <span class="op">+</span> <span class="op">(</span><span class="va">Zone</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>, data<span class="op">=</span><span class="va">estuaryZone</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">lme_Z</span>,<span class="va">lme_MplusZ</span><span class="op">)</span></span>
<span><span class="co">#&gt; refitting model(s) with ML (instead of REML)</span></span>
<span><span class="co">#&gt; Data: estuaryZone</span></span>
<span><span class="co">#&gt; Models:</span></span>
<span><span class="co">#&gt; lme_Z: Total ~ Zone + (Zone | Estuary)</span></span>
<span><span class="co">#&gt; lme_MplusZ: Total ~ Zone + Mod + (Zone | Estuary)</span></span>
<span><span class="co">#&gt;            npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    </span></span>
<span><span class="co">#&gt; lme_Z         6 608.43 622.50 -298.22   596.43                         </span></span>
<span><span class="co">#&gt; lme_MplusZ    7 595.91 612.31 -290.95   581.91 14.529  1   0.000138 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>There is strong evidence that total abundance is different between Modified and Pristine estuaries. The boxplot suggests abundance is higher in Modified estuaries, and looking at the data, this appears to be mostly due to high counts of <code>Balanus.variegatus</code>, especially in outer modified zones.</p>
</div>
<div class="section level2">
<h2 id="code-box-6-6-using-the-parametric-bootstrap-to-compute-the-standard-error-of-the-mod-fixed-effect-in-exercise-6-1-">Code Box 6.6: Using the parametric bootstrap to compute the standard error of the <code>Mod</code> fixed effect in Exercise 6.1.<a class="anchor" aria-label="anchor" href="#code-box-6-6-using-the-parametric-bootstrap-to-compute-the-standard-error-of-the-mod-fixed-effect-in-exercise-6-1-"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nBoot</span><span class="op">=</span><span class="fl">500</span></span>
<span><span class="va">bStat</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">nBoot</span><span class="op">)</span></span>
<span><span class="va">ft_estu</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Mod</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>,data<span class="op">=</span><span class="va">estuaries</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">iBoot</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nBoot</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>   <span class="va">estuaries</span><span class="op">$</span><span class="va">TotalSim</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">ft_estu</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">ft_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">TotalSim</span><span class="op">~</span><span class="va">Mod</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>,data<span class="op">=</span><span class="va">estuaries</span><span class="op">)</span></span>
<span>   <span class="va">bStat</span><span class="op">[</span><span class="va">iBoot</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html" class="external-link">fixef</a></span><span class="op">(</span><span class="va">ft_i</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">bStat</span><span class="op">)</span> <span class="co">#standard error of Mod effect</span></span>
<span><span class="co">#&gt; [1] 4.326651</span></span></code></pre></div>
<p>And if we compare this to the standard error from <code>summary</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_estu</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: Total ~ Mod + (1 | Estuary)</span></span>
<span><span class="co">#&gt;    Data: estuaries</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 314.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.2393 -0.7569  0.1553  0.7372  1.8962 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  Estuary  (Intercept)  10.68    3.268  </span></span>
<span><span class="co">#&gt;  Residual             123.72   11.123  </span></span>
<span><span class="co">#&gt; Number of obs: 42, groups:  Estuary, 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)   39.053      3.237  12.065</span></span>
<span><span class="co">#&gt; ModPristine  -11.243      4.287  -2.622</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;             (Intr)</span></span>
<span><span class="co">#&gt; ModPristine -0.755</span></span></code></pre></div>
<p>we see the estimated standard error is 4.287348, which is pretty close to the value we got by simulation.</p>
</div>
<div class="section level2">
<h2 id="code-box-6-7-a-parametric-bootstrap-to-test-for-an-effect-of-estuary-in-exercise-6-1-">Code Box 6.7: A parametric bootstrap to test for an effect of Estuary in Exercise 6.1.<a class="anchor" aria-label="anchor" href="#code-box-6-7-a-parametric-bootstrap-to-test-for-an-effect-of-estuary-in-exercise-6-1-"></a>
</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_noestu</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Mod</span>,data<span class="op">=</span><span class="va">estuaries</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dwarton.github.io/ecostats/">ecostats</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/anovaPB.html">anovaPB</a></span><span class="op">(</span><span class="va">ft_noestu</span>,<span class="va">ft_estu</span>,n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in x$terms : $ operator not defined for this S4 class</span></span>
<span><span class="co">#&gt; Warning in Ops.factor(1, Estuary): '|' not meaningful for factors</span></span>
<span><span class="co">#&gt;           df deviance      LRT Pr(&gt;LRT)</span></span>
<span><span class="co">#&gt; ft_noestu  3 322.1963       NA       NA</span></span>
<span><span class="co">#&gt; ft_estu    4 314.3646 7.831769     0.27</span></span></code></pre></div>
<p>So we have no evidence of an <code>Estuary</code> effect.</p>
</div>
<div class="section level2">
<h2 id="exercise-6-6-accurate-inferences-about-the-estuary-data">Exercise 6.6: Accurate inferences about the estuary data<a class="anchor" aria-label="anchor" href="#exercise-6-6-accurate-inferences-about-the-estuary-data"></a>
</h2>
<p><em>Use the parametric bootstrap to get a formal test for a <code>zone:mod</code> interaction.</em></p>
<p>We can just run the old analysis and change from <code>anova</code> to <code>anovaPB</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lme_MZ</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Zone</span><span class="op">*</span><span class="va">Mod</span> <span class="op">+</span> <span class="op">(</span><span class="va">Zone</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>, data<span class="op">=</span><span class="va">estuaryZone</span>, REML<span class="op">=</span><span class="cn">FALSE</span> <span class="op">)</span></span>
<span><span class="va">lme_MplusZ</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Zone</span><span class="op">+</span><span class="va">Mod</span> <span class="op">+</span> <span class="op">(</span><span class="va">Zone</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>, data<span class="op">=</span><span class="va">estuaryZone</span>, REML<span class="op">=</span><span class="cn">FALSE</span> <span class="op">)</span></span>
<span><span class="fu"><a href="../reference/anovaPB.html">anovaPB</a></span><span class="op">(</span><span class="va">lme_MplusZ</span>,<span class="va">lme_MZ</span>,n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in Ops.factor(Zone, Estuary): '|' not meaningful for factors</span></span>
<span><span class="co">#&gt; Data: estuaryZone</span></span>
<span><span class="co">#&gt; Models:</span></span>
<span><span class="co">#&gt; objectNull: Total ~ Zone + Mod + (Zone | Estuary)</span></span>
<span><span class="co">#&gt; object: Total ~ Zone * Mod + (Zone | Estuary)</span></span>
<span><span class="co">#&gt;            npar    AIC    BIC  logLik deviance  Chisq Pr(&gt;Chisq)</span></span>
<span><span class="co">#&gt; objectNull    7 595.91 612.31 -290.95   581.91                  </span></span>
<span><span class="co">#&gt; object        8 597.14 615.89 -290.57   581.14 0.7618       0.44</span></span></code></pre></div>
<p>There is no evidence of an interaction.</p>
<p>(Ignore the warnings in the output – this is random stuff that was thrown up in bootstrap resamples that didn’t get a good fit.)</p>
<p><em>How do results compare to those from when you were using the <code>anova</code> function?</em></p>
<p>Results are similar to what we saw before. The only thing that is different is the <span class="math inline">\(P\)</span>-value, but it is very similar (suggesting there was no need for a parametric bootstrap here!).</p>
<p><em>This would all have been so much easier if there wasn’t a random effect in the model… do we really need <code>Estuary</code> in there?</em></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lme_MZ</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Zone</span><span class="op">*</span><span class="va">Mod</span> <span class="op">+</span> <span class="op">(</span><span class="va">Zone</span><span class="op">|</span><span class="va">Estuary</span><span class="op">)</span>, data<span class="op">=</span><span class="va">estuaryZone</span>, REML<span class="op">=</span><span class="cn">FALSE</span> <span class="op">)</span></span>
<span><span class="va">lme_MZnoest</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Total</span><span class="op">~</span><span class="va">Zone</span><span class="op">+</span><span class="va">Mod</span>, data<span class="op">=</span><span class="va">estuaryZone</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/anovaPB.html">anovaPB</a></span><span class="op">(</span><span class="va">lme_MZnoest</span>,<span class="va">lme_MZ</span>,n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in x$terms : $ operator not defined for this S4 class</span></span>
<span><span class="co">#&gt; Warning in Ops.factor(Zone, Estuary): '|' not meaningful for factors</span></span>
<span><span class="co">#&gt;             df deviance      LRT Pr(&gt;LRT)</span></span>
<span><span class="co">#&gt; lme_MZnoest  4 582.8273       NA       NA</span></span>
<span><span class="co">#&gt; lme_MZ       8 581.1436 1.683641     0.35</span></span></code></pre></div>
<p>We have no evidence of an <code>Estuary</code> effect either!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
