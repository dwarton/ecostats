<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecostats">
<title>Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes • ecostats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes">
<meta property="og:description" content="ecostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecostats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/ecostats.html">About ecostats</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Chapter Solutions</h6>
    <a class="dropdown-item" href="../articles/Chapter1Solutions.html">Chapter 1 -- 'STATS 101' Revision -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter2Solutions.html">Chapter 2 -- An importance equivalence result -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter3Solutions.html">Chapter 3 -- Regression with multiple predictor variables -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter4Solutions.html">Chapter 4 -- Linear models -- anything goes -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter5Solutions.html">Chapter 5 -- Model selection -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter6Solutions.html">Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter7Solutions.html">Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter8Solutions.html">Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter9Solutions.html">Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter10Solutions.html">Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter11Solutions.html">Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter12Solutions.html">Chapter 12 -- Visualising many responses -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter13Solutions.html">Chapter 13 -- Allometric line-fitting -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter14Solutions.html">Chapter 14 -- Multivariate abundances -- inference about environmental associations -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter15Solutions.html">Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter16Solutions.html">Chapter 16 -- Understanding variation in environmental response across taxa -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter17Solutions.html">Chapter 17 -- Studying co-occurrence patterns -- Exercise solutions and Code Boxes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Glossary of functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dwarton/ecostats">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes</h1>
                        <h4 data-toc-skip class="author">David Warton</h4>
            
            <h4 data-toc-skip class="date">2022-08-24</h4>
      
      
      <div class="d-none name"><code>Chapter15Solutions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="exercise-15-1-predicting-fish-communities-at-wind-farms">Exercise 15.1: Predicting fish communities at wind farms?<a class="anchor" aria-label="anchor" href="#exercise-15-1-predicting-fish-communities-at-wind-farms"></a>
</h2>
<p><em>Consider again Lena’s wind farm study (Exericise 14.3). She would like to predict what fish occur where. What type of model should she use, to get the best predictions?</em></p>
<p>The focus here is prediction so she should be using some model designed to have good predictive performance. One thing that might help is putting random effects on terms, that take different values for different species, to borrow strength across species.</p>
</div>
<div class="section level2">
<h2 id="exercise-15-2-which-environmental-variables-predict-hunting-spider-communities">Exercise 15.2: Which environmental variables predict hunting spider communities?<a class="anchor" aria-label="anchor" href="#exercise-15-2-which-environmental-variables-predict-hunting-spider-communities"></a>
</h2>
<p><em>Petrus set up 28 pitfall traps on sand dunes, in different environmental conditions (in the open, under shrubs, etc) and classified all hunting spiders that fell into the trap to species. He measured six environmental variables characterising each site. He would like to know: Which environmental variables best predict hunting spider communities?</em></p>
<p><em>What analysis approach should he use?</em></p>
<p>This is a variable selection problem, he should be using multivariate model selection techniques. One approach is to construct models designed to be pretty good for prediction, and choose the one with best predictive performance. For example, he could fit mixed models, with random effects for different species, and use cross-validation to see which set of predictors gives the model has best predictive performance.</p>
</div>
<div class="section level2">
<h2 id="code-box-15-1-predictive-likelihood-for-the-wind-farm-data">Code Box 15.1: Predictive likelihood for the wind farm data<a class="anchor" aria-label="anchor" href="#code-box-15-1-predictive-likelihood-for-the-wind-farm-data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dwarton.github.io/ecostats/">ecostats</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="co"># use this seed to get the same results as below:</span></span>
<span><span class="va">nStations</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">isTestStn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">nStations</span>,<span class="va">nStations</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">isTest</span> <span class="op">=</span> <span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">[</span><span class="va">isTestStn</span><span class="op">]</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="va">windMV</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund.html" class="external-link">mvabund</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">abund</span><span class="op">)</span></span>
<span><span class="va">windFt_Train</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">+</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">windFt_Int_Train</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">prWind_Test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Train</span>,newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">prWind_Int_Test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Int_Train</span>, newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLogL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Test</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predLogL_Int</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Int_Test</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL_Int</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -931.5643 -928.3885</span></span></code></pre></div>
<p><em>What do these results tell us about which model is preferred?</em></p>
<p>These results suggest the main effect model is better.</p>
</div>
<div class="section level2">
<h2 id="exercise-15-3-cross-validation-for-wind-farm-data-and-rare-species">Exercise 15.3: Cross-validation for wind farm data and rare species<a class="anchor" aria-label="anchor" href="#exercise-15-3-cross-validation-for-wind-farm-data-and-rare-species"></a>
</h2>
<p><em>Repeat the analyses of Code Box 15.1 but after removing rare species (observed less than 10 times), using the following code:</em></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">notRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">10</span></span>
<span><span class="va">windMVnotRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund.html" class="external-link">mvabund</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span>,<span class="va">notRare</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">windFt_TrainRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">+</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">windFt_Int_TrainRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">prWind_TestRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_TrainRare</span>,newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">prWind_Int_TestRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Int_TrainRare</span>, newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLogLRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_TestRare</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predLogL_IntRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Int_TestRare</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogLRare</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL_IntRare</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -781.0415 -788.9616</span></span></code></pre></div>
<p><em>Did you get a similar answer?</em></p>
<p>Nope – now the model with an interaction term looks better!</p>
<p><em>Note that so far we have only considered one test sample, and there is randomness in the choice of training/test split. Repeat the analyses of Code Box 15.1 as well as those you have done here, with and without rare species, multiple times (which is a form of cross-validation).</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># use this seed to get the same results as below:</span></span>
<span><span class="va">nStations</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">isTestStn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">nStations</span>,<span class="va">nStations</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">isTest</span> <span class="op">=</span> <span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">[</span><span class="va">isTestStn</span><span class="op">]</span></span>
<span><span class="va">windFt_Train</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">+</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">windFt_Int_Train</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">prWind_Test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Train</span>,newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">prWind_Int_Test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Int_Train</span>, newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLogL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Test</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predLogL_Int</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Int_Test</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL_Int</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -915.8434 -970.8314</span></span>
<span></span>
<span><span class="va">windFt_TrainRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">+</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">windFt_Int_TrainRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">prWind_TestRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_TrainRare</span>,newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">prWind_Int_TestRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Int_TrainRare</span>, newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLogLRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_TestRare</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predLogL_IntRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Int_TestRare</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogLRare</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL_IntRare</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -734.4901 -780.1963</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="co"># use this seed to get the same results as below:</span></span>
<span><span class="va">nStations</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">isTestStn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">nStations</span>,<span class="va">nStations</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">isTest</span> <span class="op">=</span> <span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">[</span><span class="va">isTestStn</span><span class="op">]</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="va">windMV</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund.html" class="external-link">mvabund</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">abund</span><span class="op">)</span></span>
<span><span class="va">windFt_Train</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">+</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">windFt_Int_Train</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">prWind_Test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Train</span>,newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">prWind_Int_Test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Int_Train</span>, newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLogL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Test</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predLogL_Int</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Int_Test</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL_Int</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -886.4941 -992.3476</span></span>
<span></span>
<span><span class="va">windFt_TrainRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">+</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">windFt_Int_TrainRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">prWind_TestRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_TrainRare</span>,newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">prWind_Int_TestRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Int_TrainRare</span>, newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLogLRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_TestRare</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predLogL_IntRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Int_TestRare</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogLRare</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL_IntRare</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -756.8341 -865.5058</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="co"># use this seed to get the same results as below:</span></span>
<span><span class="va">nStations</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">isTestStn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">nStations</span>,<span class="va">nStations</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">isTest</span> <span class="op">=</span> <span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">[</span><span class="va">isTestStn</span><span class="op">]</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="va">windMV</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund.html" class="external-link">mvabund</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">abund</span><span class="op">)</span></span>
<span><span class="va">windFt_Train</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">+</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">windFt_Int_Train</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">prWind_Test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Train</span>,newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">prWind_Int_Test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Int_Train</span>, newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLogL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Test</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predLogL_Int</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Int_Test</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL_Int</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -830.5662 -832.3659</span></span>
<span></span>
<span><span class="va">windFt_TrainRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">+</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">windFt_Int_TrainRare</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,</span>
<span>      data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">prWind_TestRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_TrainRare</span>,newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">prWind_Int_TestRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/predict.manyglm.html" class="external-link">predict.manyglm</a></span><span class="op">(</span><span class="va">windFt_Int_TrainRare</span>, newdata<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLogLRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_TestRare</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predLogL_IntRare</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windMVnotRare</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,lambda<span class="op">=</span><span class="va">prWind_Int_TestRare</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogLRare</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL_IntRare</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -734.7738 -738.2911</span></span></code></pre></div>
<p><em>Which set of results tends to be more reliable (less variable) – the ones with or without the rare species? Why do you think this happened?</em></p>
<p>Without the rare species, the results are more reliable, with predictive likelihood usually in the mid -700’s, and the interaction model consistently performing better (although sometimes narrowly so). With rare species, it bounces around a lot more, with the smaller model (main effects only) sometimes having better predictive performance. This is likely because rare species with all absences in one treatment combination can blow up the predictive likelihood (if they are predicted to have a mean of zero, but have some non-zero cases in test data).</p>
</div>
<div class="section level2">
<h2 id="code-box-15-2-fitting-a-mixed-model-to-the-wind-farm-data">Code Box 15.2: Fitting a mixed model to the wind farm data<a class="anchor" aria-label="anchor" href="#code-box-15-2-fitting-a-mixed-model-to-the-wind-farm-data"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">windComp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">~</span><span class="va">Zone</span><span class="op">*</span><span class="va">Year</span>,data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span>,composition<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/glmmTMB/glmmTMB" class="external-link">glmmTMB</a></span><span class="op">)</span></span>
<span><span class="va">wind_glmm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span><span class="op">|</span><span class="va">cols</span><span class="op">)</span>,</span>
<span>family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>, data<span class="op">=</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wind_glmm</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: poisson  ( log )</span></span>
<span><span class="co">#&gt; Formula:          windMV ~ Year * Zone + diag(Year * Zone | cols)</span></span>
<span><span class="co">#&gt; Data: windComp$data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;   3259.9   3331.4  -1617.9   3235.9     2852 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;  Groups Name           Variance Std.Dev. Corr                     </span></span>
<span><span class="co">#&gt;  cols   (Intercept)    5.3421   2.3113                            </span></span>
<span><span class="co">#&gt;         Year2010       1.6302   1.2768   0.00                     </span></span>
<span><span class="co">#&gt;         ZoneN          0.6807   0.8251   0.00 0.00                </span></span>
<span><span class="co">#&gt;         ZoneS          3.9012   1.9751   0.00 0.00 0.00           </span></span>
<span><span class="co">#&gt;         Year2010:ZoneN 0.8519   0.9230   0.00 0.00 0.00 0.00      </span></span>
<span><span class="co">#&gt;         Year2010:ZoneS 0.3777   0.6146   0.00 0.00 0.00 0.00 0.00 </span></span>
<span><span class="co">#&gt; Number of obs: 2864, groups:  cols, 16</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;                Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)    -3.18913    0.65414  -4.875 1.09e-06 ***</span></span>
<span><span class="co">#&gt; Year2010       -0.26989    0.45008  -0.600    0.549    </span></span>
<span><span class="co">#&gt; ZoneN          -0.15541    0.35209  -0.441    0.659    </span></span>
<span><span class="co">#&gt; ZoneS          -0.16619    0.61670  -0.269    0.788    </span></span>
<span><span class="co">#&gt; Year2010:ZoneN  0.08998    0.41305   0.218    0.828    </span></span>
<span><span class="co">#&gt; Year2010:ZoneS  0.56211    0.37247   1.509    0.131    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-15-4-predictive-likelihood-for-wind-farm-mixed-model">Exercise 15.4: Predictive likelihood for wind farm mixed model<a class="anchor" aria-label="anchor" href="#exercise-15-4-predictive-likelihood-for-wind-farm-mixed-model"></a>
</h2>
<p><em>Calculate the predictive likelihood for the mixed model fitted to the wind farm data (Code Box 15.2), following the method in Code Box 15.1.</em></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">isTest</span> <span class="op">=</span> <span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Station</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">[</span><span class="va">isTestStn</span><span class="op">]</span></span>
<span><span class="va">wind_glmm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span><span class="op">|</span><span class="va">cols</span><span class="op">)</span>,</span>
<span>  family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>, data<span class="op">=</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">prGLMM_Test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">wind_glmm</span>, newdata<span class="op">=</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">TRUE</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predGLMM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">]</span>,lambda<span class="op">=</span><span class="va">prGLMM_Test</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">predGLMM</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -744.1239 -830.5662</span></span></code></pre></div>
<p><em>Did this have better predictive performance? Why do you think this happened?</em></p>
<p>This did waaaay better than <code>manyglm</code>. Probably because it was borrowing strength across species to better predict rare ones, not overfitting quite as badly.</p>
</div>
<div class="section level2">
<h2 id="code-box-15-3-fitting-a-lasso-to-the-wind-farm-data-via-glmnet">Code Box 15.3: Fitting a LASSO to the wind farm data via glmnet<a class="anchor" aria-label="anchor" href="#code-box-15-3-fitting-a-lasso-to-the-wind-farm-data-via-glmnet"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span><span class="op">*</span><span class="va">cols</span>,data<span class="op">=</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">windMV</span></span>
<span><span class="va">windLasso</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">y</span>, family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">isTest</span> <span class="op">=</span> <span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Station</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Station</span><span class="op">)</span><span class="op">[</span><span class="va">isTestStn</span><span class="op">]</span></span>
<span><span class="va">windLassoTrain</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span><span class="op">]</span>, family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="va">prLassoTest</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">windLassoTrain</span>,<span class="va">X</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLLlasso</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">]</span>,<span class="va">prLassoTest</span>,</span>
<span>log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">windLassoTrain</span><span class="op">$</span><span class="va">lambda</span>,<span class="va">predLLlasso</span>,type<span class="op">=</span><span class="st">"l"</span>,log<span class="op">=</span><span class="st">"x"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/code15.3-1.png" alt=""><p class="caption">plot of chunk code15.3</p>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">isBestLambda</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">predLLlasso</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">predLLlasso</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">windLasso</span><span class="op">$</span><span class="va">lambda</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">windLasso</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"n"</span>, log<span class="op">=</span><span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matlines</a></span><span class="op">(</span><span class="va">windLasso</span><span class="op">$</span><span class="va">lambda</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">windLasso</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/code15.3beta-1.png" alt=""><p class="caption">plot of chunk code15.3beta</p>
</div>
</div>
<div class="section level2">
<h2 id="code-box-15-4-fitting-a-group-lasso-to-the-wind-farm-data">Code Box 15.4: Fitting a group-LASSO to the wind farm data<a class="anchor" aria-label="anchor" href="#code-box-15-4-fitting-a-group-lasso-to-the-wind-farm-data"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grplasso</span><span class="op">)</span></span>
<span><span class="va">windLambdaTrain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/grplasso/man/lambdamax.html" class="external-link">lambdamax</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span><span class="op">*</span><span class="va">cols</span>, data<span class="op">=</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  subset<span class="op">=</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/grplasso/man/grpl.model.html" class="external-link">PoissReg</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.7</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span></span>
<span><span class="va">windGrplasso</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/grplasso/man/grplasso.html" class="external-link">grplasso</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span><span class="op">*</span><span class="va">cols</span>, data<span class="op">=</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  lambda<span class="op">=</span><span class="va">windLambdaTrain</span>, subset<span class="op">=</span><span class="va">isTest</span><span class="op">==</span><span class="cn">FALSE</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/grplasso/man/grpl.model.html" class="external-link">PoissReg</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Lambda: 556.505  nr.var: 16 </span></span>
<span><span class="co">#&gt; Lambda: 389.5535  nr.var: 31 </span></span>
<span><span class="co">#&gt; Lambda: 272.6875  nr.var: 61 </span></span>
<span><span class="co">#&gt; Lambda: 190.8812  nr.var: 61 </span></span>
<span><span class="co">#&gt; Lambda: 133.6169  nr.var: 61 </span></span>
<span><span class="co">#&gt; Lambda: 93.5318  nr.var: 61 </span></span>
<span><span class="co">#&gt; Lambda: 65.47226  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 45.83058  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 32.08141  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 22.45699  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 15.71989  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 11.00392  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 7.702746  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 5.391922  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 3.774346  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 2.642042  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 1.849429  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 1.294601  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 0.9062204  nr.var: 91 </span></span>
<span><span class="co">#&gt; Lambda: 0.6343543  nr.var: 91</span></span>
<span><span class="va">prGrpTest</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">windGrplasso</span>,newdata<span class="op">=</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">isTest</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predLLgrplasso</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">windComp</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">windMV</span><span class="op">[</span><span class="va">isTest</span><span class="op">]</span>, <span class="va">prGrpTest</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">windGrplasso</span><span class="op">$</span><span class="va">lambda</span>,<span class="va">predLLgrplasso</span>,log<span class="op">=</span><span class="st">"x"</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/code15.4-1.png" alt=""><p class="caption">plot of chunk code15.4</p>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">isBestLambdaGrplasso</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">predLLgrplasso</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">predLLgrplasso</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">windGrplasso</span><span class="op">$</span><span class="va">lambda</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">windGrplasso</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"n"</span>,log<span class="op">=</span><span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matlines</a></span><span class="op">(</span><span class="va">windGrplasso</span><span class="op">$</span><span class="va">lambda</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">windGrplasso</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/code15.4beta-1.png" alt=""><p class="caption">plot of chunk code15.4beta</p>
</div>
</div>
<div class="section level2">
<h2 id="exercise-15-5-comparing-predictive-likelihoods-for-the-wind-farm-data">Exercise 15.5: Comparing predictive likelihoods for the wind farm data<a class="anchor" aria-label="anchor" href="#exercise-15-5-comparing-predictive-likelihoods-for-the-wind-farm-data"></a>
</h2>
<p><em>Compare the predictive log-likelihoods from Code Box 15.1 and Figures 15.1c-d. These models were all applied using the same test dataset. Which model seems to fit the data better? Why do you think this is?</em></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">predLogL_Int</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">predLLlasso</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">predLLgrplasso</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -830.5662 -832.3659 -744.2159 -739.6487</span></span></code></pre></div>
<p>The LASSO models fit way better, as expected. These models shrink parameters together, borrowing strength across taxa. The two LASSO fits did about as well as each other.</p>
</div>
<div class="section level2">
<h2 id="code-box-15-5-reduced-rank-regression-for-the-wind-farm-data">Code Box 15.5: Reduced rank regression for the wind farm data<a class="anchor" aria-label="anchor" href="#code-box-15-5-reduced-rank-regression-for-the-wind-farm-data"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.auckland.ac.nz/~yee/VGAM/" class="external-link">VGAM</a></span><span class="op">)</span></span>
<span><span class="va">wind_RR2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/rrvglm.html" class="external-link">rrvglm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">abund</span><span class="op">)</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>, family<span class="op">=</span><span class="va">poissonff</span>, data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span>, Rank<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">wind_manyglm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">windMV</span><span class="op">~</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>, data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">wind_RR2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">wind_manyglm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3318.548 3471.901</span></span>
<span><span class="va">zoneyear</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Zone</span>,<span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">zoneyear</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/latvar.html" class="external-link">latvar</a></span><span class="op">(</span><span class="va">wind_RR2</span><span class="op">)</span>,pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">19</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/code15.5-1.png" alt=""><p class="caption">plot of chunk code15.5</p>
</div>
<p><em>Which model fits better, according to BIC?</em></p>
<p>The reduced rank approach fits better.</p>
</div>
<div class="section level2">
<h2 id="code-box-15-6-using-the-lasso-for-petruss-spider-data">Code Box 15.6: Using the LASSO for Petrus’s spider data<a class="anchor" aria-label="anchor" href="#code-box-15-6-using-the-lasso-for-petruss-spider-data"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">spider</span><span class="op">)</span></span>
<span><span class="va">spid.trait</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/traitglm.html" class="external-link">traitglm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>,<span class="va">spider</span><span class="op">$</span><span class="va">x</span>,method<span class="op">=</span><span class="st">"cv.glm1path"</span><span class="op">)</span></span>
<span><span class="co">#&gt; No traits matrix entered, so will fit SDMs with different env response for each spp</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/code15.6-1.png" alt=""><p class="caption">plot of chunk code15.6</p>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">spid.trait</span><span class="op">$</span><span class="va">fourth.corner</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">colort</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"white"</span>,<span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot.4th</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/levelplot.html" class="external-link">levelplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">spid.trait</span><span class="op">$</span><span class="va">fourth.corner</span><span class="op">)</span><span class="op">)</span>,</span>
<span>xlab<span class="op">=</span><span class="st">"Environmental Variables"</span>, ylab<span class="op">=</span><span class="st">"Species"</span>,</span>
<span>col.regions<span class="op">=</span><span class="fu">colort</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="va">a</span>, <span class="va">a</span>, length<span class="op">=</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> x<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rot <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot.4th</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/code15.6-2.png" alt=""><p class="caption">plot of chunk code15.6</p>
</div>
<p><em>Which environmental variables seem to have the strongest effect on spider abundances?</em></p>
<p><code>soil.dry</code> has some strongly negative coefficients, <code>fallen.leaves</code> and <code>herb.layer</code> also have some strong (but positive) interactions.</p>
</div>
<div class="section level2">
<h2 id="code-box-15-7-mixed-model-prediction-of-spider-abundances">Code Box 15.7: Mixed model prediction of spider abundances<a class="anchor" aria-label="anchor" href="#code-box-15-7-mixed-model-prediction-of-spider-abundances"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spidXY</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,<span class="va">spider</span><span class="op">$</span><span class="va">abund</span><span class="op">)</span> <span class="co"># scale standardises data!</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="va">spiderLong</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="va">spidXY</span>,variable.name<span class="op">=</span><span class="st">"cols"</span><span class="op">)</span></span>
<span><span class="va">Xformula</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">"+"</span><span class="op">)</span></span>
<span><span class="va">fullFormula</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"value~cols+"</span>,<span class="va">Xformula</span>,<span class="st">"+("</span>,<span class="va">Xformula</span>,<span class="st">"|cols)"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/glmmTMB/glmmTMB" class="external-link">glmmTMB</a></span><span class="op">)</span></span>
<span><span class="va">spid_glmm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">fullFormula</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/nbinom2.html" class="external-link">nbinom2</a></span><span class="op">(</span><span class="op">)</span>,data<span class="op">=</span><span class="va">spiderLong</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in fitTMB(TMBStruc): Model convergence problem; non-positive-definite Hessian matrix.</span></span>
<span><span class="co">#&gt; See vignette('troubleshooting')</span></span>
<span><span class="co">#&gt; Warning in fitTMB(TMBStruc): Model convergence problem; false convergence (8). See</span></span>
<span><span class="co">#&gt; vignette('troubleshooting')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">spid_glmm</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: nbinom2  ( log )</span></span>
<span><span class="co">#&gt; Formula:          value ~ cols + soil.dry + bare.sand + fallen.leaves + moss +  </span></span>
<span><span class="co">#&gt;     herb.layer + reflection + (soil.dry + bare.sand + fallen.leaves +  </span></span>
<span><span class="co">#&gt;     moss + herb.layer + reflection | cols)</span></span>
<span><span class="co">#&gt; Data: spiderLong</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;       NA       NA       NA       NA      289 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;  Groups Name          Variance Std.Dev. Corr                                </span></span>
<span><span class="co">#&gt;  cols   (Intercept)   0.6198   0.7873                                       </span></span>
<span><span class="co">#&gt;         soil.dry      1.8397   1.3564   -0.88                               </span></span>
<span><span class="co">#&gt;         bare.sand     0.1567   0.3959   -0.10 -0.08                         </span></span>
<span><span class="co">#&gt;         fallen.leaves 0.4022   0.6342    0.67 -0.67 -0.68                   </span></span>
<span><span class="co">#&gt;         moss          0.2354   0.4852   -0.70  0.40  0.51 -0.59             </span></span>
<span><span class="co">#&gt;         herb.layer    0.6003   0.7748   -0.91  0.82 -0.20 -0.40  0.47       </span></span>
<span><span class="co">#&gt;         reflection    0.6677   0.8172    0.15 -0.52  0.33  0.20  0.40 -0.33 </span></span>
<span><span class="co">#&gt; Number of obs: 336, groups:  cols, 12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dispersion parameter for nbinom2 family ():  1.5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)    0.16776    0.47850   0.351 0.725894    </span></span>
<span><span class="co">#&gt; colsAlopcune   0.54986    0.33996   1.617 0.105785    </span></span>
<span><span class="co">#&gt; colsAlopfabr  -1.63899    0.58105  -2.821 0.004792 ** </span></span>
<span><span class="co">#&gt; colsArctlute  -1.97278    0.82953  -2.378 0.017398 *  </span></span>
<span><span class="co">#&gt; colsArctperi  -4.54237    1.35504  -3.352 0.000802 ***</span></span>
<span><span class="co">#&gt; colsAuloalbi   0.07721    0.53723   0.144 0.885718    </span></span>
<span><span class="co">#&gt; colsPardlugu  -1.36175    0.81877  -1.663 0.096279 .  </span></span>
<span><span class="co">#&gt; colsPardmont   1.70514    0.42854   3.979 6.92e-05 ***</span></span>
<span><span class="co">#&gt; colsPardnigr   0.92672    0.65593   1.413 0.157703    </span></span>
<span><span class="co">#&gt; colsPardpull   1.12798    0.72752   1.550 0.121034    </span></span>
<span><span class="co">#&gt; colsTrocterr   2.26516    0.54456   4.160 3.19e-05 ***</span></span>
<span><span class="co">#&gt; colsZoraspin   0.34212    0.69131   0.495 0.620682    </span></span>
<span><span class="co">#&gt; soil.dry       0.65262    0.42430   1.538 0.124020    </span></span>
<span><span class="co">#&gt; bare.sand      0.06150    0.15994   0.385 0.700601    </span></span>
<span><span class="co">#&gt; fallen.leaves -0.35286    0.26457  -1.334 0.182309    </span></span>
<span><span class="co">#&gt; moss           0.13402    0.18688   0.717 0.473289    </span></span>
<span><span class="co">#&gt; herb.layer     1.10662    0.27995   3.953 7.72e-05 ***</span></span>
<span><span class="co">#&gt; reflection    -0.03521    0.29688  -0.119 0.905585    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>There are some convergence warnings here, which is fair enough because there are only 12 species but heaps of correlated terms in this model. Results seem to be reasonably stable on multiple runs, tweaking some settings, so we’ll go with this fit.</p>
<p><em>Which predictors seem to be most important to spider community composition?</em></p>
<p>The largest variance component, by some margin, is for <code>soil.dry</code> (about 1.8), followed by <code>herb.layer</code> and <code>reflection</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
