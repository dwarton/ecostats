<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecostats">
<title>Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes â€¢ ecostats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes">
<meta property="og:description" content="ecostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecostats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/eco-stats.html">About ecostats</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Chapter Solutions</h6>
    <a class="dropdown-item" href="../articles/Chapter1Solutions.html">Chapter 1 -- 'STATS 101' Revision -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter2Solutions.html">Chapter 2 -- An importance equivalence result -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter3Solutions.html">Chapter 3 -- Regression with multiple predictor variables -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter4Solutions.html">Chapter 4 -- Linear models -- anything goes -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter5Solutions.html">Chapter 5 -- Model selection -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter6Solutions.html">Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter7Solutions.html">Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter8Solutions.html">Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter9Solutions.html">Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter10Solutions.html">Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter11Solutions.html">Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter12Solutions.html">Chapter 12 -- Visualising many responses -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter13Solutions.html">Chapter 13 -- Allometric line-fitting -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter14Solutions.html">Chapter 14 -- Multivariate abundances -- inference about environmental associations -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter15Solutions.html">Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter16Solutions.html">Chapter 16 -- Understanding variation in environmental response across taxa -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter17Solutions.html">Chapter 17 -- Studying co-occurrence patterns -- Exercise solutions and Code Boxes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Glossary of functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dwarton/ecostats">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes</h1>
                        <h4 data-toc-skip class="author">David
Warton</h4>
            
            <h4 data-toc-skip class="date">2022-06-09</h4>
      
      
      <div class="d-none name"><code>Chapter7Solutions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="exercise-7-1-biological-control-of-aphids-over-time">Exercise 7.1: Biological control of aphids over time<a class="anchor" aria-label="anchor" href="#exercise-7-1-biological-control-of-aphids-over-time"></a>
</h2>
<p><em>Is there an effect of the netting treatment on changes in aphid
numbers across the sampling times?</em></p>
<p><em>What sort of model is appropriate here?</em></p>
<p>Because we now have repeated measures in time, we have longitudinal
data and should consider the methods of Section 7.1.1.</p>
</div>
<div class="section level2">
<h2 id="code-box-7-1-r-code-to-produce-figure-7-2-">Code Box 7.1: R code to produce Figure 7.2.<a class="anchor" aria-label="anchor" href="#code-box-7-1-r-code-to-produce-figure-7-2-"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ecostats</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">aphids</span><span class="op">)</span>
<span class="va">cols</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="co">#transparent colours</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">aphids</span><span class="op">$</span><span class="va">oat</span>, <span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html" class="external-link">interaction.plot</a></span><span class="op">(</span><span class="va">Time</span>,<span class="va">Plot</span>,<span class="va">logcount</span>,legend<span class="op">=</span><span class="cn">FALSE</span>,
  col<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="va">Treatment</span><span class="op">]</span>, lty<span class="op">=</span><span class="fl">1</span>, ylab<span class="op">=</span><span class="st">"Counts [log(y+1) scale]"</span>,
  xlab<span class="op">=</span><span class="st">"Time (days since treatment)"</span><span class="op">)</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Excluded"</span>,<span class="st">"Present"</span><span class="op">)</span>,col<span class="op">=</span><span class="va">cols</span>,lty<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"(a)"</span>,<span class="fl">3</span>,adj<span class="op">=</span><span class="fl">0</span>,line<span class="op">=</span><span class="fl">0.5</span>,cex<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">aphids</span><span class="op">$</span><span class="va">oat</span>, <span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html" class="external-link">interaction.plot</a></span><span class="op">(</span><span class="va">Time</span>,<span class="va">Treatment</span>,<span class="va">logcount</span>, col<span class="op">=</span><span class="va">cols</span>,
  lty<span class="op">=</span><span class="fl">1</span>, legend<span class="op">=</span><span class="cn">FALSE</span>, ylab<span class="op">=</span><span class="st">"Counts [log(y+1) scale]"</span>,
  xlab<span class="op">=</span><span class="st">"Time (days since treatment)"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Excluded"</span>,<span class="st">"Present"</span><span class="op">)</span>,col<span class="op">=</span><span class="va">cols</span>,lty<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"(b)"</span>,<span class="fl">3</span>,adj<span class="op">=</span><span class="fl">0</span>,line<span class="op">=</span><span class="fl">0.5</span>,cex<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/box71-1.png" alt=""><p class="caption">plot of chunk box71</p>
</div>
</div>
<div class="section level2">
<h2 id="code-box-7-2-choosing-a-longitudinal-model-for-the-aphid-data">Code Box 7.2: Choosing a longitudinal model for the aphid data<a class="anchor" aria-label="anchor" href="#code-box-7-2-choosing-a-longitudinal-model-for-the-aphid-data"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span>
<span class="va">aphid_int</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Time</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,
    data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">oat</span>,REML<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># random intercepts model</span>
<span class="va">aphid_slope</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Time</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="va">Time</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,
    data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">oat</span>, REML<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># random slopes model</span>
<span class="co">#&gt; Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| =</span>
<span class="co">#&gt; 0.00715391 (tol = 0.002, component 1)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span> <span class="co"># refit random intercepts model in nlme to get a ACF:</span>
<span class="va">aphid_int2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Time</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,
    random<span class="op">=</span><span class="op">~</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span>, data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">oat</span>, method<span class="op">=</span><span class="st">"ML"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/ACF.html" class="external-link">ACF</a></span><span class="op">(</span><span class="va">aphid_int2</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span> <span class="co"># only works for nlme-fitted mixed models</span></code></pre></div>
<div class="figure">
<img src="figure/box72-1.png" alt=""><p class="caption">plot of chunk box72</p>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># now try a model with a temporally structured random effect:</span>
<span class="va">aphid_CAR1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">aphid_int2</span>,correlation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/corCAR1.html" class="external-link">corCAR1</a></span><span class="op">(</span>,form<span class="op">=</span><span class="op">~</span><span class="va">Time</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">aphid_int</span>,<span class="va">aphid_int2</span>,<span class="va">aphid_slope</span>,<span class="va">aphid_CAR1</span><span class="op">)</span>
<span class="co">#&gt;             df      BIC</span>
<span class="co">#&gt; aphid_int    8 144.5429</span>
<span class="co">#&gt; aphid_int2   8 144.5429</span>
<span class="co">#&gt; aphid_slope 10 147.4244</span>
<span class="co">#&gt; aphid_CAR1   9 148.1673</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-7-3-exploring-the-random-intercept-fit-to-the-aphids-data">Code Box 7.3: Exploring the random intercept fit to the aphids
data<a class="anchor" aria-label="anchor" href="#code-box-7-3-exploring-the-random-intercept-fit-to-the-aphids-data"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">aphid_int</span><span class="op">)</span>
<span class="co">#&gt; Linear mixed model fit by maximum likelihood  ['lmerMod']</span>
<span class="co">#&gt; Formula: logcount ~ Treatment * Time + Treatment * I(Time^2) + (1 | Plot)</span>
<span class="co">#&gt;    Data: aphids$oat</span>
<span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span>
<span class="co">#&gt; 128.3401 144.5429 -56.1701 112.3401       48 </span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups   Name        Std.Dev.</span>
<span class="co">#&gt;  Plot     (Intercept) 0.202   </span>
<span class="co">#&gt;  Residual             0.635   </span>
<span class="co">#&gt; Number of obs: 56, groups:  Plot, 8</span>
<span class="co">#&gt; Fixed Effects:</span>
<span class="co">#&gt;                (Intercept)            Treatmentpresent                        Time                   I(Time^2)  </span>
<span class="co">#&gt;                  6.5703718                  -0.2379806                  -0.1943256                   0.0028708  </span>
<span class="co">#&gt;      Treatmentpresent:Time  Treatmentpresent:I(Time^2)  </span>
<span class="co">#&gt;                  0.0495183                  -0.0004498</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">aphid_int</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Variance Table</span>
<span class="co">#&gt;                     npar  Sum Sq Mean Sq F value</span>
<span class="co">#&gt; Treatment              1  2.0410  2.0410  5.0619</span>
<span class="co">#&gt; Time                   1 24.7533 24.7533 61.3917</span>
<span class="co">#&gt; I(Time^2)              1  5.7141  5.7141 14.1717</span>
<span class="co">#&gt; Treatment:Time         1  1.6408  1.6408  4.0693</span>
<span class="co">#&gt; Treatment:I(Time^2)    1  0.0413  0.0413  0.1024</span>
<span class="va">aphid_noTreat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Time</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,
   data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">oat</span>, REML<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">aphid_noTreat</span>,<span class="va">aphid_int</span><span class="op">)</span>
<span class="co">#&gt; Data: aphids$oat</span>
<span class="co">#&gt; Models:</span>
<span class="co">#&gt; aphid_noTreat: logcount ~ Time + I(Time^2) + (1 | Plot)</span>
<span class="co">#&gt; aphid_int: logcount ~ Treatment * Time + Treatment * I(Time^2) + (1 | Plot)</span>
<span class="co">#&gt;               npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)  </span>
<span class="co">#&gt; aphid_noTreat    5 130.26 140.39 -60.131   120.26                       </span>
<span class="co">#&gt; aphid_int        8 128.34 144.54 -56.170   112.34 7.9224  3    0.04764 *</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-7-4-exploring-the-random-slopes-fit-to-the-aphids-data">Code Box 7.4: Exploring the random slopes fit to the aphids
data<a class="anchor" aria-label="anchor" href="#code-box-7-4-exploring-the-random-slopes-fit-to-the-aphids-data"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">aphid_slope</span><span class="op">)</span>
<span class="co">#&gt; Linear mixed model fit by maximum likelihood  ['lmerMod']</span>
<span class="co">#&gt; Formula: logcount ~ Treatment * Time + Treatment * I(Time^2) + (Time |      Plot)</span>
<span class="co">#&gt;    Data: aphids$oat</span>
<span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span>
<span class="co">#&gt; 127.1708 147.4244 -53.5854 107.1708       46 </span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups   Name        Std.Dev. Corr </span>
<span class="co">#&gt;  Plot     (Intercept) 0.11684       </span>
<span class="co">#&gt;           Time        0.01907  -1.00</span>
<span class="co">#&gt;  Residual             0.57877       </span>
<span class="co">#&gt; Number of obs: 56, groups:  Plot, 8</span>
<span class="co">#&gt; Fixed Effects:</span>
<span class="co">#&gt;                (Intercept)            Treatmentpresent                        Time                   I(Time^2)  </span>
<span class="co">#&gt;                  6.5703718                  -0.2379806                  -0.1943256                   0.0028708  </span>
<span class="co">#&gt;      Treatmentpresent:Time  Treatmentpresent:I(Time^2)  </span>
<span class="co">#&gt;                  0.0495183                  -0.0004498  </span>
<span class="co">#&gt; optimizer (nloptwrap) convergence code: 0 (OK) ; 0 optimizer warnings; 1 lme4 warnings</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">aphid_slope</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Variance Table</span>
<span class="co">#&gt;                     npar  Sum Sq Mean Sq F value</span>
<span class="co">#&gt; Treatment              1  0.7467  0.7467  2.2291</span>
<span class="co">#&gt; Time                   1 12.8040 12.8040 38.2239</span>
<span class="co">#&gt; I(Time^2)              1  5.7141  5.7141 17.0582</span>
<span class="co">#&gt; Treatment:Time         1  0.8487  0.8487  2.5337</span>
<span class="co">#&gt; Treatment:I(Time^2)    1  0.0413  0.0413  0.1232</span>
<span class="va">aphid_noTreatS</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Time</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="va">Time</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,
    data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">oat</span>, REML<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">aphid_noTreatS</span>,<span class="va">aphid_slope</span><span class="op">)</span>
<span class="co">#&gt; Data: aphids$oat</span>
<span class="co">#&gt; Models:</span>
<span class="co">#&gt; aphid_noTreatS: logcount ~ Time + I(Time^2) + (Time | Plot)</span>
<span class="co">#&gt; aphid_slope: logcount ~ Treatment * Time + Treatment * I(Time^2) + (Time | Plot)</span>
<span class="co">#&gt;                npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)</span>
<span class="co">#&gt; aphid_noTreatS    7 125.04 139.22 -55.519   111.04                     </span>
<span class="co">#&gt; aphid_slope      10 127.17 147.42 -53.585   107.17 3.8666  3     0.2762</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-7-2-biological-control-of-aphids-in-a-wheat-field">Exercise 7.2: Biological control of aphids in a wheat field<a class="anchor" aria-label="anchor" href="#exercise-7-2-biological-control-of-aphids-in-a-wheat-field"></a>
</h2>
<p><em>Repeat the above longitudinal analyses for data from the wheat
field. Which longitudinal model better handles repeated measures in this
case?</em></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">aphids</span><span class="op">)</span>
<span class="va">cols</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="co">#transparent colours</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span>, <span class="fu"><a href="https://rdrr.io/r/stats/interaction.plot.html" class="external-link">interaction.plot</a></span><span class="op">(</span><span class="va">Time</span>,<span class="va">Plot</span>,<span class="va">logcount</span>,legend<span class="op">=</span><span class="cn">FALSE</span>,
  col<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="va">Treatment</span><span class="op">]</span>, lty<span class="op">=</span><span class="fl">1</span>, ylab<span class="op">=</span><span class="st">"Counts [log(y+1) scale]"</span>,
  xlab<span class="op">=</span><span class="st">"Time (days since treatment)"</span><span class="op">)</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Excluded"</span>,<span class="st">"Present"</span><span class="op">)</span>,col<span class="op">=</span><span class="va">cols</span>,lty<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/ex72plot-1.png" alt=""><p class="caption">plot of chunk ex72plot</p>
</div>
<p>As before we donâ€™t see a lot of lines crossing over so expect some
correlation. We also see a similar pattern with aphid counts reducing
over time, but possibly being higher without bird exclusion 2-5 weeks
into the trial.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span>
<span class="va">aphidw_int</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Time</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,
    data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span>,REML<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># random intercepts model</span>
<span class="co">#&gt; Warning: Some predictor variables are on very different scales: consider rescaling</span>
<span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span>
<span class="va">aphidw_slope</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Time</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="va">Time</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,
    data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span>, REML<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># random slopes model</span>
<span class="co">#&gt; Warning: Some predictor variables are on very different scales: consider rescaling</span>
<span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span> <span class="co"># refit random intercepts model in nlme to get a ACF:</span>
<span class="va">aphidw_int2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Treatment</span><span class="op">*</span><span class="va">Time</span><span class="op">+</span><span class="va">Treatment</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,
    random<span class="op">=</span><span class="op">~</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span>, data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span>, method<span class="op">=</span><span class="st">"ML"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/ACF.html" class="external-link">ACF</a></span><span class="op">(</span><span class="va">aphidw_int2</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span> <span class="co"># only works for nlme-fitted mixed models</span></code></pre></div>
<div class="figure">
<img src="figure/ex72long-1.png" alt=""><p class="caption">plot of chunk ex72long</p>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># now try a model with a temporally structured random effect:</span>
<span class="co"># for some reason this one returns non-convergence unless I make Tiem a (numerical) factor:</span>
<span class="va">aphidsTimenFac</span><span class="op">=</span><span class="fu">glmmTMB</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/numFactor.html" class="external-link">numFactor</a></span><span class="op">(</span><span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span> 
<span class="va">aphidw_CAR1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">aphidw_int2</span>,correlation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/corCAR1.html" class="external-link">corCAR1</a></span><span class="op">(</span>,form<span class="op">=</span><span class="op">~</span><span class="va">aphidsTimenFac</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">aphidw_int</span>,<span class="va">aphidw_int2</span>,<span class="va">aphidw_slope</span>,<span class="va">aphidw_CAR1</span><span class="op">)</span>
<span class="co">#&gt;              df      BIC</span>
<span class="co">#&gt; aphidw_int    8 165.5916</span>
<span class="co">#&gt; aphidw_int2   8 165.5916</span>
<span class="co">#&gt; aphidw_slope 10 170.1048</span>
<span class="co">#&gt; aphidw_CAR1   9 169.6170</span></code></pre></div>
<p>As before the random intercept model seems to be favoured.</p>
<p><em>Is there evidence that bird exclusion improves biological control
of aphids?</em></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aphidw_noTr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">Time</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,
    data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span>,REML<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># random intercepts model</span>
<span class="co">#&gt; Warning: Some predictor variables are on very different scales: consider rescaling</span>
<span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">aphidw_noTr</span>,<span class="va">aphidw_int</span><span class="op">)</span>
<span class="co">#&gt; Data: aphids$wheat</span>
<span class="co">#&gt; Models:</span>
<span class="co">#&gt; aphidw_noTr: logcount ~ Time + I(Time^2) + (1 | Plot)</span>
<span class="co">#&gt; aphidw_int: logcount ~ Treatment * Time + Treatment * I(Time^2) + (1 | Plot)</span>
<span class="co">#&gt;             npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)  </span>
<span class="co">#&gt; aphidw_noTr    5 151.02 161.15 -70.511   141.02                       </span>
<span class="co">#&gt; aphidw_int     8 149.39 165.59 -66.694   133.39 7.6327  3    0.05424 .</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>There is marginal evidence of a treatment effect.</p>
</div>
<div class="section level2">
<h2 id="exercise-7-3-biological-control-of-aphids-across-both-fields">Exercise 7.3: Biological control of aphids across both fields!<a class="anchor" aria-label="anchor" href="#exercise-7-3-biological-control-of-aphids-across-both-fields"></a>
</h2>
<p><em>Construct a single, larger model to test for an effect of
biological exclusion, and to check if this effect differs across
fields.</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aphids</span><span class="op">$</span><span class="va">oat</span><span class="op">$</span><span class="va">field</span>   <span class="op">=</span> <span class="st">"oat"</span>
<span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span><span class="op">$</span><span class="va">field</span> <span class="op">=</span> <span class="st">"wheat"</span>
<span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span><span class="op">$</span><span class="va">Plot</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"W"</span>,<span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span><span class="op">$</span><span class="va">Plot</span><span class="op">)</span> <span class="co">#making sure we have different names for different Plots across fields</span>
<span class="va">aphids</span><span class="op">$</span><span class="va">all</span>         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">aphids</span><span class="op">$</span><span class="va">oat</span>,<span class="va">aphids</span><span class="op">$</span><span class="va">wheat</span><span class="op">)</span>
<span class="va">aphids</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">field</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">aphids</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">field</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">aphids</span><span class="op">$</span><span class="va">all</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    112 obs. of  6 variables:</span>
<span class="co">#&gt;  $ Plot     : Factor w/ 16 levels "1","2","3","4",..: 1 2 3 4 5 6 7 8 1 2 ...</span>
<span class="co">#&gt;  $ Treatment: Factor w/ 2 levels "excluded","present": 2 2 2 2 1 1 1 1 2 2 ...</span>
<span class="co">#&gt;  $ Time     : num  3 3 3 3 3 3 3 3 10 10 ...</span>
<span class="co">#&gt;  $ counts   : int  449 547 597 304 520 587 545 192 185 93 ...</span>
<span class="co">#&gt;  $ logcount : num  6.11 6.31 6.39 5.72 6.26 ...</span>
<span class="co">#&gt;  $ field    : Factor w/ 2 levels "oat","wheat": 1 1 1 1 1 1 1 1 1 1 ...</span></code></pre></div>
<p>We will need a mixed model that allows effects to be different across
fields (and times)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aphida_int</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">field</span><span class="op">*</span><span class="va">Time</span><span class="op">*</span><span class="va">Treatment</span><span class="op">+</span><span class="va">field</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">Treatment</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,
    data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">all</span>,REML<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># random intercepts model</span>
<span class="co">#&gt; Warning: Some predictor variables are on very different scales: consider rescaling</span>
<span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span>
<span class="va">aphida_noTr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">logcount</span><span class="op">~</span><span class="va">field</span><span class="op">*</span><span class="va">Time</span><span class="op">+</span><span class="va">field</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span><span class="op">)</span>,
    data<span class="op">=</span><span class="va">aphids</span><span class="op">$</span><span class="va">all</span>,REML<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># random intercepts model</span>
<span class="co">#&gt; Warning: Some predictor variables are on very different scales: consider rescaling</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">aphida_noTr</span>,<span class="va">aphida_int</span><span class="op">)</span>
<span class="co">#&gt; Data: aphids$all</span>
<span class="co">#&gt; Models:</span>
<span class="co">#&gt; aphida_noTr: logcount ~ field * Time + field * I(Time^2) + (1 | Plot)</span>
<span class="co">#&gt; aphida_int: logcount ~ field * Time * Treatment + field * I(Time^2) * Treatment + (1 | Plot)</span>
<span class="co">#&gt;             npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)  </span>
<span class="co">#&gt; aphida_noTr    8 280.88 302.63 -132.44   264.88                       </span>
<span class="co">#&gt; aphida_int    14 276.61 314.67 -124.30   248.61 16.273  6    0.01236 *</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>In the combined model there is some evidence of a treatment
effect.</p>
</div>
<div class="section level2">
<h2 id="exercise-7-4-eucalypt-richness-as-a-function-of-the-environment">Exercise 7.4: Eucalypt richness as a function of the
environment<a class="anchor" aria-label="anchor" href="#exercise-7-4-eucalypt-richness-as-a-function-of-the-environment"></a>
</h2>
<p><em>Ian wanted to know: how does species richness vary from one area
to the next, and what are the main environmental correlates of
richness?â€¦ Plotting richness against spatial location, he found spatial
clusters of high or low species richness (Fig. 7.3)â€¦ What sort of
analysis method should Ian consider using?</em></p>
<p>He should be looking at fitting a spatial model, along the lines of
Code Box 7.5.</p>
</div>
<div class="section level2">
<h2 id="code-box-7-5-model-selection-to-choose-predictors-and-a-spatial-model-for-ians-richness-data">Code Box 7.5: Model selection to choose predictors, and a spatial
model, for Ianâ€™s richness data<a class="anchor" aria-label="anchor" href="#code-box-7-5-model-selection-to-choose-predictors-and-a-spatial-model-for-ians-richness-data"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">)</span>
<span class="va">Myrtaceae</span><span class="op">$</span><span class="va">logrich</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Myrtaceae</span><span class="op">$</span><span class="va">richness</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>
<span class="va">ft_rich</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,<span class="va">TMP_MIN</span>,<span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
     data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span>
<span class="va">ft_richAdd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">Myrtaceae</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_rich</span>,<span class="va">ft_richAdd</span><span class="op">)</span>
<span class="co">#&gt;            df      BIC</span>
<span class="co">#&gt; ft_rich    19 1014.686</span>
<span class="co">#&gt; ft_richAdd 16 1002.806</span></code></pre></div>
<p><em>(The below code chunk takes several minutes to
evaluate.)</em></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span>
<span class="va">richForm</span> <span class="op">=</span> <span class="va">logrich</span><span class="op">~</span><span class="va">soil</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MAX</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">TMP_MIN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
       <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">RAIN_ANN</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">ft_richExp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html" class="external-link">gls</a></span><span class="op">(</span><span class="va">richForm</span>,data<span class="op">=</span><span class="va">Myrtaceae</span>,correlation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/corExp.html" class="external-link">corExp</a></span><span class="op">(</span>form<span class="op">=</span><span class="op">~</span><span class="va">X</span><span class="op">+</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>
<span class="va">ft_richNugg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html" class="external-link">gls</a></span><span class="op">(</span><span class="va">richForm</span>,data<span class="op">=</span><span class="va">Myrtaceae</span>,
         correlation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/corExp.html" class="external-link">corExp</a></span><span class="op">(</span>form<span class="op">=</span><span class="op">~</span><span class="va">X</span><span class="op">+</span><span class="va">Y</span>,nugget<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_richExp</span>,<span class="va">ft_richNugg</span><span class="op">)</span>
<span class="co">#&gt;             df       BIC</span>
<span class="co">#&gt; ft_richExp  17 1036.2154</span>
<span class="co">#&gt; ft_richNugg 18  979.5212</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-7-6-inferences-from-spatial-and-non-spatial-models-for-ians-richness-data">Code Box 7.6: Inferences from spatial and non-spatial models for
Ianâ€™s richness data<a class="anchor" aria-label="anchor" href="#code-box-7-6-inferences-from-spatial-and-non-spatial-models-for-ians-richness-data"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_richNugg</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_richAdd</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_richNugg</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-7-7-spatial-correlogram-for-ians-species-richness-data">Code Box 7.7: Spatial correlogram for Ianâ€™s species richness
data<a class="anchor" aria-label="anchor" href="#code-box-7-7-spatial-correlogram-for-ians-species-richness-data"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://giraudoux.pagesperso-orange.fr" class="external-link">pgirmess</a></span><span class="op">)</span>
<span class="va">corRich</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Myrtaceae</span>,<span class="fu"><a href="https://rdrr.io/pkg/pgirmess/man/correlog.html" class="external-link">correlog</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span><span class="op">)</span>,<span class="va">logrich</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corRich</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="st">"grey90"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/box77-1.png" alt=""><p class="caption">plot of chunk box77</p>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">Myrtaceae</span><span class="op">$</span><span class="va">resid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">ft_richAdd</span><span class="op">)</span>
<span class="va">corRichResid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Myrtaceae</span>,<span class="fu"><a href="https://rdrr.io/pkg/pgirmess/man/correlog.html" class="external-link">correlog</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span><span class="op">)</span>,<span class="va">resid</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corRichResid</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="st">"grey90"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/box77-2.png" alt=""><p class="caption">plot of chunk box77</p>
</div>
</div>
<div class="section level2">
<h2 id="exercise-7-5-egg-size-when-dads-incubate">Exercise 7.5: Egg size when Dads incubate<a class="anchor" aria-label="anchor" href="#exercise-7-5-egg-size-when-dads-incubate"></a>
</h2>
<p><em>Terje wondered whether egg size was specifically limited by male
body size. So he collected data on 71 species of shorebird where the
male incubates the egg, measuring egg size, and size of adult males and
femalesâ€¦ What sort of model might be appropriate here?</em></p>
<p>We could try a linear model for egg size as a function of female and
male bird size.</p>
<p><em>Can see you see any potential problems satisfying independence
assumptions?</em></p>
<p>A potential issue is that there is a phylogenetic signal in many
traits: if shorebird species are more closely related, we can expect
their egg sizes to be more similar.</p>
</div>
<div class="section level2">
<h2 id="code-box-7-8-phylogenetic-tree-of-71-shorebird-species">Code Box 7.8: Phylogenetic tree of 71 shorebird species<a class="anchor" aria-label="anchor" href="#code-box-7-8-phylogenetic-tree-of-71-shorebird-species"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">caper</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">shorebird</span><span class="op">)</span>
<span class="va">shore4d</span><span class="op">=</span><span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/phylo4d-methods.html" class="external-link">phylo4d</a></span><span class="op">(</span><span class="va">shorebird.tree</span>,<span class="va">shorebird.data</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">phylosignal</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/phylosignal/man/barplot.phylo4d.html" class="external-link">barplot.phylo4d</a></span><span class="op">(</span><span class="va">shore4d</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Egg.Mass"</span>,<span class="st">"F.Mass"</span>,<span class="st">"M.Mass"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in asMethod(object): trees with unknown order may be unsafe in ape</span></code></pre></div>
<div class="figure">
<img src="figure/box7.8-1.png" alt=""><p class="caption">plot of chunk box7.8</p>
</div>
</div>
<div class="section level2">
<h2 id="code-box-7-9-exploratory-analysis-of-egg-size-data">Code Box 7.9: Exploratory analysis of egg size data}<a class="anchor" aria-label="anchor" href="#code-box-7-9-exploratory-analysis-of-egg-size-data"></a>
</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/" class="external-link">GGally</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">shorebird.data</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/box7.9-1.png" alt=""><p class="caption">plot of chunk box7.9</p>
</div>
</div>
<div class="section level2">
<h2 id="code-box-7-10-comparative-analysis-of-egg-size-data">Code Box 7.10: Comparative analysis of egg size data<a class="anchor" aria-label="anchor" href="#code-box-7-10-comparative-analysis-of-egg-size-data"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">caper</span><span class="op">)</span>
<span class="va">shorebird</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caper/man/comparative.data.html" class="external-link">comparative.data</a></span><span class="op">(</span><span class="va">shorebird.tree</span>, <span class="va">shorebird.data</span>,
                   <span class="va">Species</span>, vcv<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">pgls_egg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caper/man/pgls.html" class="external-link">pgls</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Egg.Mass</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">F.Mass</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">M.Mass</span><span class="op">)</span>,
                data<span class="op">=</span><span class="va">shorebird</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pgls_egg</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; pgls(formula = log(Egg.Mass) ~ log(F.Mass) + log(M.Mass), data = shorebird)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;       Min        1Q    Median        3Q       Max </span>
<span class="co">#&gt; -0.097840 -0.027594  0.000748  0.018561  0.063632 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Branch length transformations:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; kappa  [Fix]  : 1.000</span>
<span class="co">#&gt; lambda [Fix]  : 1.000</span>
<span class="co">#&gt; delta  [Fix]  : 1.000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept) -0.37902    0.23172 -1.6357 0.106520    </span>
<span class="co">#&gt; log(F.Mass) -0.22255    0.22081 -1.0079 0.317077    </span>
<span class="co">#&gt; log(M.Mass)  0.89708    0.22246  4.0325 0.000142 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 0.03343 on 68 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared: 0.8476,  Adjusted R-squared: 0.8431 </span>
<span class="co">#&gt; F-statistic: 189.1 on 2 and 68 DF,  p-value: &lt; 2.2e-16</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-7-11-residual-diagnostics-for-egg-size-data">Code Box 7.11: Residual diagnostics for egg size data<a class="anchor" aria-label="anchor" href="#code-box-7-11-residual-diagnostics-for-egg-size-data"></a>
</h2>
<p><em>The below code chunk takes several minutes to evaluate so it has
not been run</em></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pgls_egg</span><span class="op">)</span>
<span class="va">res.df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="va">shorebird.data</span><span class="op">$</span><span class="va">Species</span>,
                res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">pgls_egg</span><span class="op">)</span><span class="op">)</span>
<span class="va">res4d</span> <span class="op">=</span> <span class="fu">phylobase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/phylo4d-methods.html" class="external-link">phylo4d</a></span><span class="op">(</span><span class="va">shorebird.tree</span>,<span class="va">res.df</span><span class="op">)</span>
<span class="va">res.pg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phylosignal/man/phyloCorrelogram.html" class="external-link">phyloCorrelogram</a></span><span class="op">(</span><span class="va">res4d</span>,trait<span class="op">=</span><span class="st">"res"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res.pg</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-7-6-comparative-analysis-of-egg-size-data-revisited">Exercise 7.6: Comparative analysis of egg size data revisited<a class="anchor" aria-label="anchor" href="#exercise-7-6-comparative-analysis-of-egg-size-data-revisited"></a>
</h2>
<p><em>Refit the model allowing <span class="math inline">\(\lambda\)</span> to be estimated from the data
(using <code>lambda="ML"</code>), or allowing <span class="math inline">\(\delta\)</span> to be estimated from the
data.</em></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pgls_eggL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caper/man/pgls.html" class="external-link">pgls</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Egg.Mass</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">F.Mass</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">M.Mass</span><span class="op">)</span>, lambda<span class="op">=</span><span class="st">"ML"</span>,
                data<span class="op">=</span><span class="va">shorebird</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pgls_eggL</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; pgls(formula = log(Egg.Mass) ~ log(F.Mass) + log(M.Mass), data = shorebird, </span>
<span class="co">#&gt;     lambda = "ML")</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;       Min        1Q    Median        3Q       Max </span>
<span class="co">#&gt; -0.072175 -0.015738  0.001073  0.017126  0.057342 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Branch length transformations:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; kappa  [Fix]  : 1.000</span>
<span class="co">#&gt; lambda [ ML]  : 0.947</span>
<span class="co">#&gt;    lower bound : 0.000, p = 1.1224e-13</span>
<span class="co">#&gt;    upper bound : 1.000, p = 0.033109</span>
<span class="co">#&gt;    95.0% CI   : (0.839, 0.997)</span>
<span class="co">#&gt; delta  [Fix]  : 1.000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value  Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept) -0.43469    0.20689 -2.1011   0.03934 *  </span>
<span class="co">#&gt; log(F.Mass) -0.28756    0.22202 -1.2952   0.19963    </span>
<span class="co">#&gt; log(M.Mass)  0.97556    0.22304  4.3740 4.293e-05 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 0.02841 on 68 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared: 0.8709,  Adjusted R-squared: 0.8671 </span>
<span class="co">#&gt; F-statistic: 229.3 on 2 and 68 DF,  p-value: &lt; 2.2e-16</span></code></pre></div>
<p><em>Does this change results and their interpretation?</em></p>
<p>Nope â€“ results are pretty much the same as previously.</p>
<p><em>Now fit a linear model ignoring phylogeny, via <code>lm</code>.
What happens here?</em></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_egg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Egg.Mass</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">F.Mass</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">M.Mass</span><span class="op">)</span>, data<span class="op">=</span><span class="va">shorebird.data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_egg</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = log(Egg.Mass) ~ log(F.Mass) + log(M.Mass), data = shorebird.data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -0.5843 -0.1104  0.0257  0.1338  0.4347 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)  -0.2105     0.1296  -1.624    0.109    </span>
<span class="co">#&gt; log(F.Mass)  -1.0605     0.2261  -4.691 1.36e-05 ***</span>
<span class="co">#&gt; log(M.Mass)   1.7433     0.2283   7.635 1.01e-10 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 0.2113 on 68 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.9089, Adjusted R-squared:  0.9063 </span>
<span class="co">#&gt; F-statistic: 339.3 on 2 and 68 DF,  p-value: &lt; 2.2e-16</span></code></pre></div>
<p>The slopes move further from zero and everything becomes more
significant. In particular, while there was no effect of female mass
previously, now it is strongly significant.</p>
<p><em>Is this what you would expect?</em></p>
<p>Yes this is expected because phylogenetic relatedness introduces
positive dependence, leading to under-estimation of uncertainty and a
higher chance of false positives.</p>
<p><em>Look at the log-likelihood (using the <code>logLik</code>
function) to help decide which of these models is a better fit to the
data.</em></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">lm_egg</span><span class="op">)</span>
<span class="co">#&gt; 'log Lik.' 11.1658 (df=4)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">pgls_eggL</span><span class="op">)</span>
<span class="co">#&gt; 'log Lik.' 38.73639 (df=3)</span></code></pre></div>
<p>Something seems to be wrong with the <code>df</code> calculation in
the <code>pgls</code> model, but the main thing to see here is that the
log-likelihood is substantially higher for the <code>pgls</code> model,
suggesting it is a much better fit to the data.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
