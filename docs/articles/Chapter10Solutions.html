<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecostats">
<title>Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes • ecostats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes">
<meta property="og:description" content="ecostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecostats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/eco-stats.html">About ecostats</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Chapter Solutions</h6>
    <a class="dropdown-item" href="../articles/Chapter1Solutions.html">Chapter 1 -- 'STATS 101' Revision -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter2Solutions.html">Chapter 2 -- An importance equivalence result -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter3Solutions.html">Chapter 3 -- Regression with multiple predictor variables -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter4Solutions.html">Chapter 4 -- Linear models -- anything goes -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter5Solutions.html">Chapter 5 -- Model selection -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter6Solutions.html">Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter7Solutions.html">Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter8Solutions.html">Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter9Solutions.html">Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter10Solutions.html">Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter11Solutions.html">Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter12Solutions.html">Chapter 12 -- Visualising many responses -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter13Solutions.html">Chapter 13 -- Allometric line-fitting -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter14Solutions.html">Chapter 14 -- Multivariate abundances -- inference about environmental associations -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter15Solutions.html">Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter16Solutions.html">Chapter 16 -- Understanding variation in environmental response across taxa -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter17Solutions.html">Chapter 17 -- Studying co-occurrence patterns -- Exercise solutions and Code Boxes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Glossary of functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dwarton/ecostats">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes</h1>
                        <h4 data-toc-skip class="author">David
Warton</h4>
            
            <h4 data-toc-skip class="date">2022-06-09</h4>
      
      
      <div class="d-none name"><code>Chapter10Solutions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="exercise-10-1-crabs-on-seaweed">Exercise 10.1: Crabs on seaweed<a class="anchor" aria-label="anchor" href="#exercise-10-1-crabs-on-seaweed"></a>
</h2>
<p><em>David and Alistair… observed the following presence
(<code>+</code>) / absence (<code>-</code>)} patterns for crabs (across
10 replicates):</em></p>
<table class="table">
<thead><tr class="header">
<th align="left">Time</th>
<th align="left">Distance (m)</th>
<th align="left">Crabs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">5</td>
<td align="left">0</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">0</td>
<td align="left">+</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">0</td>
<td align="left">+</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">0</td>
<td align="left">-</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">0</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">2</td>
<td align="left">-</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">2</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">2</td>
<td align="left">+</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">2</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">2</td>
<td align="left">-</td>
</tr>
<tr class="odd">
<td align="left">…</td>
<td align="left">…</td>
<td align="left">…</td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="left">10</td>
<td align="left">+</td>
</tr>
</tbody>
</table>
<p><em>They would like to know if there is any evidence of a difference
in crab presence patterns with Distance of Isolation. How should they
analyse the data?</em></p>
<p>They are looking for evidence of a difference at different values of
<code>Dist</code> so will be wanting to do a hypothesis test. Because
they have presence-absence data they should be thinking of a generalised
linear model with binomial response, as in Code Box 10.1.</p>
</div>
<div class="section level2">
<h2 id="exercise-10-2-do-offshore-wind-farms-affect-fish-communities">Exercise 10.2: Do offshore wind farms affect fish communities?<a class="anchor" aria-label="anchor" href="#exercise-10-2-do-offshore-wind-farms-affect-fish-communities"></a>
</h2>
<p><em>Lena and colleagues… [were] collecting paired data before and
after wind farm construction, at 36 stations in each of three zones
(<code>Wind Farm</code>, <code>North</code>, or
<code>South</code>):</em></p>
<table class="table">
<thead><tr class="header">
<th align="left">Zone</th>
<th align="left">Impact</th>
<th align="left">Station</th>
<th align="left">Abundance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Wind Farm</td>
<td align="left">Before</td>
<td align="left">WF1</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">Wind Farm</td>
<td align="left">After</td>
<td align="left">WF1</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">South</td>
<td align="left">Before</td>
<td align="left">S1</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">South</td>
<td align="left">After</td>
<td align="left">S1</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">North</td>
<td align="left">Before</td>
<td align="left">N1</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">North</td>
<td align="left">After</td>
<td align="left">N1</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">Wind Farm</td>
<td align="left">Before</td>
<td align="left">WF2</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">Wind Farm</td>
<td align="left">After</td>
<td align="left">WF2</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">…</td>
<td align="left">…</td>
<td align="left">…</td>
<td align="left">…</td>
</tr>
<tr class="even">
<td align="left">North</td>
<td align="left">After</td>
<td align="left">N36</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<p><em>Lena wants to know if there is any evidence of a change in eel
abundance at wind farm stations, as compared to others, following
construction of the wind farm. How should she analyse the data?</em></p>
<p>She is looking for evidence of a difference across different values
of <code>Zone</code> when <code>Impact=After</code> so will be wanting
to do a hypothesis test. This is a BACI design, so she would be
particularly interested in the <code>Zone:Impact</code> interaction.
Because she has count data with plenty of zeros, this should be analysed
using a generalised linear model (assuming a negative binomial or
Poisson response, as in Code Box 10.1).</p>
</div>
<div class="section level2">
<h2 id="exercise-10-3-invertebrate-response-to-bush-regeneration">Exercise 10.3: Invertebrate response to bush regeneration}<a class="anchor" aria-label="anchor" href="#exercise-10-3-invertebrate-response-to-bush-regeneration"></a>
</h2>
<p><em>Anthony wants to evaluate how well invertebrate communities are
re-establishing following bush regeneration efforts.</em></p>
<table class="table">
<thead><tr class="header">
<th>Treatment</th>
<th>Count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>C</td>
<td>0</td>
</tr>
<tr class="even">
<td>R</td>
<td>3</td>
</tr>
<tr class="odd">
<td>R</td>
<td>1</td>
</tr>
<tr class="even">
<td>R</td>
<td>3</td>
</tr>
<tr class="odd">
<td>C</td>
<td>1</td>
</tr>
<tr class="even">
<td>R</td>
<td>2</td>
</tr>
<tr class="odd">
<td>R</td>
<td>12</td>
</tr>
<tr class="even">
<td>R</td>
<td>1</td>
</tr>
<tr class="odd">
<td>R</td>
<td>18</td>
</tr>
<tr class="even">
<td>R</td>
<td>0</td>
</tr>
</tbody>
</table>
<p><em>He wants to know if there is any evidence that bush regeneration
is working. How should he analyse the data?</em></p>
<p>He is looking for evidence of an effect of revegetation so will be
wanting to do a hypothesis test for a <code>Treatment</code> effect.
Because he has count data, with zeros, this should be analysed using a
generalised linear model (assuming a negative binomial or Poisson
response, as in Code Box 10.1).</p>
</div>
<div class="section level2">
<h2 id="code-box-10-1-example-glm-fits-for-exercises-10-1-3-">Code Box 10.1: Example GLM fits for Exercises 10.1-3.}<a class="anchor" aria-label="anchor" href="#code-box-10-1-example-glm-fits-for-exercises-10-1-3-"></a>
</h2>
<p>For Exercise 10.1:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ecostats</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">seaweed</span><span class="op">)</span>
<span class="va">seaweed</span><span class="op">$</span><span class="va">CrabPres</span> <span class="op">=</span> <span class="va">seaweed</span><span class="op">$</span><span class="va">Crab</span><span class="op">&gt;</span><span class="fl">0</span>
<span class="va">ft_crab</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">CrabPres</span><span class="op">~</span><span class="va">Time</span><span class="op">*</span><span class="va">Dist</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"cloglog"</span><span class="op">)</span>,
             data<span class="op">=</span><span class="va">seaweed</span><span class="op">)</span></code></pre></div>
<p>For Exercise 10.2: \begin{verbatim}</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">)</span>
<span class="va">eels</span> <span class="op">=</span> <span class="va">windFarms</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span>,<span class="fl">16</span><span class="op">]</span>
<span class="va">ft_eels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">eels</span><span class="op">~</span><span class="va">Station</span><span class="op">+</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,family<span class="op">=</span><span class="st">"poisson"</span>,
             data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>
<span class="co">#&gt; Warning: glm.fit: fitted rates numerically 0 occurred</span></code></pre></div>
<p>For Exercise 10.3:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">reveg</span><span class="op">)</span>
<span class="va">Haplotaxida</span><span class="op">=</span><span class="va">reveg</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span>,<span class="fl">12</span><span class="op">]</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span>
<span class="va">worms</span> <span class="op">=</span> <span class="va">reveg</span><span class="op">$</span><span class="va">abund</span><span class="op">$</span><span class="va">Haplotaxida</span>
<span class="va">ft_worms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">worms</span><span class="op">~</span><span class="va">treatment</span>,family<span class="op">=</span><span class="st">"negative.binomial"</span>, data<span class="op">=</span><span class="va">reveg</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-for-fig--10-5">Code for Fig. 10.5<a class="anchor" aria-label="anchor" href="#code-for-fig--10-5"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">reveg</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span>
<span class="va">revegMV</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund.html" class="external-link">mvabund</a></span><span class="op">(</span><span class="va">reveg</span><span class="op">$</span><span class="va">abund</span><span class="op">)</span>
<span class="va">treatment</span><span class="op">=</span><span class="va">reveg</span><span class="op">$</span><span class="va">treatment</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/meanvar.plot.html" class="external-link">meanvar.plot</a></span><span class="op">(</span><span class="va">revegMV</span><span class="op">~</span><span class="va">treatment</span>,legend<span class="op">=</span><span class="cn">T</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>,<span class="st">"darkgreen"</span><span class="op">)</span>,main<span class="op">=</span><span class="st">"Poisson"</span><span class="op">)</span>
<span class="co">#&gt; START SECTION 2 </span>
<span class="co">#&gt; Plotting if overlay is TRUE</span>
<span class="co">#&gt; using grouping variable Poisson 7 mean values were 0 and could </span>
<span class="co">#&gt;                                      not be included in the log-plot</span>
<span class="co">#&gt; using grouping variable Poisson 10 variance values were 0 and could not </span>
<span class="co">#&gt;                                      be included in the log-plot</span>
<span class="co">#&gt; FINISHED SECTION 2</span>
<span class="va">x</span><span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">3.8</span>,length<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">x</span>,type<span class="op">=</span><span class="st">"l"</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/fig10.5-1.png" alt=""><p class="caption">plot of chunk fig10.5</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/meanvar.plot.html" class="external-link">meanvar.plot</a></span><span class="op">(</span><span class="va">revegMV</span><span class="op">~</span><span class="va">treatment</span>,legend<span class="op">=</span><span class="cn">T</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkorange"</span>,<span class="st">"darkgreen"</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Negative binomial"</span><span class="op">)</span>
<span class="co">#&gt; START SECTION 2 </span>
<span class="co">#&gt; Plotting if overlay is TRUE</span>
<span class="co">#&gt; using grouping variable Negative binomial 7 mean values were 0 and could </span>
<span class="co">#&gt;                                      not be included in the log-plot</span>
<span class="co">#&gt; using grouping variable Negative binomial 10 variance values were 0 and could not </span>
<span class="co">#&gt;                                      be included in the log-plot</span>
<span class="co">#&gt; FINISHED SECTION 2</span>
<span class="va">x</span><span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">3.8</span>,length<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">x</span><span class="op">+</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span>,type<span class="op">=</span><span class="st">"l"</span>,col<span class="op">=</span><span class="st">"darkblue"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/fig10.5-2.png" alt=""><p class="caption">plot of chunk fig10.5</p>
</div>
</div>
<div class="section level2">
<h2 id="code-box-10-2-a-summary-of-a-glm-fit-to-the-crab-presence-absence-data-of-exercise-10-1">Code Box 10.2: A summary of a GLM fit to the crab presence-absence
data of Exercise 10.1<a class="anchor" aria-label="anchor" href="#code-box-10-2-a-summary-of-a-glm-fit-to-the-crab-presence-absence-data-of-exercise-10-1"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seaweed</span><span class="op">$</span><span class="va">Dist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">seaweed</span><span class="op">$</span><span class="va">Dist</span><span class="op">)</span>
<span class="va">ft_crab</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">CrabPres</span><span class="op">~</span><span class="va">Time</span><span class="op">*</span><span class="va">Dist</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"cloglog"</span><span class="op">)</span>,
             data<span class="op">=</span><span class="va">seaweed</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_crab</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = CrabPres ~ Time * Dist, family = binomial("cloglog"), </span>
<span class="co">#&gt;     data = seaweed)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -1.3537  -0.6681  -0.6681   1.0108   2.1460  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="co">#&gt; (Intercept)  -2.3282     1.5046  -1.547    0.122</span>
<span class="co">#&gt; Time          0.1656     0.1741   0.952    0.341</span>
<span class="co">#&gt; Dist2        -1.5921     2.5709  -0.619    0.536</span>
<span class="co">#&gt; Dist10       -0.5843     2.1097  -0.277    0.782</span>
<span class="co">#&gt; Time:Dist2    0.1683     0.2899   0.581    0.561</span>
<span class="co">#&gt; Time:Dist10   0.1169     0.2399   0.487    0.626</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 71.097  on 56  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 62.999  on 51  degrees of freedom</span>
<span class="co">#&gt; AIC: 74.999</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 5</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-10-3-dunn-smyth-residual-plots-for-the-crab-data-using-the-mvabund-package">Code Box 10.3: Dunn-Smyth residual plots for the crab data, using
the <code>mvabund</code> package<a class="anchor" aria-label="anchor" href="#code-box-10-3-dunn-smyth-residual-plots-for-the-crab-data-using-the-mvabund-package"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span>
<span class="va">ftMany_crab</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">CrabPres</span><span class="op">~</span><span class="va">Time</span><span class="op">*</span><span class="va">Dist</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"cloglog"</span><span class="op">)</span>,
             data<span class="op">=</span><span class="va">seaweed</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ftMany_crab</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/box10.3-1.png" alt=""><p class="caption">plot of chunk box10.3</p>
</div>
</div>
<div class="section level2">
<h2 id="code-for-figure-10-8">Code for Figure 10.8<a class="anchor" aria-label="anchor" href="#code-for-figure-10-8"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ftMany_crab</span>, which<span class="op">=</span><span class="fl">1</span>, n.sim<span class="op">=</span><span class="fl">39</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/fig10.8-1.png" alt=""><p class="caption">plot of chunk fig10.8</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ftMany_crab</span>, which<span class="op">=</span><span class="fl">1</span>, n.sim<span class="op">=</span><span class="fl">39</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/fig10.8-2.png" alt=""><p class="caption">plot of chunk fig10.8</p>
</div>
<p>(Note that <code>plotenvelope</code> was run with just
<code>39</code> iterations, to speed up computation time.)</p>
</div>
<div class="section level2">
<h2 id="exercise-10-4-counts-of-ostracods-in-habitat-configuration-experiment-">Exercise 10.4: Counts of Ostracods in habitat configuration
experiment.<a class="anchor" aria-label="anchor" href="#exercise-10-4-counts-of-ostracods-in-habitat-configuration-experiment-"></a>
</h2>
<p><em>What sort of model would you use for Ostracod counts?</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">seaweed</span>,<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">Ost</span><span class="op">~</span><span class="va">Dist</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/ex10.4-1.png" alt=""><p class="caption">plot of chunk ex10.4</p>
</div>
<p>As this is a count variable with plenty of small counts (and zeros in
each category), I am thinking a GLM. To start with we could consider a
Poisson regression, if there were no overdispersion, or negative
binomial regression.</p>
<p>The terms to add to the model I guess are <code>Time</code> and
<code>Dist</code>, as orthogonal factors. As previously
<code>Wmass</code> might also be useful.</p>
<p><em>How would you check assumptions?</em></p>
<p>Look for a fan-shape on a residual plot to check the mean-variance
assumption, as in Code Box 10.4.</p>
</div>
<div class="section level2">
<h2 id="code-box-10-4-assumption-checking-for-ostracod-counts-of-exercise-10-4-">Code Box 10.4: Assumption checking for Ostracod counts of Exercise
10.4.}<a class="anchor" aria-label="anchor" href="#code-box-10-4-assumption-checking-for-ostracod-counts-of-exercise-10-4-"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seaweed</span><span class="op">$</span><span class="va">logWmass</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">seaweed</span><span class="op">$</span><span class="va">Wmass</span><span class="op">)</span>
<span class="va">ft_countOst</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">Ost</span><span class="op">~</span><span class="va">logWmass</span><span class="op">+</span><span class="va">Time</span><span class="op">*</span><span class="va">Dist</span>,data<span class="op">=</span><span class="va">seaweed</span>,
             family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_countOst</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span> <span class="co"># for a scale-location plot as well</span></code></pre></div>
<p><img src="../reference/figures/box10.4-1.png" alt="plot of chunk box10.4"> (Note that <code>plotenvelope</code> was
run with just <code>99</code> iterations, to speed up computation
time.)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span> <span class="co">#this line is currently needed to deal with a bug but prob redundant soon</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">ft.countOstNB</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">Ost</span><span class="op">~</span><span class="va">logWmass</span><span class="op">+</span><span class="va">Time</span><span class="op">*</span><span class="va">Dist</span>,data<span class="op">=</span><span class="va">seaweed</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft.countOstNB</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/box10.4b-1.png" alt=""><p class="caption">plot of chunk box10.4b</p>
</div>
</div>
<div class="section level2">
<h2 id="exercise-10-5-checking-the-poisson-assumption-on-the-wind-farm-data-">Exercise 10.5: Checking the Poisson assumption on the wind farm
data.<a class="anchor" aria-label="anchor" href="#exercise-10-5-checking-the-poisson-assumption-on-the-wind-farm-data-"></a>
</h2>
<p><em>Refit the model using the <code>manyglm</code> function, and
hence construct a residual plot</em></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">windFarms</span><span class="op">)</span>
<span class="va">eels</span> <span class="op">=</span> <span class="va">windFarms</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span>,<span class="fl">16</span><span class="op">]</span>
<span class="va">ft_eels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">eels</span><span class="op">~</span><span class="va">Station</span><span class="op">+</span><span class="va">Year</span><span class="op">*</span><span class="va">Zone</span>,family<span class="op">=</span><span class="st">"poisson"</span>,
             data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_eels</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span>
<span class="co">#&gt; Error in glm.fit(x = structure(c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  : </span>
<span class="co">#&gt;   NA/NaN/Inf in 'x'</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/ex10.5-1.png" alt=""><p class="caption">plot of chunk ex10.5</p>
</div>
<p><em>Does the Poisson assumption look reasonable?</em></p>
<p>There is no evidence of a fan shape, residuals are close to a
straight line on the normal quantile plot, so it looks pretty good to
me.</p>
</div>
<div class="section level2">
<h2 id="exercise-10-6-checking-the-poisson-assumption-for-the-worm-counts-">Exercise 10.6: Checking the Poisson assumption for the worm
counts.}<a class="anchor" aria-label="anchor" href="#exercise-10-6-checking-the-poisson-assumption-for-the-worm-counts-"></a>
</h2>
<p><em>Refit the model using the <code>manyglm</code> function under the
Poisson assumption, and hence construct a residual plot.</em></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">reveg</span><span class="op">)</span>
<span class="va">Haplotaxida</span><span class="op">=</span><span class="va">reveg</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span>,<span class="fl">12</span><span class="op">]</span>
<span class="va">worms</span> <span class="op">=</span> <span class="va">reveg</span><span class="op">$</span><span class="va">abund</span><span class="op">$</span><span class="va">Haplotaxida</span>
<span class="va">ft_worms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">worms</span><span class="op">~</span><span class="va">treatment</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>, data<span class="op">=</span><span class="va">reveg</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_worms</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/box10.6Poisson-1.png" alt=""><p class="caption">plot of chunk box10.6Poisson</p>
</div>
<p><em>Also fit a negative binomial to the data and construct a residual
plot.</em></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_wormsNB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">worms</span><span class="op">~</span><span class="va">treatment</span>,family<span class="op">=</span><span class="st">"negative.binomial"</span>, data<span class="op">=</span><span class="va">reveg</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_wormsNB</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span>
<span class="co">#&gt; Warning in predict.lm(gam.yxi, newdata = data.frame(xiSim = xPred)): prediction from a rank-deficient fit may be</span>
<span class="co">#&gt; misleading</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/box10.6NB-1.png" alt=""><p class="caption">plot of chunk box10.6NB</p>
</div>
<p><em>Can you see any differences between plots?</em></p>
<p>The Poisson model fans out more and has a couple of residuals that
are unusually large (see normal quantile plot). It also may have a trend
line on the residual vs fits plots that slips outside its simulation
envelope.</p>
<p><em>Compare BIC for the two models, using the <code>BIC</code>
function.</em></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_worms</span>, <span class="va">ft_wormsNB</span><span class="op">)</span>
<span class="co">#&gt;            df      BIC</span>
<span class="co">#&gt; ft_worms    2 80.55508</span>
<span class="co">#&gt; ft_wormsNB  3 53.93523</span></code></pre></div>
<p><em>Which model has the better fit to the worm counts?</em></p>
<p>Well BIC suggests the negative binomial model is way better,
corroborating the result from the normal quantile plots.</p>
</div>
<div class="section level2">
<h2 id="code-box-10-5-r-code-using-the-anova-function-to-test-the-key-hypotheses-of-interest-to-david-and-alistair-in-exercise-10-1-">Code Box 10.5: <code>R</code> code using the <code>anova</code>
function to test the key hypotheses of interest to David and Alistair in
Exercise 10.1.<a class="anchor" aria-label="anchor" href="#code-box-10-5-r-code-using-the-anova-function-to-test-the-key-hypotheses-of-interest-to-david-and-alistair-in-exercise-10-1-"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_crab</span>, test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: binomial, link: cloglog</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: CrabPres</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Terms added sequentially (first to last)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Df Deviance Resid. Df Resid. Dev Pr(&gt;Chi)   </span>
<span class="co">#&gt; NULL                         56     71.097            </span>
<span class="co">#&gt; Time       1   6.6701        55     64.427 0.009804 **</span>
<span class="co">#&gt; Dist       2   1.0265        53     63.400 0.598553   </span>
<span class="co">#&gt; Time:Dist  2   0.4012        51     62.999 0.818257   </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p><em>Any evidence of an effect of Isolation distance on
crabs?</em></p>
<p>Nope :(</p>
<p><em>Note the <code>Time</code> effect is significant here but not in
Code Box 10.2. Why do you think that might be?</em></p>
<p>Code Box 10.2 uses a Wald test, which is known to give wacky answers
for separable models, see Maths Box 10.6 for details.</p>
</div>
<div class="section level2">
<h2 id="exercise-10-7-testing-if-there-a-wind-farm-effect">Exercise 10.7: Testing if there a wind farm effect<a class="anchor" aria-label="anchor" href="#exercise-10-7-testing-if-there-a-wind-farm-effect"></a>
</h2>
<p><em>What model should be fitted, to handle the pairing
structure?</em></p>
<p>We can fit a <code>glm</code> as previously but need to include
<code>Station</code> as one of the predictors, to handle
station-to-station variation in eel abundance:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_eelsSt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">eels</span><span class="op">~</span><span class="va">Station</span><span class="op">+</span><span class="va">Year</span><span class="op">+</span><span class="va">Year</span><span class="op">:</span><span class="va">Zone</span>,family<span class="op">=</span><span class="st">"poisson"</span>,
             data<span class="op">=</span><span class="va">windFarms</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>
<span class="co">#&gt; Warning: glm.fit: fitted rates numerically 0 occurred</span></code></pre></div>
<p>It would be OK to write <code>Year*Zone</code> but the
<code>Zone</code> main effect is redundant because of the
<code>Station</code> main effect. You could also use a mixed model with
a random intercept for <code>Station</code>.</p>
<p><em>Fit the appropriate model and test for an effect of wind
farm.</em></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_eelsSt</span>,test<span class="op">=</span><span class="st">'Chisq'</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: poisson, link: log</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: eels</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Terms added sequentially (first to last)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;            Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    </span>
<span class="co">#&gt; NULL                         178    246.714              </span>
<span class="co">#&gt; Station   107  169.443        71     77.270 0.0001145 ***</span>
<span class="co">#&gt; Year        1    1.906        70     75.365 0.1674431    </span>
<span class="co">#&gt; Year:Zone   2    4.821        68     70.544 0.0897813 .  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>There is marginal evidence of a Year-Zone interaction.</p>
</div>
<div class="section level2">
<h2 id="code-box-10-6-model-based-inference-for-anthonys-worm-counts-from-exercise-10-3-">Code Box 10.6: Model-based inference for Anthony’s worm counts from
Exercise 10.3.<a class="anchor" aria-label="anchor" href="#code-box-10-6-model-based-inference-for-anthonys-worm-counts-from-exercise-10-3-"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ftmany_Hap</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">Haplotaxida</span><span class="op">~</span><span class="va">treatment</span>,family<span class="op">=</span><span class="st">"negative.binomial"</span>,
              data<span class="op">=</span><span class="va">reveg</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ftmany_Hap</span><span class="op">)</span>
<span class="co">#&gt; Time elapsed: 0 hr 0 min 0 sec</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: Haplotaxida ~ treatment</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate test:</span>
<span class="co">#&gt;             Res.Df Df.diff   Dev Pr(&gt;Dev)</span>
<span class="co">#&gt; (Intercept)      9                       </span>
<span class="co">#&gt; treatment        8       1 2.811    0.156</span>
<span class="co">#&gt; Arguments: P-value calculated using 999 iterations via PIT-trap resampling.</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-10-7-design-based-inference-for-davids-and-alistairs-crab-data-using-mvabund-">Code Box 10.7: Design-based inference for David’s and Alistair’s
crab data using <code>mvabund</code>.<a class="anchor" aria-label="anchor" href="#code-box-10-7-design-based-inference-for-davids-and-alistairs-crab-data-using-mvabund-"></a>
</h2>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ftMany_crab</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">CrabPres</span><span class="op">~</span><span class="va">Time</span><span class="op">*</span><span class="va">Dist</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"cloglog"</span><span class="op">)</span>,
                 data<span class="op">=</span><span class="va">seaweed</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ftMany_crab</span><span class="op">)</span>
<span class="co">#&gt; Time elapsed: 0 hr 0 min 2 sec</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: CrabPres ~ Time * Dist</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate test:</span>
<span class="co">#&gt;             Res.Df Df.diff   Dev Pr(&gt;Dev)  </span>
<span class="co">#&gt; (Intercept)     56                         </span>
<span class="co">#&gt; Time            55       1 6.670    0.016 *</span>
<span class="co">#&gt; Dist            53       2 1.026    0.614  </span>
<span class="co">#&gt; Time:Dist       51       2 0.401    0.857  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Arguments: P-value calculated using 999 iterations via PIT-trap resampling.</span></code></pre></div>
<p><em>Any important differences from results David and Alistair
previously obtained in Code Box 10.5?</em></p>
<p>Nope, looks very similar actually! I guess the <code>Time</code>
effect is slightly less significant now but the conclusion doesn’t
really change, there is still reasonable evidence of a <code>Time</code>
effect.</p>
</div>
<div class="section level2">
<h2 id="code-box-10-8-getting-the-wrong-answer-by-ignoring-overdispersion-in-anthonys-worm-counts-from-exercise-10-3-">Code Box 10.8: Getting the wrong answer by ignoring overdispersion
in Anthony’s worm counts from Exercise 10.3.<a class="anchor" aria-label="anchor" href="#code-box-10-8-getting-the-wrong-answer-by-ignoring-overdispersion-in-anthonys-worm-counts-from-exercise-10-3-"></a>
</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_wormPois</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Haplotaxida</span><span class="op">~</span><span class="va">treatment</span>, family<span class="op">=</span><span class="st">"poisson"</span>, data<span class="op">=</span><span class="va">reveg</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_wormPois</span>,test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: poisson, link: log</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: Haplotaxida</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Terms added sequentially (first to last)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    </span>
<span class="co">#&gt; NULL                          9     63.946              </span>
<span class="co">#&gt; treatment  1   11.668         8     52.278 0.0006359 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_wormmanyPois</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">Haplotaxida</span><span class="op">~</span><span class="va">treatment</span>,family<span class="op">=</span><span class="st">"poisson"</span>,
                     data<span class="op">=</span><span class="va">reveg</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_wormmanyPois</span><span class="op">)</span>
<span class="co">#&gt; Time elapsed: 0 hr 0 min 0 sec</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: Haplotaxida ~ treatment</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate test:</span>
<span class="co">#&gt;             Res.Df Df.diff   Dev Pr(&gt;Dev)</span>
<span class="co">#&gt; (Intercept)      9                       </span>
<span class="co">#&gt; treatment        8       1 11.67    0.224</span>
<span class="co">#&gt; Arguments: P-value calculated using 999 iterations via PIT-trap resampling.</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-10-9-using-an-observation-level-random-effect-for-a-binomial-response">Code Box 10.9: Using an observation-level random effect for a
binomial response<a class="anchor" aria-label="anchor" href="#code-box-10-9-using-an-observation-level-random-effect-for-a-binomial-response"></a>
</h2>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">seedsTemp</span><span class="op">)</span>
<span class="va">seedsTemp</span><span class="op">$</span><span class="va">propGerm</span> <span class="op">=</span> <span class="va">seedsTemp</span><span class="op">$</span><span class="va">NumGerm</span> <span class="op">/</span> <span class="va">seedsTemp</span><span class="op">$</span><span class="va">NumSown</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">propGerm</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">propGerm</span><span class="op">)</span><span class="op">~</span><span class="va">Test.Temp</span>,data<span class="op">=</span><span class="va">seedsTemp</span>,log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span>
<span class="co">#&gt; Warning in xy.coords(x, y, xlabel, ylabel, log): 5 y values &lt;= 0 omitted from logarithmic plot</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/box10.9Load-1.png" alt=""><p class="caption">plot of chunk box10.9Load</p>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span>
<span class="va">seedsTemp</span><span class="op">$</span><span class="va">ID</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">seedsTemp</span><span class="op">$</span><span class="va">NumGerm</span><span class="op">)</span>
<span class="va">ft_temp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">glmer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">NumGerm</span>,<span class="va">NumSown</span><span class="op">-</span><span class="va">NumGerm</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">Test.Temp</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span>
               <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">ID</span><span class="op">)</span>,data<span class="op">=</span><span class="va">seedsTemp</span>,family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_temp</span><span class="op">)</span>
<span class="co">#&gt; Generalized linear mixed model fit by maximum likelihood (Laplace Approximation) ['glmerMod']</span>
<span class="co">#&gt;  Family: binomial  ( logit )</span>
<span class="co">#&gt; Formula: cbind(NumGerm, NumSown - NumGerm) ~ poly(Test.Temp, 2) + (1 |      ID)</span>
<span class="co">#&gt;    Data: seedsTemp</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span>
<span class="co">#&gt;    212.7    218.1   -102.3    204.7       25 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scaled residuals: </span>
<span class="co">#&gt;      Min       1Q   Median       3Q      Max </span>
<span class="co">#&gt; -1.10831 -0.00896  0.06063  0.13519  0.33025 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups Name        Variance Std.Dev.</span>
<span class="co">#&gt;  ID     (Intercept) 2.961    1.721   </span>
<span class="co">#&gt; Number of obs: 29, groups:  ID, 29</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fixed effects:</span>
<span class="co">#&gt;                     Estimate Std. Error z value Pr(&gt;|z|)  </span>
<span class="co">#&gt; (Intercept)          -0.5896     0.3428  -1.720   0.0854 .</span>
<span class="co">#&gt; poly(Test.Temp, 2)1   2.8770     1.9395   1.483   0.1380  </span>
<span class="co">#&gt; poly(Test.Temp, 2)2  -3.6910     1.9227  -1.920   0.0549 .</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Correlation of Fixed Effects:</span>
<span class="co">#&gt;             (Intr) p(T.T,2)1</span>
<span class="co">#&gt; ply(T.T,2)1 -0.060          </span>
<span class="co">#&gt; ply(T.T,2)2  0.066 -0.147</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-10-8-anthonys-ant-data-">Exercise 10.8: Anthony’s ant data.<a class="anchor" aria-label="anchor" href="#exercise-10-8-anthonys-ant-data-"></a>
</h2>
<p><em>Which model do you think is more appropriate for this dataset – a
Poisson or negative binomial?</em></p>
<p>This is a hard question to answer without fitting a model.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ants</span> <span class="op">=</span> <span class="va">reveg</span><span class="op">$</span><span class="va">abund</span><span class="op">$</span><span class="va">Formicidae</span>
<span class="va">ants_Poisson</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">ants</span><span class="op">~</span><span class="va">treatment</span>,data<span class="op">=</span><span class="va">reveg</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ants_Poisson</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/ex10.8P-1.png" alt=""><p class="caption">plot of chunk ex10.8P</p>
</div>
<p>OK so a Poisson fit is <strong>spectacularly</strong> bad. Neither
smoother stays in its envelope, and the data on the normal quantile plot
do not stay anywhere near their envelope.</p>
<p><em>Plot the data – does there seem to be evidence of a treatment
effect?</em></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">reveg</span>,<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">abund</span><span class="op">$</span><span class="va">Formicidae</span><span class="op">~</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/ex10.8plot-1.png" alt=""><p class="caption">plot of chunk ex10.8plot</p>
</div>
<p>Not really! The ant counts in the control sites are similar to the
middle of those from the revegetated sites.</p>
<p><em>Use the <code>glm</code> function to fit a Poisson log-linear
model, and use this to test for a treatment effect. Did you get what you
expected?</em></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ants_Poisson</span>,test<span class="op">=</span><span class="st">'Chisq'</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: poisson, link: log</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: ants</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Terms added sequentially (first to last)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    </span>
<span class="co">#&gt; NULL                          9     985.74              </span>
<span class="co">#&gt; treatment  1   62.345         8     923.39 2.882e-15 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>Whoah we are being told there is strongly significant evidence of a
treatment effect, a claim that should be treated with suspicion (no such
evidence on the boxplot above!)</p>
<p><em>Now use negative binomial regression to test for a treatment
effect.</em></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ants</span> <span class="op">=</span> <span class="va">reveg</span><span class="op">$</span><span class="va">abund</span><span class="op">$</span><span class="va">Formicidae</span>
<span class="va">ants_NB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">ants</span><span class="op">~</span><span class="va">treatment</span>,data<span class="op">=</span><span class="va">reveg</span>,family<span class="op">=</span><span class="st">"negative.binomial"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ants_NB</span><span class="op">)</span>
<span class="co">#&gt; Time elapsed: 0 hr 0 min 0 sec</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: ants ~ treatment</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate test:</span>
<span class="co">#&gt;             Res.Df Df.diff   Dev Pr(&gt;Dev)</span>
<span class="co">#&gt; (Intercept)      9                       </span>
<span class="co">#&gt; treatment        8       1 0.765     0.56</span>
<span class="co">#&gt; Arguments: P-value calculated using 999 iterations via PIT-trap resampling.</span></code></pre></div>
<p><em>Notice you have got a very different answer.</em></p>
<p>Yeah, like completely the opposite!!!</p>
<p><em>Which answer is more likely to be correct in this case?</em></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ants_NB</span>,which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/ex10.8NBplots-1.png" alt=""><p class="caption">plot of chunk ex10.8NBplots</p>
</div>
<p>Whereas the diagnostic plots for the Poisson model showed serious
problems, we have no such issues here. So the negative binomial
regression is a much better fit to the data. It produced (much!) larger
<span class="math inline">\(P\)</span>-values because there is a lot of
overdispersion in the data, which a Poisson model is unable to account
for.</p>
<p>(Note that the simulation envelopes cover a broad range! This is
because of the small sample size. When comparing these plots to those
for the Poisson fit, notice that the y-axis scale on the negative
binomial plot is much smaller – the envelopes actually have similar
width in both sets of plots, they look different mostly because the axes
have different scales.)</p>
</div>
<div class="section level2">
<h2 id="exercise-10-9-worm-counts-with-different-numbers-of-pitfall-traps">Exercise 10.9: Worm counts with different numbers of pitfall
traps<a class="anchor" aria-label="anchor" href="#exercise-10-9-worm-counts-with-different-numbers-of-pitfall-traps"></a>
</h2>
<p><em>How can we account for the different sampling effort at different
sites in our model?</em></p>
<p>Use an offset for <code>log(pitfalls)</code> as in Code Box 10.9.</p>
</div>
<div class="section level2">
<h2 id="code-box-10-10-adding-an-offset-to-the-model-for-worm-counts-">Code Box 10.10: Adding an offset to the model for worm counts.<a class="anchor" aria-label="anchor" href="#code-box-10-10-adding-an-offset-to-the-model-for-worm-counts-"></a>
</h2>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ftmany_hapoffset</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">Haplotaxida</span><span class="op">~</span><span class="va">treatment</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pitfalls</span><span class="op">)</span><span class="op">)</span>,
                            family<span class="op">=</span><span class="st">"negative.binomial"</span>, data<span class="op">=</span><span class="va">reveg</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ftmany_hapoffset</span><span class="op">)</span>
<span class="co">#&gt; Time elapsed: 0 hr 0 min 0 sec</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: Haplotaxida ~ treatment + offset(log(pitfalls))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate test:</span>
<span class="co">#&gt;             Res.Df Df.diff   Dev Pr(&gt;Dev)</span>
<span class="co">#&gt; (Intercept)      9                       </span>
<span class="co">#&gt; treatment        8       1 2.889    0.157</span>
<span class="co">#&gt; Arguments: P-value calculated using 999 iterations via PIT-trap resampling.</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-10-10-anthonys-cockroaches">Exercise 10.10: Anthony’s cockroaches<a class="anchor" aria-label="anchor" href="#exercise-10-10-anthonys-cockroaches"></a>
</h2>
<p><em>How should he analyse the data?</em></p>
<p>This looks like Exercise 10.9 and so could be analysed a similar way,
assuming assumptions are all satisfied. The main difference here is that
we have many zeros in the dataset (70%)…</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roaches</span> <span class="op">=</span> <span class="va">reveg</span><span class="op">$</span><span class="va">abund</span><span class="op">$</span><span class="va">Blattodea</span>
<span class="va">ftMany_roaches</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manyglm.html" class="external-link">manyglm</a></span><span class="op">(</span><span class="va">roaches</span><span class="op">~</span><span class="va">treatment</span>,offset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pitfalls</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"poisson"</span>, data<span class="op">=</span><span class="va">reveg</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ftMany_roaches</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/ex10.10-1.png" alt=""><p class="caption">plot of chunk ex10.10</p>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ftMany_roaches</span><span class="op">)</span>
<span class="co">#&gt; Time elapsed: 0 hr 0 min 0 sec</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: roaches ~ treatment</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate test:</span>
<span class="co">#&gt;             Res.Df Df.diff   Dev Pr(&gt;Dev)   </span>
<span class="co">#&gt; (Intercept)      9                          </span>
<span class="co">#&gt; treatment        8       1 16.68    0.006 **</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Arguments: P-value calculated using 999 iterations via PIT-trap resampling.</span></code></pre></div>
<p>Although we have many zeros in the dataset, they are all in the
treatment group, meaning that our observed predictor explains these
well. A Poisson model seems to fit the reasonably data well, and we can
conclude that there is very strong evidence of an effect of revegetation
on cockroaches (they disappeared from revegetated plots).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
