<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecostats">
<title>Chapter 5 -- Model selection -- Exercise solutions and Code Boxes • ecostats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 5 -- Model selection -- Exercise solutions and Code Boxes">
<meta property="og:description" content="ecostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecostats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/eco-stats.html">About ecostats</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Chapter Solutions</h6>
    <a class="dropdown-item" href="../articles/Chapter1Solutions.html">Chapter 1 -- 'STATS 101' Revision -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter2Solutions.html">Chapter 2 -- An importance equivalence result -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter3Solutions.html">Chapter 3 -- Regression with multiple predictor variables -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter4Solutions.html">Chapter 4 -- Linear models -- anything goes -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter5Solutions.html">Chapter 5 -- Model selection -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter6Solutions.html">Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter7Solutions.html">Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter8Solutions.html">Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter9Solutions.html">Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter10Solutions.html">Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter11Solutions.html">Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter12Solutions.html">Chapter 12 -- Visualising many responses -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter13Solutions.html">Chapter 13 -- Allometric line-fitting -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter14Solutions.html">Chapter 14 -- Multivariate abundances -- inference about environmental associations -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter15Solutions.html">Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter16Solutions.html">Chapter 16 -- Understanding variation in environmental response across taxa -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter17Solutions.html">Chapter 17 -- Studying co-occurrence patterns -- Exercise solutions and Code Boxes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Glossary of functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dwarton/ecostats">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 5 -- Model selection -- Exercise solutions and Code Boxes</h1>
                        <h4 data-toc-skip class="author">David
Warton</h4>
            
            <h4 data-toc-skip class="date">2022-06-09</h4>
      
      
      <div class="d-none name"><code>Chapter5Solutions.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="exercise-5-1-plant-height-and-climate">Exercise 5.1: Plant height and climate<a class="anchor" aria-label="anchor" href="#exercise-5-1-plant-height-and-climate"></a>
</h3>
<p><em>Which climate variables best explain plant height?</em></p>
<p>This question is about which variables best explain patterns in
height – it is not about hypothesis testing or interval estimation,
instead we want to compare different possible models for plant height,
and so can think of this as a <em>model selection</em> question.</p>
<p>As before, this research question involves several variables:
<em>height</em> (quantitative) and <em>climate</em>. How climate is
measured has not been specified here, but it typically involves
quantitative measurements of temperature, precipitation and often
related variables.</p>
<p>As before we will answer this question using multiple regression, a
type of linear model, and the main question is about which predictors to
add to this linear model.</p>
</div>
<div class="section level3">
<h3 id="figures-5-1-5-2-bias-variance-trade-off-for-polynomial-models">Figures 5.1-5.2: bias-variance trade-off for polynomial models<a class="anchor" aria-label="anchor" href="#figures-5-1-5-2-bias-variance-trade-off-for-polynomial-models"></a>
</h3>
<p>Here is the code behind Figures 5.1-5.2. Because of the small sample
size, you can get quite different answers on different runs! Hence the
seed has been fixed at the values used to generate results in the
text.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sigma</span><span class="op">=</span><span class="fl">1.2</span>
<span class="va">n</span><span class="op">=</span><span class="fl">20</span>
<span class="va">nDegree</span><span class="op">=</span><span class="fl">8</span>

<span class="va">seed</span><span class="op">=</span><span class="fl">61</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span>

<span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">n</span><span class="op">)</span> <span class="op">)</span>
<span class="va">y</span> <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">x</span><span class="op">-</span><span class="fl">3</span><span class="op">*</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="va">sigma</span>
<span class="va">idTrain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">n</span><span class="op">)</span>,<span class="va">n</span><span class="op">)</span>
<span class="va">xTest</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="va">idTrain</span><span class="op">]</span>
<span class="va">yTest</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="op">-</span><span class="va">idTrain</span><span class="op">]</span>
<span class="va">x</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">idTrain</span><span class="op">]</span>
<span class="va">y</span> <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="va">idTrain</span><span class="op">]</span>
<span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>

<span class="va">err</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">nDegree</span><span class="op">)</span>
<span class="va">errTrain</span> <span class="op">=</span> <span class="va">err</span>
<span class="va">whichPlot</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">8</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">whichPlot</span><span class="op">)</span> <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1.5</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span>,mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">whichPlot</span><span class="op">)</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">1</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">dgreen</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.75</span>,<span class="fl">0</span>,names<span class="op">=</span><span class="st">"dgreen"</span><span class="op">)</span>
<span class="va">xpred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,length<span class="op">=</span><span class="fl">500</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">iDegree</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nDegree</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">fti</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">x</span>,degree<span class="op">=</span><span class="va">iDegree</span>,raw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,data<span class="op">=</span><span class="va">X</span><span class="op">)</span>
  <span class="va">err</span><span class="op">[</span><span class="va">iDegree</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span> <span class="op">(</span><span class="va">yTest</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fti</span>,newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">xTest</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">)</span> 
  <span class="va">errTrain</span><span class="op">[</span><span class="va">iDegree</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fti</span><span class="op">$</span><span class="va">residuals</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">iDegree</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">whichPlot</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>,xaxt<span class="op">=</span><span class="st">"n"</span>,yaxt<span class="op">=</span><span class="st">"n"</span>,ylab<span class="op">=</span><span class="st">""</span>,xlab<span class="op">=</span><span class="st">""</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">iDegree</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"y"</span>,<span class="fl">2</span>,line<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span>,line<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>,at<span class="op">=</span><span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">1</span>,labels<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,cex.axis<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>,at<span class="op">=</span><span class="fl">5</span><span class="op">*</span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span>,labels<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,cex.axis<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">yTest</span><span class="op">~</span><span class="va">xTest</span>,col<span class="op">=</span><span class="va">dgreen</span>,pch<span class="op">=</span><span class="st">"*"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xpred</span>,<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fti</span>,newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">xpred</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">whichPlot</span><span class="op">==</span><span class="va">iDegree</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Degree ="</span>,<span class="va">iDegree</span><span class="op">)</span>,<span class="fl">3</span>,line<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Training data"</span>,<span class="st">"Test data"</span><span class="op">)</span>,pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"o"</span>,<span class="st">"*"</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="va">dgreen</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/fig5.1-2-1.png" alt=""><p class="caption">plot of chunk fig5.1-2</p>
</div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">err</span><span class="op">)</span>
<span class="co">#&gt; [1] 10.566356  1.729799  1.742761  1.945641  5.632565  5.681434  7.815761 10.459043</span>


<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.75</span>,<span class="fl">2.75</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span>,mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nDegree</span>,<span class="va">errTrain</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">err</span>,<span class="va">errTrain</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">"Mean squared error"</span>,xlab<span class="op">=</span><span class="st">"Degree of polynomial [log scale]"</span>,xaxt<span class="op">=</span><span class="st">"n"</span>,log<span class="op">=</span><span class="st">"x"</span>,yaxt<span class="op">=</span><span class="st">"n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nDegree</span>,<span class="va">err</span>,col<span class="op">=</span><span class="va">dgreen</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">iDegree</span> <span class="kw">in</span> <span class="va">whichPlot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">iDegree</span>,col.ticks<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">whichPlot</span><span class="op">==</span><span class="va">iDegree</span><span class="op">)</span><span class="op">]</span>,col.axis<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">whichPlot</span><span class="op">==</span><span class="va">iDegree</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Training data"</span>,<span class="st">"Test data"</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="va">dgreen</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/fig5.1-2-2.png" alt=""><p class="caption">plot of chunk fig5.1-2</p>
</div>
</div>
<div class="section level3">
<h3 id="code-box-5-1-using-validation-for-model-selection-using-angelas-plant-height-data">Code Box 5.1: Using validation for model selection using Angela’s
plant height data<a class="anchor" aria-label="anchor" href="#code-box-5-1-using-validation-for-model-selection-using-angelas-plant-height-data"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ecostats</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">indTrain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">n</span>,<span class="va">n</span><span class="op">^</span><span class="fl">0.75</span><span class="op">)</span> <span class="co">#select a training sample of size n^0.75:</span>
<span class="va">datTrain</span> <span class="op">=</span> <span class="va">globalPlants</span><span class="op">[</span><span class="va">indTrain</span>,<span class="op">]</span>
<span class="va">datTest</span> <span class="op">=</span> <span class="va">globalPlants</span><span class="op">[</span><span class="op">-</span><span class="va">indTrain</span>,<span class="op">]</span>
<span class="va">ft_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">rain</span>,dat<span class="op">=</span><span class="va">datTrain</span><span class="op">)</span>
<span class="va">ft_rs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.seas</span>,dat<span class="op">=</span><span class="va">datTrain</span><span class="op">)</span>
<span class="va">pr_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_r</span>,newdata<span class="op">=</span><span class="va">datTest</span><span class="op">)</span>
<span class="va">pr_rs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft_rs</span>,newdata<span class="op">=</span><span class="va">datTest</span><span class="op">)</span>
<span class="va">rss_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">datTest</span><span class="op">$</span><span class="va">height</span><span class="op">)</span><span class="op">-</span><span class="va">pr_r</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">)</span>
<span class="va">rss_rs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">datTest</span><span class="op">$</span><span class="va">height</span><span class="op">)</span><span class="op">-</span><span class="va">pr_rs</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rss_r</span>,<span class="va">rss_rs</span><span class="op">)</span> <span class="op">)</span>
<span class="co">#&gt; [1] 2.668369 2.467766</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-box-5-2-5-fold-cross-validation-for-the-data-of-exercise-5-1">Code Box 5.2: 5-fold cross-validation for the data of Exercise
5.1<a class="anchor" aria-label="anchor" href="#code-box-5-2-5-fold-cross-validation-for-the-data-of-exercise-5-1"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DAAG</span><span class="op">)</span>
<span class="va">ft_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">rain</span>,dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">ft_rs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.seas</span>,dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">cv_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DAAG/man/CVlm.html" class="external-link">cv.lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">globalPlants</span>, <span class="va">ft_r</span>, m<span class="op">=</span><span class="fl">5</span>, printit<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># 5 fold CV</span></code></pre></div>
<div class="figure">
<img src="figure/box52-1.png" alt=""><p class="caption">plot of chunk box52</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cv_rs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DAAG/man/CVlm.html" class="external-link">cv.lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">globalPlants</span>, <span class="va">ft_rs</span>, m<span class="op">=</span><span class="fl">5</span>, printit<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># 5 fold CV</span>
<span class="co">#&gt; Warning in cv.lm(data = globalPlants, ft_rs, m = 5, printit = FALSE): </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  As there is &gt;1 explanatory variable, cross-validation</span>
<span class="co">#&gt;  predicted values for a fold are not a linear function</span>
<span class="co">#&gt;  of corresponding overall predicted values.  Lines that</span>
<span class="co">#&gt;  are shown for the different folds are approximate</span></code></pre></div>
<div class="figure">
<img src="figure/box52-2.png" alt=""><p class="caption">plot of chunk box52</p>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cv_r</span>,<span class="st">"ms"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cv_rs</span>,<span class="st">"ms"</span><span class="op">)</span> <span class="op">)</span>, digits<span class="op">=</span><span class="fl">6</span> <span class="op">)</span>
<span class="co">#&gt; [1] 2.22541 2.15883</span>

<span class="va">cv_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DAAG/man/CVlm.html" class="external-link">cv.lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">globalPlants</span>, <span class="va">ft_r</span>, m<span class="op">=</span><span class="fl">5</span>, printit<span class="op">=</span><span class="cn">FALSE</span>,seed<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="co"># 5 fold CV</span></code></pre></div>
<div class="figure">
<img src="figure/box52-3.png" alt=""><p class="caption">plot of chunk box52</p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cv_rs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DAAG/man/CVlm.html" class="external-link">cv.lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">globalPlants</span>, <span class="va">ft_rs</span>, m<span class="op">=</span><span class="fl">5</span>, printit<span class="op">=</span><span class="cn">FALSE</span>,seed<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="co"># 5 fold CV</span>
<span class="co">#&gt; Warning in cv.lm(data = globalPlants, ft_rs, m = 5, printit = FALSE, seed = 1): </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  As there is &gt;1 explanatory variable, cross-validation</span>
<span class="co">#&gt;  predicted values for a fold are not a linear function</span>
<span class="co">#&gt;  of corresponding overall predicted values.  Lines that</span>
<span class="co">#&gt;  are shown for the different folds are approximate</span></code></pre></div>
<div class="figure">
<img src="figure/box52-4.png" alt=""><p class="caption">plot of chunk box52</p>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cv_r</span>,<span class="st">"ms"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cv_rs</span>,<span class="st">"ms"</span><span class="op">)</span> <span class="op">)</span>, digits<span class="op">=</span><span class="fl">6</span> <span class="op">)</span>
<span class="co">#&gt; [1] 2.21103 2.16553</span>

<span class="va">cv_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DAAG/man/CVlm.html" class="external-link">cv.lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">globalPlants</span>, <span class="va">ft_r</span>, m<span class="op">=</span><span class="fl">5</span>, printit<span class="op">=</span><span class="cn">FALSE</span>,seed<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># 5 fold CV</span></code></pre></div>
<div class="figure">
<img src="figure/box52-5.png" alt=""><p class="caption">plot of chunk box52</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cv_rs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DAAG/man/CVlm.html" class="external-link">cv.lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">globalPlants</span>, <span class="va">ft_rs</span>, m<span class="op">=</span><span class="fl">5</span>, printit<span class="op">=</span><span class="cn">FALSE</span>,seed<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># 5 fold CV</span>
<span class="co">#&gt; Warning in cv.lm(data = globalPlants, ft_rs, m = 5, printit = FALSE, seed = 2): </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  As there is &gt;1 explanatory variable, cross-validation</span>
<span class="co">#&gt;  predicted values for a fold are not a linear function</span>
<span class="co">#&gt;  of corresponding overall predicted values.  Lines that</span>
<span class="co">#&gt;  are shown for the different folds are approximate</span></code></pre></div>
<div class="figure">
<img src="figure/box52-6.png" alt=""><p class="caption">plot of chunk box52</p>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cv_r</span>,<span class="st">"ms"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cv_rs</span>,<span class="st">"ms"</span><span class="op">)</span> <span class="op">)</span>, digits<span class="op">=</span><span class="fl">6</span> <span class="op">)</span>
<span class="co">#&gt; [1] 2.22425 2.14762</span>

<span class="va">cv_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DAAG/man/CVlm.html" class="external-link">cv.lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">globalPlants</span>, <span class="va">ft_r</span>, m<span class="op">=</span><span class="fl">5</span>, printit<span class="op">=</span><span class="cn">FALSE</span>,seed<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="co"># 5 fold CV</span></code></pre></div>
<div class="figure">
<img src="figure/box52-7.png" alt=""><p class="caption">plot of chunk box52</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cv_rs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DAAG/man/CVlm.html" class="external-link">cv.lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">globalPlants</span>, <span class="va">ft_rs</span>, m<span class="op">=</span><span class="fl">5</span>, printit<span class="op">=</span><span class="cn">FALSE</span>,seed<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="co"># 5 fold CV</span>
<span class="co">#&gt; Warning in cv.lm(data = globalPlants, ft_rs, m = 5, printit = FALSE, seed = 3): </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  As there is &gt;1 explanatory variable, cross-validation</span>
<span class="co">#&gt;  predicted values for a fold are not a linear function</span>
<span class="co">#&gt;  of corresponding overall predicted values.  Lines that</span>
<span class="co">#&gt;  are shown for the different folds are approximate</span></code></pre></div>
<div class="figure">
<img src="figure/box52-8.png" alt=""><p class="caption">plot of chunk box52</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cv_r</span>,<span class="st">"ms"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cv_rs</span>,<span class="st">"ms"</span><span class="op">)</span> <span class="op">)</span>, digits<span class="op">=</span><span class="fl">6</span> <span class="op">)</span>
<span class="co">#&gt; [1] 2.2783 2.2373</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-box-5-3-computing-information-criteria-on-r-for-exercise-5-1">Code Box 5.3: Computing Information Criteria on <code>R</code> for
Exercise 5.1<a class="anchor" aria-label="anchor" href="#code-box-5-3-computing-information-criteria-on-r-for-exercise-5-1"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">rain</span>,dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">ft_rs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.seas</span>,dat<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ft_r</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ft_rs</span><span class="op">)</span> <span class="op">)</span>
<span class="co">#&gt; [1] 479.6605 475.4343</span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_r</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_rs</span><span class="op">)</span> <span class="op">)</span>
<span class="co">#&gt; [1] 488.2861 486.9351</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-box-5-4-all-subsets-selection-for-the-plant-height-data-of-5-1">Code Box 5.4: All subsets selection for the plant height data of
5.1<a class="anchor" aria-label="anchor" href="#code-box-5-4-all-subsets-selection-for-the-plant-height-data-of-5-1"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">leaps</span><span class="op">)</span>
<span class="va">fit_heightallsub</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/leaps/man/regsubsets.html" class="external-link">regsubsets</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">temp</span><span class="op">+</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.wetm</span><span class="op">+</span><span class="va">temp.seas</span>,
  data<span class="op">=</span><span class="va">globalPlants</span>,nbest<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_heightallsub</span><span class="op">)</span><span class="op">$</span><span class="va">outmat</span>,<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_heightallsub</span><span class="op">)</span><span class="op">$</span><span class="va">bic</span><span class="op">)</span>
<span class="co">#&gt;          temp rain rain.wetm temp.seas                    </span>
<span class="co">#&gt; 1  ( 1 ) " "  " "  "*"       " "       "-21.06175277099"  </span>
<span class="co">#&gt; 1  ( 2 ) " "  "*"  " "       " "       "-19.2868231448677"</span>
<span class="co">#&gt; 2  ( 1 ) "*"  "*"  " "       " "       "-24.8920679441895"</span>
<span class="co">#&gt; 2  ( 2 ) "*"  " "  "*"       " "       "-23.9315826810965"</span>
<span class="co">#&gt; 3  ( 1 ) "*"  "*"  " "       "*"       "-20.9786934545272"</span>
<span class="co">#&gt; 3  ( 2 ) "*"  "*"  "*"       " "       "-20.3405400349995"</span>
<span class="co">#&gt; 4  ( 1 ) "*"  "*"  "*"       "*"       "-16.4229239023018"</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-box-5-5-stepwise-subset-selection-for-the-plant-height-data-of-5-1">Code Box 5.5: Stepwise subset selection for the plant height data of
5.1<a class="anchor" aria-label="anchor" href="#code-box-5-5-stepwise-subset-selection-for-the-plant-height-data-of-5-1"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_clim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">temp</span><span class="op">+</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.wetm</span><span class="op">+</span><span class="va">temp.seas</span>,
   data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">stepClim</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/step.html" class="external-link">step</a></span><span class="op">(</span><span class="va">ft_clim</span>,trace<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="va">stepClim</span><span class="op">$</span><span class="va">anova</span>
<span class="co">#&gt;          Step Df  Deviance Resid. Df Resid. Dev       AIC</span>
<span class="co">#&gt; 1             NA        NA       126   260.6727 100.13694</span>
<span class="co">#&gt; 2 - rain.wetm  1 0.6363946       127   261.3091  98.45637</span>
<span class="co">#&gt; 3 - temp.seas  1 1.9256333       128   263.2347  97.41819</span>

<span class="va">ft_int</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">stepForward</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html" class="external-link">step</a></span><span class="op">(</span><span class="va">ft_int</span>,scope<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">ft_clim</span><span class="op">)</span>,direction<span class="op">=</span><span class="st">"forward"</span>,
    trace<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="va">stepForward</span><span class="op">$</span><span class="va">anova</span>
<span class="co">#&gt;          Step Df Deviance Resid. Df Resid. Dev       AIC</span>
<span class="co">#&gt; 1             NA       NA       130   355.9206 132.93585</span>
<span class="co">#&gt; 2 + rain.wetm -1 74.59845       129   281.3221 104.12370</span>
<span class="co">#&gt; 3      + temp -1 16.15030       128   265.1718  98.37867</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation-code-for-figure-5-4">Simulation code for Figure 5.4<a class="anchor" aria-label="anchor" href="#simulation-code-for-figure-5-4"></a>
</h3>
<p>I used <code>nSim=1000</code> in the book, but have set it to
<code>50</code> here so the code doesn’t take ages to run…</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://mvtnorm.R-forge.R-project.org" class="external-link">mvtnorm</a></span><span class="op">)</span>
<span class="va">nSim</span> <span class="op">=</span> <span class="fl">50</span> <span class="co"># increase this for a more precise answer </span>
<span class="va">p</span><span class="op">=</span><span class="fl">8</span>
<span class="va">n</span><span class="op">=</span><span class="fl">32</span>

<span class="va">beta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">p</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">pTrue</span><span class="op">=</span><span class="fl">2</span>

<span class="va">rho</span><span class="op">=</span><span class="fl">0.5</span>
<span class="va">Sigma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">rho</span>,<span class="va">p</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="va">rho</span>
<span class="va">X</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="va">n</span>,sigma<span class="op">=</span><span class="va">Sigma</span><span class="op">)</span>
<span class="va">eta</span> <span class="op">=</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html" class="external-link">%*%</a></span> <span class="va">beta</span>


<span class="va">resArray</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="va">nSim</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">resArray</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AIC"</span>,<span class="st">"MStrue"</span>,<span class="st">"propTrue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">resArray</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>,<span class="st">"for"</span>,<span class="st">"back"</span><span class="op">)</span>
<span class="va">counter</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">iSim</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nSim</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">y</span> <span class="op">=</span> <span class="va">eta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span>

  <span class="co"># construct matrix of all possible subsets</span>
  <span class="va">allSubs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">2</span><span class="op">^</span><span class="va">p</span>,<span class="va">p</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">iVar</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">)</span>
    <span class="va">allSubs</span><span class="op">[</span>,<span class="va">iVar</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="va">iVar</span><span class="op">)</span>,times<span class="op">=</span><span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="va">iVar</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

  <span class="co"># define vectors to stor AIC and MS</span>
  <span class="va">aics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">2</span><span class="op">^</span><span class="va">p</span><span class="op">)</span>
  <span class="va">ms</span>   <span class="op">=</span> <span class="va">aics</span>
  <span class="va">isTrue</span><span class="op">=</span><span class="va">aics</span>

  <span class="co"># intercept first as it will give error</span>
  <span class="va">ft0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span>
  <span class="va">aics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ft0</span><span class="op">)</span>
  <span class="va">ms</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft0</span><span class="op">)</span><span class="op">-</span><span class="va">eta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">isTrue</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="cn">FALSE</span>

  <span class="co"># now get all subset results</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">iModel</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">2</span><span class="op">^</span><span class="va">p</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="va">ft</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">X</span><span class="op">[</span>,<span class="va">allSubs</span><span class="op">[</span><span class="va">iModel</span>,<span class="op">]</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
    <span class="va">aics</span><span class="op">[</span><span class="va">iModel</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ft</span><span class="op">)</span>
    <span class="va">ms</span><span class="op">[</span><span class="va">iModel</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ft</span><span class="op">)</span><span class="op">-</span><span class="va">eta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
    <span class="va">isTrue</span><span class="op">[</span><span class="va">iModel</span><span class="op">]</span> <span class="op">=</span> <span class="va">allSubs</span><span class="op">[</span><span class="va">iModel</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">allSubs</span><span class="op">[</span><span class="va">iModel</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">allSubs</span><span class="op">[</span><span class="va">iModel</span>,<span class="op">]</span><span class="op">)</span><span class="op">==</span><span class="fl">2</span>
  <span class="op">}</span>

  <span class="va">whichBest</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">aics</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">aics</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co">#if tie take the first one, probably smaller, but whatever this won't happen</span>

  <span class="co"># now backward stepwise</span>
  <span class="va">ftBack</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html" class="external-link">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>,data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>,trace<span class="op">=</span><span class="fl">0</span>,direction<span class="op">=</span><span class="st">"backward"</span><span class="op">)</span>
  <span class="va">aicBack</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ftBack</span><span class="op">)</span>
  <span class="va">msBack</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ftBack</span><span class="op">)</span><span class="op">-</span><span class="va">eta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">trueBack</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ftBack</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="fl">3</span> <span class="op">&amp;</span> <span class="st">"X1"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ftBack</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="st">"X2"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ftBack</span><span class="op">)</span><span class="op">)</span>

  <span class="co"># now forward stepwise</span>
  <span class="va">scopeForm</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X"</span>,<span class="fl">1</span><span class="op">:</span><span class="va">p</span>,collapse<span class="op">=</span><span class="st">"+"</span><span class="op">)</span>
  <span class="va">ftFor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html" class="external-link">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fl">1</span>,data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>,scope<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"~"</span>,<span class="va">scopeForm</span><span class="op">)</span>,trace<span class="op">=</span><span class="fl">0</span>,direction<span class="op">=</span><span class="st">"forward"</span><span class="op">)</span>
  <span class="va">aicFor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ftFor</span><span class="op">)</span>
  <span class="va">msFor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ftFor</span><span class="op">)</span><span class="op">-</span><span class="va">eta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">trueFor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ftFor</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="fl">3</span> <span class="op">&amp;</span> <span class="st">"X1"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ftFor</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="st">"X2"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ftFor</span><span class="op">)</span><span class="op">)</span>

  <span class="va">counterAdd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>
  <span class="va">resArray</span><span class="op">[</span><span class="fl">1</span>,,<span class="va">iSim</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">aics</span><span class="op">[</span><span class="va">whichBest</span><span class="op">]</span>,<span class="va">aicFor</span>,<span class="va">aicBack</span><span class="op">)</span>
  <span class="va">resArray</span><span class="op">[</span><span class="fl">2</span>,,<span class="va">iSim</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ms</span><span class="op">[</span><span class="va">whichBest</span><span class="op">]</span>,<span class="va">msFor</span>,<span class="va">msBack</span><span class="op">)</span>
  <span class="va">resArray</span><span class="op">[</span><span class="fl">3</span>,,<span class="va">iSim</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">isTrue</span><span class="op">[</span><span class="va">whichBest</span><span class="op">]</span>,<span class="va">trueFor</span>,<span class="va">trueBack</span><span class="op">)</span>

  <span class="va">eps</span><span class="op">=</span><span class="fl">1.e-8</span>
  <span class="va">whichAIC</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">resArray</span><span class="op">[</span><span class="fl">1</span>,,<span class="va">iSim</span><span class="op">]</span><span class="op">&lt;</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">resArray</span><span class="op">[</span><span class="fl">1</span>,,<span class="va">iSim</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="va">eps</span><span class="op">)</span>
  <span class="va">counterAdd</span><span class="op">[</span><span class="fl">1</span>,<span class="va">whichAIC</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">whichMS</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">resArray</span><span class="op">[</span><span class="fl">2</span>,,<span class="va">iSim</span><span class="op">]</span><span class="op">&lt;</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">resArray</span><span class="op">[</span><span class="fl">2</span>,,<span class="va">iSim</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="va">eps</span><span class="op">)</span>
  <span class="va">counterAdd</span><span class="op">[</span><span class="fl">2</span>,<span class="va">whichMS</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">counterAdd</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span> <span class="op">=</span> <span class="va">resArray</span><span class="op">[</span><span class="fl">3</span>,,<span class="va">iSim</span><span class="op">]</span>

  <span class="va">counter</span> <span class="op">=</span> <span class="va">counter</span> <span class="op">+</span> <span class="va">counterAdd</span>
<span class="op">}</span>
<span class="co">#end sim</span>

<span class="va">resMean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">resArray</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span>
<span class="va">resSD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">resArray</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">sd</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">nSim</span><span class="op">)</span>
<span class="va">counter</span> <span class="op">=</span> <span class="va">counter</span><span class="op">/</span><span class="va">nSim</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">resMean</span><span class="op">)</span>
<span class="co">#&gt;                  all         for       back</span>
<span class="co">#&gt; AIC      135.6532644 135.9232694 135.750229</span>
<span class="co">#&gt; MStrue     0.9629137   0.9017192   1.001753</span>
<span class="co">#&gt; propTrue   0.1400000   0.1600000   0.120000</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span>,mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resMean</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">3.5</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span>,yaxt<span class="op">=</span><span class="st">"n"</span>,pch<span class="op">=</span><span class="fl">19</span>,xlab<span class="op">=</span><span class="st">"AIC"</span>,ylab<span class="op">=</span><span class="st">""</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">resMean</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">resSD</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>,<span class="va">resMean</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">+</span><span class="fl">2</span><span class="op">*</span><span class="va">resSD</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">iMethod</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">resMean</span><span class="op">[</span><span class="fl">1</span>,<span class="va">iMethod</span><span class="op">]</span><span class="op">-</span><span class="va">resSD</span><span class="op">[</span><span class="fl">1</span>,<span class="va">iMethod</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span>,<span class="va">resMean</span><span class="op">[</span><span class="fl">1</span>,<span class="va">iMethod</span><span class="op">]</span><span class="op">+</span><span class="va">resSD</span><span class="op">[</span><span class="fl">1</span>,<span class="va">iMethod</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">iMethod</span>,<span class="va">iMethod</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>,at<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All subsets"</span>,<span class="st">"Forward"</span>,<span class="st">"Backward"</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resMean</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">3.5</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span>,yaxt<span class="op">=</span><span class="st">"n"</span>,pch<span class="op">=</span><span class="fl">19</span>,xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Mean squared error of "</span>,<span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">""</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">resMean</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">resSD</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,<span class="va">resMean</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">+</span><span class="fl">2</span><span class="op">*</span><span class="va">resSD</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">iMethod</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">resMean</span><span class="op">[</span><span class="fl">2</span>,<span class="va">iMethod</span><span class="op">]</span><span class="op">-</span><span class="va">resSD</span><span class="op">[</span><span class="fl">2</span>,<span class="va">iMethod</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span>,<span class="va">resMean</span><span class="op">[</span><span class="fl">2</span>,<span class="va">iMethod</span><span class="op">]</span><span class="op">+</span><span class="va">resSD</span><span class="op">[</span><span class="fl">2</span>,<span class="va">iMethod</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">iMethod</span>,<span class="va">iMethod</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>,at<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span>,<span class="st">" "</span>,<span class="st">" "</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/subsetsim-1.png" alt=""><p class="caption">plot of chunk subsetsim</p>
</div>
</div>
<div class="section level3">
<h3 id="code-box-5-6-lasso-for-plant-height-data-of-5-1">Code Box 5.6: LASSO for plant height data of 5.1<a class="anchor" aria-label="anchor" href="#code-box-5-6-lasso-for-plant-height-data-of-5-1"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span>
<span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">$</span><span class="va">temp</span>, <span class="va">globalPlants</span><span class="op">$</span><span class="va">rain</span>, <span class="va">globalPlants</span><span class="op">$</span><span class="va">rain.wetm</span>,
   <span class="va">globalPlants</span><span class="op">$</span><span class="va">temp.seas</span><span class="op">)</span>
<span class="va">ft_heightcv</span><span class="op">=</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">X</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">$</span><span class="va">height</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ft_heightcv</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/box5.6-1.png" alt=""><p class="caption">plot of chunk box5.6</p>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_lasso</span><span class="op">=</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span><span class="va">X</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">$</span><span class="va">height</span><span class="op">)</span>,lambda<span class="op">=</span><span class="va">ft_heightcv</span><span class="op">$</span><span class="va">lambda.min</span><span class="op">)</span>
<span class="va">ft_lasso</span><span class="op">$</span><span class="va">beta</span>
<span class="co">#&gt; 4 x 1 sparse Matrix of class "dgCMatrix"</span>
<span class="co">#&gt;              s0</span>
<span class="co">#&gt; V1 0.0424080540</span>
<span class="co">#&gt; V2 0.0003785307</span>
<span class="co">#&gt; V3 0.0014047575</span>
<span class="co">#&gt; V4 .</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exercise-5-2-relative-importance-of-climate-variables">Exercise 5.2: Relative importance of climate variables<a class="anchor" aria-label="anchor" href="#exercise-5-2-relative-importance-of-climate-variables"></a>
</h3>
<p><em>How important are the different climate variables in explaining
plant height?</em></p>
<p>We are asked to quantify variable importance. A couple of techniques
are suggested in Code Boxes 5.8-5.9.</p>
</div>
<div class="section level3">
<h3 id="code-box-5-7-sequential-r2-for-variable-importance">Code Box 5.7: Sequential <span class="math inline">\(R^2\)</span>
for variable importance<a class="anchor" aria-label="anchor" href="#code-box-5-7-sequential-r2-for-variable-importance"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_clim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">temp</span><span class="op">+</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.wetm</span><span class="op">+</span><span class="va">temp.seas</span>,data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">ft_int</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">stepAnova</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html" class="external-link">step</a></span><span class="op">(</span><span class="va">ft_int</span>, scope<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">ft_clim</span><span class="op">)</span>, direction<span class="op">=</span><span class="st">"forward"</span>,
                     trace<span class="op">=</span><span class="fl">0</span>, k<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">anova</span>
<span class="va">stepAnova</span><span class="op">$</span><span class="va">R2</span> <span class="op">=</span> <span class="va">stepAnova</span><span class="op">$</span><span class="va">Deviance</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">ft_int</span><span class="op">)</span>
<span class="va">stepAnova</span>
<span class="co">#&gt;          Step Df  Deviance Resid. Df Resid. Dev       AIC          R2</span>
<span class="co">#&gt; 1             NA        NA       130   355.9206 130.93585          NA</span>
<span class="co">#&gt; 2 + rain.wetm -1 74.598450       129   281.3221 100.12370 0.209592965</span>
<span class="co">#&gt; 3      + temp -1 16.150298       128   265.1718  92.37867 0.045376129</span>
<span class="co">#&gt; 4      + rain -1  2.586703       127   262.5851  91.09452 0.007267641</span>
<span class="co">#&gt; 5 + temp.seas -1  1.912441       126   260.6727  90.13694 0.005373225</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-box-5-8-marginal-and-conditional-r2-for-variable-importance">Code Box 5.8: Marginal and conditional <span class="math inline">\(R^2\)</span> for variable importance<a class="anchor" aria-label="anchor" href="#code-box-5-8-marginal-and-conditional-r2-for-variable-importance"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stepMargin</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/add1.html" class="external-link">add1</a></span><span class="op">(</span><span class="va">ft_int</span>,scope<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">ft_clim</span><span class="op">)</span><span class="op">)</span>
<span class="va">stepMargin</span><span class="op">$</span><span class="va">R2</span><span class="op">=</span><span class="va">stepMargin</span><span class="op">$</span><span class="va">`Sum of Sq`</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">ft_int</span><span class="op">)</span>
<span class="va">stepMargin</span>
<span class="co">#&gt; Single term additions</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt; log(height) ~ 1</span>
<span class="co">#&gt;           Df Sum of Sq    RSS    AIC      R2</span>
<span class="co">#&gt; &lt;none&gt;                 355.92 132.94        </span>
<span class="co">#&gt; temp       1    66.224 289.70 107.97 0.18607</span>
<span class="co">#&gt; rain       1    70.761 285.16 105.90 0.19881</span>
<span class="co">#&gt; rain.wetm  1    74.598 281.32 104.12 0.20959</span>
<span class="co">#&gt; temp.seas  1    46.401 309.52 116.64 0.13037</span>

<span class="va">leave1out</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/add1.html" class="external-link">drop1</a></span><span class="op">(</span><span class="va">ft_clim</span><span class="op">)</span>
<span class="va">leave1out</span><span class="op">$</span><span class="va">R2</span><span class="op">=</span><span class="va">leave1out</span><span class="op">$</span><span class="va">`Sum of Sq`</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">ft_int</span><span class="op">)</span>
<span class="va">leave1out</span>
<span class="co">#&gt; Single term deletions</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt; log(height) ~ temp + rain + rain.wetm + temp.seas</span>
<span class="co">#&gt;           Df Sum of Sq    RSS     AIC       R2</span>
<span class="co">#&gt; &lt;none&gt;                 260.67 100.137         </span>
<span class="co">#&gt; temp       1   16.0581 276.73 105.968 0.045117</span>
<span class="co">#&gt; rain       1    3.4438 264.12  99.856 0.009676</span>
<span class="co">#&gt; rain.wetm  1    0.6364 261.31  98.456 0.001788</span>
<span class="co">#&gt; temp.seas  1    1.9124 262.58  99.095 0.005373</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-box-5-9-standardised-coefficients-for-angelas-height-data">Code Box 5.9: Standardised coefficients for Angela’s height
data<a class="anchor" aria-label="anchor" href="#code-box-5-9-standardised-coefficients-for-angelas-height-data"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first create a dataset with standardised predictors:</span>
<span class="va">globalPlantStand</span><span class="op">=</span><span class="va">globalPlants</span>
<span class="va">whichVars</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp"</span>,<span class="st">"rain"</span>,<span class="st">"rain.wetm"</span>,<span class="st">"temp.seas"</span><span class="op">)</span>
<span class="va">globalPlantStand</span><span class="op">[</span>,<span class="va">whichVars</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">globalPlantStand</span><span class="op">[</span>,<span class="va">whichVars</span><span class="op">]</span><span class="op">)</span>
<span class="co"># then fit the model:</span>
<span class="va">ft_climStand</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">temp</span><span class="op">+</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.wetm</span><span class="op">+</span><span class="va">temp.seas</span>,
               data<span class="op">=</span><span class="va">globalPlantStand</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_climStand</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = log(height) ~ temp + rain + rain.wetm + temp.seas, </span>
<span class="co">#&gt;     data = globalPlantStand)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -2.9649 -1.0454 -0.0122  0.9801  3.4005 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   1.1947     0.1257   9.507  &lt; 2e-16 ***</span>
<span class="co">#&gt; temp          0.5715     0.2051   2.786  0.00616 ** </span>
<span class="co">#&gt; rain          0.4185     0.3244   1.290  0.19934    </span>
<span class="co">#&gt; rain.wetm     0.1860     0.3353   0.555  0.58013    </span>
<span class="co">#&gt; temp.seas     0.2090     0.2174   0.961  0.33816    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 1.438 on 126 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.2676, Adjusted R-squared:  0.2444 </span>
<span class="co">#&gt; F-statistic: 11.51 on 4 and 126 DF,  p-value: 5.378e-08</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exercise-5-3-variable-importance-output">Exercise 5.3: Variable importance output<a class="anchor" aria-label="anchor" href="#exercise-5-3-variable-importance-output"></a>
</h3>
<p><em>Compare the <span class="math inline">\(R^2\)</span> results of
Code Boxes 5.7-5.8. Which table(s) do you think Angela should report
when describing variable importance?</em></p>
<p>This is a tough one – I guess the main story is that:</p>
<ol style="list-style-type: decimal">
<li>a rain variable (whether <code>rain</code> or
<code>rain.wetm</code>) explains a big hcunk of variation</li>
<li>
<code>temp</code> explains a fair bit of variation even after rain
variables are in the model</li>
</ol>
<p>The most concise way to make these points would be to show the
marginal <span class="math inline">\(R^2\)</span> table to make point 1,
and the conditional <span class="math inline">\(R^2\)</span> table to
make point 2.</p>
<p><em>Now look at the standardised coefficients in Code Box 5.9. Do
these coefficients measure marginal or conditional effects? Which of the
<span class="math inline">\(R^2\)</span> tables in Code Box 5.8 are they
most similar to in relative size (e.g. ranking from largest to
smallest)? Is this what you expected?</em></p>
<p>The <code>summary</code> function tells us about the coefficients in
the model, which always measure <em>conditional</em> effects after all
other terms have been added to the model. The conditional <span class="math inline">\(R^2\)</span> table gives the most similar answers,
with the same ranking of predictors (largest to smallest). The
standardised coefficient for<code>rain.wetm</code> is larger than I
expected, and for <code>temp</code> it is smaller than I expected, from
looking at the conditional <span class="math inline">\(R^2\)</span>
values. I guess this is because of differences in the extent of
collinearity across predictors.</p>
</div>
<div class="section level3">
<h3 id="code-box-5-10-importance-of-temperature-vs-rainfall">Code Box 5.10: Importance of temperature vs rainfall<a class="anchor" aria-label="anchor" href="#code-box-5-10-importance-of-temperature-vs-rainfall"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_onlyTemp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">temp</span><span class="op">+</span><span class="va">temp.seas</span>,data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">tempAn</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_int</span>,<span class="va">ft_onlyTemp</span>,<span class="va">ft_clim</span><span class="op">)</span>
<span class="va">tempAn</span><span class="op">$</span><span class="va">R2</span><span class="op">=</span><span class="va">tempAn</span><span class="op">$</span><span class="va">`Sum of Sq`</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">ft_int</span><span class="op">)</span>
<span class="va">tempAn</span>
<span class="co">#&gt; Analysis of Variance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model 1: log(height) ~ 1</span>
<span class="co">#&gt; Model 2: log(height) ~ temp + temp.seas</span>
<span class="co">#&gt; Model 3: log(height) ~ temp + rain + rain.wetm + temp.seas</span>
<span class="co">#&gt;   Res.Df    RSS Df Sum of Sq      F     Pr(&gt;F)       R2</span>
<span class="co">#&gt; 1    130 355.92                                        </span>
<span class="co">#&gt; 2    128 289.00  2    66.917 16.173 0.00000056 0.188011</span>
<span class="co">#&gt; 3    126 260.67  2    28.331  6.847 0.00150359 0.079599</span>

<span class="va">ft_onlyRain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">~</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.wetm</span>,data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">rainAn</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_int</span>,<span class="va">ft_onlyRain</span>,<span class="va">ft_clim</span><span class="op">)</span>
<span class="va">rainAn</span><span class="op">$</span><span class="va">R2</span><span class="op">=</span><span class="va">rainAn</span><span class="op">$</span><span class="va">`Sum of Sq`</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">ft_int</span><span class="op">)</span>
<span class="va">rainAn</span>
<span class="co">#&gt; Analysis of Variance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model 1: log(height) ~ 1</span>
<span class="co">#&gt; Model 2: log(height) ~ rain + rain.wetm</span>
<span class="co">#&gt; Model 3: log(height) ~ temp + rain + rain.wetm + temp.seas</span>
<span class="co">#&gt;   Res.Df    RSS Df Sum of Sq       F    Pr(&gt;F)       R2</span>
<span class="co">#&gt; 1    130 355.92                                        </span>
<span class="co">#&gt; 2    128 279.80  2    76.118 18.3964 0.0000001 0.213863</span>
<span class="co">#&gt; 3    126 260.67  2    19.130  4.6233 0.0115445 0.053747</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-for-figure-5-5">Code for Figure 5.5<a class="anchor" aria-label="anchor" href="#code-for-figure-5-5"></a>
</h2>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.75</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">R2sTemp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">tempAn</span><span class="op">$</span><span class="va">R2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
  <span class="va">R2sRain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rainAn</span><span class="op">$</span><span class="va">R2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rainAn</span><span class="op">$</span><span class="va">R2</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="va">R2error</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rainAn</span><span class="op">$</span><span class="va">R2</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>
  <span class="va">darkBlue</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span>,alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>
  <span class="va">darkRed</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0</span>,<span class="fl">0</span>,alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>
  <span class="va">darkYellow</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0</span>,alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"n"</span>,yaxt<span class="op">=</span><span class="st">"n"</span>,xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">R</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">""</span>,bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">R2error</span>,<span class="va">R2error</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,alpha<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">0.25</span>,border<span class="op">=</span><span class="va">darkYellow</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">R2sTemp</span>,<span class="va">R2sTemp</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,alpha<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>,border<span class="op">=</span><span class="va">darkRed</span>,lwd<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">R2sRain</span>,<span class="va">R2sRain</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>,border<span class="op">=</span><span class="va">darkBlue</span>,lwd<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
  <span class="va">yText</span><span class="op">=</span><span class="fl">0.15</span>
  <span class="va">eps</span><span class="op">=</span><span class="fl">0.008</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">R2error</span><span class="op">)</span>,<span class="fl">0.5</span>,<span class="st">'Unexplained'</span>,adj<span class="op">=</span><span class="fl">0.5</span>,col<span class="op">=</span><span class="va">darkYellow</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">eps</span>,<span class="va">yText</span>,<span class="st">'Temperature'</span>,adj<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="va">darkRed</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">R2sRain</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">eps</span>,<span class="fl">1</span><span class="op">-</span><span class="va">yText</span>,<span class="st">'Rainfall'</span>,adj<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="va">darkBlue</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/fig5.5-1.png" alt=""><p class="caption">plot of chunk fig5.5</p>
</div>
<div class="section level3">
<h3 id="exercise-5-4-head-bobs-in-lizards-do-their-displays-change-with-the-environment">Exercise 5.4: Head bobs in lizards – do their displays change with
the environment?<a class="anchor" aria-label="anchor" href="#exercise-5-4-head-bobs-in-lizards-do-their-displays-change-with-the-environment"></a>
</h3>
<p><em>Terry… wanted to know which environmental features (out of
temperature, light and noisiness) were related to head bobbing
speed</em></p>
<p>This is a model selection question, we want to see which
environmental variables are associated with head-bobbing, so will try a
bunch of different models with different predictors to see which one(s)
fits best.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">headbobLizards</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">headbobLizards</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    14 obs. of  10 variables:</span>
<span class="co">#&gt;  $ LizardID           : Factor w/ 14 levels "6","7","8","9",..: 1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">#&gt;  $ Observation        : num  1 1 1 1 1 3.1 1 5 2 1 ...</span>
<span class="co">#&gt;  $ Display            : int  3 1 1 1 1 1 1 2 1 2 ...</span>
<span class="co">#&gt;  $ ObservationDate    : Factor w/ 19 levels "03-07-05","04-07-05",..: 1 2 1 1 1 3 1 2 3 1 ...</span>
<span class="co">#&gt;  $ ObservationTime24hr: Factor w/ 342 levels "10:00","10:03",..: 186 325 205 243 232 173 300 191 305 165 ...</span>
<span class="co">#&gt;  $ TemperatureC       : num  25.7 27.2 26.2 26.2 26 27.6 26.2 27.1 27 28.1 ...</span>
<span class="co">#&gt;  $ AmbientLight       : num  0.47 4.13 2.46 0.31 2.36 ...</span>
<span class="co">#&gt;  $ Bg_noise_max       : num  11.1 16.47 9.32 2.29 7.37 ...</span>
<span class="co">#&gt;  $ Hbspd_max          : num  29.7 54.4 34.6 26.7 28.7 ...</span>
<span class="co">#&gt;  $ time               : POSIXct, format: "2005-07-03 15:44:00" "2005-07-04 09:33:00" "2005-07-03 16:18:00" "2005-07-03 17:50:00" ...</span>

<span class="co"># try some AIC funny-business</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Hbspd_max</span><span class="op">~</span><span class="va">TemperatureC</span>,data<span class="op">=</span><span class="va">headbobLizards</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Hbspd_max</span><span class="op">~</span><span class="va">Bg_noise_max</span>,data<span class="op">=</span><span class="va">headbobLizards</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/headbobs-1.png" alt=""><p class="caption">plot of chunk headbobs</p>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># my vote is log-transformation, covers almost a factor of 3 and a bit of right-skew:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Hbspd_max</span><span class="op">~</span><span class="va">TemperatureC</span>,data<span class="op">=</span><span class="va">headbobLizards</span>,log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Hbspd_max</span><span class="op">~</span><span class="va">Bg_noise_max</span>,data<span class="op">=</span><span class="va">headbobLizards</span>,log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/headbobs-2.png" alt=""><p class="caption">plot of chunk headbobs</p>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">headbobLizards</span><span class="op">$</span><span class="va">bobspeed</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">headbobLizards</span><span class="op">$</span><span class="va">Hbspd_max</span><span class="op">)</span>
<span class="va">ft_headbob</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">bobspeed</span><span class="op">~</span><span class="va">TemperatureC</span><span class="op">+</span><span class="va">AmbientLight</span><span class="op">+</span><span class="va">Bg_noise_max</span>,data<span class="op">=</span><span class="va">headbobLizards</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_headbob</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/headbobs-3.png" alt=""><p class="caption">plot of chunk headbobs</p>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/stepAIC.html" class="external-link">stepAIC</a></span><span class="op">(</span><span class="va">ft_headbob</span><span class="op">)</span>
<span class="co">#&gt; Start:  AIC=-35.58</span>
<span class="co">#&gt; bobspeed ~ TemperatureC + AmbientLight + Bg_noise_max</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                Df Sum of Sq     RSS     AIC</span>
<span class="co">#&gt; - Bg_noise_max  1  0.018757 0.64139 -37.164</span>
<span class="co">#&gt; &lt;none&gt;                      0.62264 -35.580</span>
<span class="co">#&gt; - AmbientLight  1  0.113540 0.73618 -35.235</span>
<span class="co">#&gt; - TemperatureC  1  0.193576 0.81621 -33.790</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=-37.16</span>
<span class="co">#&gt; bobspeed ~ TemperatureC + AmbientLight</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                Df Sum of Sq     RSS     AIC</span>
<span class="co">#&gt; &lt;none&gt;                      0.64139 -37.164</span>
<span class="co">#&gt; - AmbientLight  1   0.14217 0.78356 -36.361</span>
<span class="co">#&gt; - TemperatureC  1   0.46327 1.10466 -31.553</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = bobspeed ~ TemperatureC + AmbientLight, data = headbobLizards)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;  (Intercept)  TemperatureC  AmbientLight  </span>
<span class="co">#&gt;    -1.930275      0.210716     -0.009144</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_headbob</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = bobspeed ~ TemperatureC + AmbientLight + Bg_noise_max, </span>
<span class="co">#&gt;     data = headbobLizards)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;      Min       1Q   Median       3Q      Max </span>
<span class="co">#&gt; -0.29881 -0.15097 -0.02893  0.07918  0.43165 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="co">#&gt; (Intercept)  -1.085254   2.581853  -0.420    0.683</span>
<span class="co">#&gt; TemperatureC  0.176014   0.099825   1.763    0.108</span>
<span class="co">#&gt; AmbientLight -0.008383   0.006208  -1.350    0.207</span>
<span class="co">#&gt; Bg_noise_max  0.006418   0.011693   0.549    0.595</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 0.2495 on 10 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.4611, Adjusted R-squared:  0.2994 </span>
<span class="co">#&gt; F-statistic: 2.852 on 3 and 10 DF,  p-value: 0.09115</span>

<span class="va">ft_2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">bobspeed</span><span class="op">~</span><span class="va">TemperatureC</span><span class="op">+</span><span class="va">AmbientLight</span>,data<span class="op">=</span><span class="va">headbobLizards</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_2</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = bobspeed ~ TemperatureC + AmbientLight, data = headbobLizards)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;      Min       1Q   Median       3Q      Max </span>
<span class="co">#&gt; -0.30317 -0.15088 -0.03001  0.07111  0.45789 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)  </span>
<span class="co">#&gt; (Intercept)  -1.930275   2.005678  -0.962   0.3565  </span>
<span class="co">#&gt; TemperatureC  0.210716   0.074756   2.819   0.0167 *</span>
<span class="co">#&gt; AmbientLight -0.009144   0.005856  -1.561   0.1467  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 0.2415 on 11 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.4448, Adjusted R-squared:  0.3439 </span>
<span class="co">#&gt; F-statistic: 4.407 on 2 and 11 DF,  p-value: 0.0393</span>

<span class="va">ft_int</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">bobspeed</span><span class="op">~</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">headbobLizards</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">ft_int</span>,<span class="va">ft_2</span>,<span class="va">ft_headbob</span><span class="op">)</span>
<span class="co">#&gt;            df       BIC</span>
<span class="co">#&gt; ft_int      2 10.082646</span>
<span class="co">#&gt; ft_2        4  7.122104</span>
<span class="co">#&gt; ft_headbob  5  9.345644</span></code></pre></div>
<p>There’s actually a suggestion of non-linearity here, there are only a
few points making that pattern though so I’m not sure. Also not sure if
that makes sense, for lizards to get most active at an intermediate
temperature, would need to check with Terry on that one…</p>
<p>But in any case, the main story seems to be that noisiness doesn’t
seem that important, it is more about temperature and light. Some <span class="math inline">\(R^2\)</span> values might help understand variable
relative importance:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stepMargin</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/add1.html" class="external-link">add1</a></span><span class="op">(</span><span class="va">ft_int</span>,scope<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">ft_headbob</span><span class="op">)</span><span class="op">)</span>
<span class="va">stepMargin</span><span class="op">$</span><span class="va">R2</span><span class="op">=</span><span class="va">stepMargin</span><span class="op">$</span><span class="va">`Sum of Sq`</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">ft_int</span><span class="op">)</span>
<span class="va">stepMargin</span>
<span class="co">#&gt; Single term additions</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt; bobspeed ~ 1</span>
<span class="co">#&gt;              Df Sum of Sq     RSS     AIC      R2</span>
<span class="co">#&gt; &lt;none&gt;                    1.15530 -32.926        </span>
<span class="co">#&gt; TemperatureC  1   0.37174 0.78356 -36.361 0.32177</span>
<span class="co">#&gt; AmbientLight  1   0.05064 1.10466 -31.553 0.04384</span>
<span class="co">#&gt; Bg_noise_max  1   0.29569 0.85962 -35.065 0.25594</span>

<span class="va">leave1out</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/add1.html" class="external-link">drop1</a></span><span class="op">(</span><span class="va">ft_headbob</span><span class="op">)</span>
<span class="va">leave1out</span><span class="op">$</span><span class="va">R2</span><span class="op">=</span><span class="va">leave1out</span><span class="op">$</span><span class="va">`Sum of Sq`</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">ft_int</span><span class="op">)</span>
<span class="va">leave1out</span>
<span class="co">#&gt; Single term deletions</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt; bobspeed ~ TemperatureC + AmbientLight + Bg_noise_max</span>
<span class="co">#&gt;              Df Sum of Sq     RSS     AIC       R2</span>
<span class="co">#&gt; &lt;none&gt;                    0.62264 -35.580         </span>
<span class="co">#&gt; TemperatureC  1  0.193576 0.81621 -33.790 0.167555</span>
<span class="co">#&gt; AmbientLight  1  0.113540 0.73618 -35.235 0.098278</span>
<span class="co">#&gt; Bg_noise_max  1  0.018757 0.64139 -37.164 0.016235</span></code></pre></div>
<p>Well glad we looked at this as well… so temperature and noisiness
both seem associated with headbobs, but after adding temp to the model,
noisiness doesn’t really add anything, whereas the reverse is not true.
So it seems there is a fairly strong association with temp (marginally
32%, conditionally still 17%) and some effect of ambient light
(marginally 4%, after controlling for temp 10%). The large marginal
effect of noisiness is probably due to correlation with temp.</p>
</div>
<div class="section level3">
<h3 id="exercise-5-5-plant-height-data-and-precipitation">Exercise 5.5 Plant height data and precipitation<a class="anchor" aria-label="anchor" href="#exercise-5-5-plant-height-data-and-precipitation"></a>
</h3>
<p><em>Find a subset of precipitation variables that optimally predicts
plant height</em></p>
<p>I’ll start with forward selection. We know temp is important so I
will include that in all models</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    131 obs. of  33 variables:</span>
<span class="co">#&gt;  $ sort_number     : int  1402 25246 11648 8168 22422 25151 26007 6597 16908 4610 ...</span>
<span class="co">#&gt;  $ site            : int  193 103 54 144 178 27 118 154 106 201 ...</span>
<span class="co">#&gt;  $ Genus_species   : Factor w/ 175 levels "_8324","Abies_veitchii",..: 5 143 67 45 127 142 147 37 96 28 ...</span>
<span class="co">#&gt;  $ Family          : Factor w/ 68 levels "Annonaceae","Asteraceae",..: 60 37 49 12 50 27 55 31 49 5 ...</span>
<span class="co">#&gt;  $ growthform      : Factor w/ 6 levels "Fern","Herb",..: 6 6 2 4 2 4 6 6 2 4 ...</span>
<span class="co">#&gt;  $ height          : num  22.86 45 0.55 0.6 0.152 ...</span>
<span class="co">#&gt;  $ Country         : Factor w/ 37 levels "Argentina","Australia",..: 35 26 2 14 35 2 NA 35 2 8 ...</span>
<span class="co">#&gt;  $ Site            : Factor w/ 127 levels "a-ngau","ab",..: 84 74 41 52 55 66 75 45 44 NA ...</span>
<span class="co">#&gt;  $ lat             : num  44.6 12.2 23.8 32.6 41.6 ...</span>
<span class="co">#&gt;  $ long            : num  -123.3 -70.5 133.8 34.9 -87 ...</span>
<span class="co">#&gt;  $ alt             : int  179 386 553 115 200 157 2 71 2 28 ...</span>
<span class="co">#&gt;  $ temp            : num  10.8 24.5 20.9 19.9 9.7 16.8 27.7 15.5 26.4 5.4 ...</span>
<span class="co">#&gt;  $ diurn.temp      : num  11.8 10.8 16.3 9.7 10.7 10 4.8 11.4 5 6.6 ...</span>
<span class="co">#&gt;  $ isotherm        : num  4.4 7.4 4.8 4.4 2.8 4.8 8.8 3.2 7.4 2.1 ...</span>
<span class="co">#&gt;  $ temp.seas       : num  5.2 0.9 6 4.9 9.7 3.9 0.2 8.6 0.6 8.3 ...</span>
<span class="co">#&gt;  $ temp.max.warm   : num  27 31.2 37 30.7 28.6 26.1 30.6 32.9 29.9 21.2 ...</span>
<span class="co">#&gt;  $ temp.min.cold   : num  0.3 16.7 3.6 8.7 -9.5 5.5 25.2 -2.6 23.2 -9 ...</span>
<span class="co">#&gt;  $ temp.ann.range  : num  26.7 14.5 33.4 22 38.1 20.6 5.4 35.5 6.7 30.2 ...</span>
<span class="co">#&gt;  $ temp.mean.wetqr : num  4.9 25.1 28.1 13.6 21.6 21.2 27.9 15.6 26.8 6.5 ...</span>
<span class="co">#&gt;  $ temp.mean.dryqr : num  17.4 23.2 14.8 25.3 -3.3 12.3 27.5 21.5 25.7 -1.6 ...</span>
<span class="co">#&gt;  $ temp.mean.warmqr: num  17.6 25.3 28.1 25.7 21.6 21.4 27.9 26.1 27.1 16.1 ...</span>
<span class="co">#&gt;  $ temp.mean.coldqr: num  4.5 23.1 12.8 13.6 -3.3 11.5 27.5 3.8 25.5 -5 ...</span>
<span class="co">#&gt;  $ rain            : int  1208 3015 278 598 976 1283 2585 1262 1704 664 ...</span>
<span class="co">#&gt;  $ rain.wetm       : int  217 416 37 159 104 157 300 129 309 77 ...</span>
<span class="co">#&gt;  $ rain.drym       : int  13 99 9 0 44 63 82 66 16 31 ...</span>
<span class="co">#&gt;  $ rain.seas       : int  69 45 42 115 23 29 34 18 66 28 ...</span>
<span class="co">#&gt;  $ rain.wetqr      : int  601 1177 109 408 299 450 870 382 806 220 ...</span>
<span class="co">#&gt;  $ rain.dryqr      : int  68 340 35 0 165 208 305 249 92 106 ...</span>
<span class="co">#&gt;  $ rain.warmqr     : int  75 928 109 2 299 385 855 268 659 191 ...</span>
<span class="co">#&gt;  $ rain.coldqr     : int  560 359 42 408 165 279 405 325 135 137 ...</span>
<span class="co">#&gt;  $ LAI             : num  2.51 4.26 1.32 1.01 3.26 4.14 NA 3.14 4.51 3.07 ...</span>
<span class="co">#&gt;  $ NPP             : int  572 1405 756 359 1131 1563 NA 1266 2296 536 ...</span>
<span class="co">#&gt;  $ hemisphere      : int  1 -1 -1 1 1 -1 1 1 -1 1 ...</span>
<span class="va">globalPlants</span><span class="op">$</span><span class="va">logHt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">globalPlants</span><span class="op">$</span><span class="va">height</span><span class="op">)</span>
<span class="va">ft_temp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logHt</span><span class="op">~</span><span class="va">temp</span>, data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">ft_tempRain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logHt</span><span class="op">~</span><span class="va">temp</span><span class="op">+</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.wetm</span><span class="op">+</span><span class="va">rain.drym</span><span class="op">+</span><span class="va">rain.seas</span><span class="op">+</span><span class="va">rain.wetqr</span><span class="op">+</span><span class="va">rain.dryqr</span><span class="op">+</span><span class="va">rain.warmqr</span><span class="op">+</span><span class="va">rain.coldqr</span>, data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_tempRain</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/ex5.5plantprecip-1.png" alt=""><p class="caption">plot of chunk ex5.5plantprecip</p>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_step</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html" class="external-link">step</a></span><span class="op">(</span><span class="va">ft_temp</span>, scope<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">ft_tempRain</span><span class="op">)</span>, direction<span class="op">=</span><span class="st">"forward"</span><span class="op">)</span>
<span class="co">#&gt; Start:  AIC=107.97</span>
<span class="co">#&gt; logHt ~ temp</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Df Sum of Sq    RSS     AIC</span>
<span class="co">#&gt; + rain.wetqr   1   26.7393 262.96  97.280</span>
<span class="co">#&gt; + rain         1   26.4615 263.24  97.418</span>
<span class="co">#&gt; + rain.wetm    1   24.5243 265.17  98.379</span>
<span class="co">#&gt; + rain.coldqr  1   20.3413 269.36 100.429</span>
<span class="co">#&gt; + rain.dryqr   1   11.2099 278.49 104.796</span>
<span class="co">#&gt; + rain.warmqr  1    9.4721 280.22 105.611</span>
<span class="co">#&gt; + rain.drym    1    9.2552 280.44 105.713</span>
<span class="co">#&gt; &lt;none&gt;                     289.70 107.966</span>
<span class="co">#&gt; + rain.seas    1    0.0632 289.63 109.938</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=97.28</span>
<span class="co">#&gt; logHt ~ temp + rain.wetqr</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Df Sum of Sq    RSS    AIC</span>
<span class="co">#&gt; + rain.coldqr  1    4.0676 258.89 97.238</span>
<span class="co">#&gt; &lt;none&gt;                     262.96 97.280</span>
<span class="co">#&gt; + rain.wetm    1    1.5701 261.39 98.495</span>
<span class="co">#&gt; + rain         1    1.1733 261.78 98.694</span>
<span class="co">#&gt; + rain.dryqr   1    0.7535 262.20 98.904</span>
<span class="co">#&gt; + rain.warmqr  1    0.5071 262.45 99.027</span>
<span class="co">#&gt; + rain.drym    1    0.4799 262.48 99.041</span>
<span class="co">#&gt; + rain.seas    1    0.0841 262.87 99.238</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=97.24</span>
<span class="co">#&gt; logHt ~ temp + rain.wetqr + rain.coldqr</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Df Sum of Sq    RSS    AIC</span>
<span class="co">#&gt; &lt;none&gt;                     258.89 97.238</span>
<span class="co">#&gt; + rain.wetm    1   1.33741 257.55 98.559</span>
<span class="co">#&gt; + rain.seas    1   0.12668 258.76 99.174</span>
<span class="co">#&gt; + rain.warmqr  1   0.01663 258.87 99.229</span>
<span class="co">#&gt; + rain         1   0.01150 258.88 99.232</span>
<span class="co">#&gt; + rain.dryqr   1   0.00406 258.88 99.236</span>
<span class="co">#&gt; + rain.drym    1   0.00005 258.89 99.238</span></code></pre></div>
<p>So forward selection suggests adding rainfall in the wettest and
coldest quarters to the model.</p>
<p>How about LASSO…</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">XtempRain</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">globalPlants</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">temp</span>,<span class="va">rain</span>,<span class="va">rain.wetm</span>,<span class="va">rain.drym</span>,<span class="va">rain.seas</span>,<span class="va">rain.wetqr</span>,<span class="va">rain.dryqr</span>,<span class="va">rain.wetqr</span>,<span class="va">rain.dryqr</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span>
<span class="va">lasso_rain</span><span class="op">=</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">XtempRain</span>,<span class="va">globalPlants</span><span class="op">$</span><span class="va">logHt</span>,penalty.factor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lasso_rain</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/ex5.5lassorain-1.png" alt=""><p class="caption">plot of chunk ex5.5lassorain</p>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_lasso</span><span class="op">=</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span><span class="va">XtempRain</span>,<span class="va">globalPlants</span><span class="op">$</span><span class="va">logHt</span>,lambda<span class="op">=</span><span class="va">lasso_rain</span><span class="op">$</span><span class="va">lambda.min</span><span class="op">)</span>
<span class="va">ft_lasso</span><span class="op">$</span><span class="va">beta</span>
<span class="co">#&gt; 9 x 1 sparse Matrix of class "dgCMatrix"</span>
<span class="co">#&gt;                      s0</span>
<span class="co">#&gt; temp       0.0396005806</span>
<span class="co">#&gt; rain       0.0006377051</span>
<span class="co">#&gt; rain.wetm  .           </span>
<span class="co">#&gt; rain.drym  .           </span>
<span class="co">#&gt; rain.seas  0.0055999469</span>
<span class="co">#&gt; rain.wetqr .           </span>
<span class="co">#&gt; rain.dryqr .           </span>
<span class="co">#&gt; rain.wetqr .           </span>
<span class="co">#&gt; rain.dryqr .</span></code></pre></div>
<p>This time we are going with two rainfall variables again, but
different ones – total precipitation and seasonality. (This actually
provides similar information to what you would get from
<code>rain.wetqr</code> and <code>rain.dryqr</code>, which jointly tell
you about both total rainfall and variability/seasonality.)</p>
<p><em>Any issues with multi-collinearity amongst the precipitation
variables? Try to address any multi-collinearity by culling one or two
of the main culprits. Does this affect your previous model selection
results?</em></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/" class="external-link">car</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html" class="external-link">vif</a></span><span class="op">(</span><span class="va">ft_tempRain</span><span class="op">)</span>
<span class="co">#&gt;        temp        rain   rain.wetm   rain.drym   rain.seas  rain.wetqr  rain.dryqr rain.warmqr rain.coldqr </span>
<span class="co">#&gt;    1.773040  111.063634   85.433552  110.163673    5.524702  130.580531  144.565319    9.577784    6.436926</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">XtempRain</span><span class="op">)</span>
<span class="co">#&gt;                 temp        rain rain.wetm  rain.drym   rain.seas rain.wetqr rain.dryqr rain.wetqr rain.dryqr</span>
<span class="co">#&gt; temp       1.0000000  0.47869648 0.5552163  0.1923458  0.37764956  0.5530709  0.1959310  0.5530709  0.1959310</span>
<span class="co">#&gt; rain       0.4786965  1.00000000 0.9170080  0.7540378 -0.03914991  0.9276384  0.7811679  0.9276384  0.7811679</span>
<span class="co">#&gt; rain.wetm  0.5552163  0.91700800 1.0000000  0.4730420  0.30626819  0.9935421  0.5030374  0.9935421  0.5030374</span>
<span class="co">#&gt; rain.drym  0.1923458  0.75403779 0.4730420  1.0000000 -0.53128346  0.4907095  0.9933645  0.4907095  0.9933645</span>
<span class="co">#&gt; rain.seas  0.3776496 -0.03914991 0.3062682 -0.5312835  1.00000000  0.2893864 -0.5243323  0.2893864 -0.5243323</span>
<span class="co">#&gt; rain.wetqr 0.5530709  0.92763843 0.9935421  0.4907095  0.28938641  1.0000000  0.5187558  1.0000000  0.5187558</span>
<span class="co">#&gt; rain.dryqr 0.1959310  0.78116788 0.5030374  0.9933645 -0.52433232  0.5187558  1.0000000  0.5187558  1.0000000</span>
<span class="co">#&gt; rain.wetqr 0.5530709  0.92763843 0.9935421  0.4907095  0.28938641  1.0000000  0.5187558  1.0000000  0.5187558</span>
<span class="co">#&gt; rain.dryqr 0.1959310  0.78116788 0.5030374  0.9933645 -0.52433232  0.5187558  1.0000000  0.5187558  1.0000000</span></code></pre></div>
<p>A bunch of high VIF’s, looking at correlations,
<code>rain.wetm</code> looks like one of the main culprits, it is quite
understandable that rainfall in the wettest month should be highly
correlated with total rainfall, and with rainfall in the wettest
quarter! Will also remove <code>rain.drym</code> because there is high
redundancy between this variable and <code>rain.dryqr</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_tempLessRain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">logHt</span><span class="op">~</span><span class="va">temp</span><span class="op">+</span><span class="va">rain</span><span class="op">+</span><span class="va">rain.seas</span><span class="op">+</span><span class="va">rain.wetqr</span><span class="op">+</span><span class="va">rain.dryqr</span><span class="op">+</span><span class="va">rain.warmqr</span><span class="op">+</span><span class="va">rain.coldqr</span>, data<span class="op">=</span><span class="va">globalPlants</span><span class="op">)</span>
<span class="va">ft_Lstep</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html" class="external-link">step</a></span><span class="op">(</span><span class="va">ft_temp</span>, scope<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">ft_tempLessRain</span><span class="op">)</span>, direction<span class="op">=</span><span class="st">"forward"</span><span class="op">)</span>
<span class="co">#&gt; Start:  AIC=107.97</span>
<span class="co">#&gt; logHt ~ temp</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Df Sum of Sq    RSS     AIC</span>
<span class="co">#&gt; + rain.wetqr   1   26.7393 262.96  97.280</span>
<span class="co">#&gt; + rain         1   26.4615 263.24  97.418</span>
<span class="co">#&gt; + rain.coldqr  1   20.3413 269.36 100.429</span>
<span class="co">#&gt; + rain.dryqr   1   11.2099 278.49 104.796</span>
<span class="co">#&gt; + rain.warmqr  1    9.4721 280.22 105.611</span>
<span class="co">#&gt; &lt;none&gt;                     289.70 107.966</span>
<span class="co">#&gt; + rain.seas    1    0.0632 289.63 109.938</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=97.28</span>
<span class="co">#&gt; logHt ~ temp + rain.wetqr</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Df Sum of Sq    RSS    AIC</span>
<span class="co">#&gt; + rain.coldqr  1    4.0676 258.89 97.238</span>
<span class="co">#&gt; &lt;none&gt;                     262.96 97.280</span>
<span class="co">#&gt; + rain         1    1.1733 261.78 98.694</span>
<span class="co">#&gt; + rain.dryqr   1    0.7535 262.20 98.904</span>
<span class="co">#&gt; + rain.warmqr  1    0.5071 262.45 99.027</span>
<span class="co">#&gt; + rain.seas    1    0.0841 262.87 99.238</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=97.24</span>
<span class="co">#&gt; logHt ~ temp + rain.wetqr + rain.coldqr</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Df Sum of Sq    RSS    AIC</span>
<span class="co">#&gt; &lt;none&gt;                     258.89 97.238</span>
<span class="co">#&gt; + rain.seas    1  0.126684 258.76 99.174</span>
<span class="co">#&gt; + rain.warmqr  1  0.016626 258.87 99.229</span>
<span class="co">#&gt; + rain         1  0.011498 258.88 99.232</span>
<span class="co">#&gt; + rain.dryqr   1  0.004059 258.88 99.236</span>

<span class="va">XlessRain</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">ft_tempLessRain</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">lasso_Lrain</span><span class="op">=</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">XlessRain</span>,<span class="va">globalPlants</span><span class="op">$</span><span class="va">logHt</span>,penalty.factor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lasso_Lrain</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/ex5.5lessrain-1.png" alt=""><p class="caption">plot of chunk ex5.5lessrain</p>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft_Llasso</span><span class="op">=</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span><span class="va">XlessRain</span>,<span class="va">globalPlants</span><span class="op">$</span><span class="va">logHt</span>,lambda<span class="op">=</span><span class="va">lasso_Lrain</span><span class="op">$</span><span class="va">lambda.min</span><span class="op">)</span>
<span class="va">ft_Llasso</span><span class="op">$</span><span class="va">beta</span>
<span class="co">#&gt; 7 x 1 sparse Matrix of class "dgCMatrix"</span>
<span class="co">#&gt;                       s0</span>
<span class="co">#&gt; temp        4.188268e-02</span>
<span class="co">#&gt; rain        5.333291e-05</span>
<span class="co">#&gt; rain.seas   .           </span>
<span class="co">#&gt; rain.wetqr  1.030699e-03</span>
<span class="co">#&gt; rain.dryqr  .           </span>
<span class="co">#&gt; rain.warmqr .           </span>
<span class="co">#&gt; rain.coldqr 6.719062e-04</span></code></pre></div>
<p>Forward selection is unchanged, not a big surprise because the
forward path stopped before any deleted variables were considered. This
time LASSO gave a similar model, also picking <code>rain.wetqr</code>
and <code>rain.coldqr</code>, it also added a small term for
<code>rain</code> too. Note that the precise solution you get depends on
randomness in the assignment of observations to validation groups, so
your run may come out a little differently to this.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
