<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecostats">
<title>Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes • ecostats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes">
<meta property="og:description" content="ecostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecostats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/eco-stats.html">About ecostats</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Chapter Solutions</h6>
    <a class="dropdown-item" href="../articles/Chapter1Solutions.html">Chapter 1 -- 'STATS 101' Revision -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter2Solutions.html">Chapter 2 -- An importance equivalence result -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter3Solutions.html">Chapter 3 -- Regression with multiple predictor variables -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter4Solutions.html">Chapter 4 -- Linear models -- anything goes -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter5Solutions.html">Chapter 5 -- Model selection -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter6Solutions.html">Chapter 6 -- Mixed effect models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter7Solutions.html">Chapter 7 -- Correlated samples in times, space, phylogeny... -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter8Solutions.html">Chapter 8 -- Wiggly Models -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter9Solutions.html">Chapter 9 -- Design-based inference -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter10Solutions.html">Chapter 10 -- Analysing discrete data -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter11Solutions.html">Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter12Solutions.html">Chapter 12 -- Visualising many responses -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter13Solutions.html">Chapter 13 -- Allometric line-fitting -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter14Solutions.html">Chapter 14 -- Multivariate abundances -- inference about environmental associations -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter15Solutions.html">Chapter 15 -- Predicting multivariate abundances -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter16Solutions.html">Chapter 16 -- Understanding variation in environmental response across taxa -- Exercise solutions and Code Boxes</a>
    <a class="dropdown-item" href="../articles/Chapter17Solutions.html">Chapter 17 -- Studying co-occurrence patterns -- Exercise solutions and Code Boxes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Glossary of functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dwarton/ecostats">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 11 -- Multivariate analysis -- Exercise solutions and Code Boxes</h1>
                        <h4 data-toc-skip class="author">David
Warton</h4>
            
            <h4 data-toc-skip class="date">2022-06-09</h4>
      
      
      <div class="d-none name"><code>Chapter11Solutions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="exercise-11-1-leaf-economics-and-environment">Exercise 11.1: Leaf economics and environment<a class="anchor" aria-label="anchor" href="#exercise-11-1-leaf-economics-and-environment"></a>
</h2>
<p>Ian likes studying leaves. He is especially interested in “leaf
economics” – things like construction costs per unit area
(<code>lma</code>), how long-lived leaves are (<code>longev</code>) and
how they vary with environment. In particular:</p>
<p><em>Is there evidence that leaves vary (in their “economics” traits)
across sites with different levels of rainfall and soil
nutrients?</em></p>
<p><em>What are the response variables? What sort of analysis is
appropriate here?</em></p>
<p>The response is leaf economics traits, collectively, which
includes:</p>
<ul>
<li>
<code>lma</code> (leaf construction costs per unit area)</li>
<li>
<code>longev</code> (how long leaves live for)</li>
</ul>
<p>Both of these are quantitative variables.</p>
<p>A multivariate analysis would seem appropriate.</p>
</div>
<div class="section level2">
<h2 id="exercise-11-2-flower-size-and-shape">Exercise 11.2: Flower size and shape<a class="anchor" aria-label="anchor" href="#exercise-11-2-flower-size-and-shape"></a>
</h2>
<p><em>What are the response variables? What sort of analysis is
appropriate here?</em></p>
<p>The response variables are the flower size and shape variables. These
are:</p>
<ul>
<li>length of petals</li>
<li>width of petals</li>
<li>length of sepals</li>
<li>width of sepals</li>
</ul>
<p>A multivariate analysis would be the way to go here.</p>
</div>
<div class="section level2">
<h2 id="exercise-11-3-hunting-spiders-and-their-environment">Exercise 11.3: Hunting spiders and their environment<a class="anchor" aria-label="anchor" href="#exercise-11-3-hunting-spiders-and-their-environment"></a>
</h2>
<p><em>What are the response variables? What type of analysis is
appropriate here?</em></p>
<p>The response variables are abundance of the three most abundant
genera of hunting spider. Some sort of multivariate analyis would be
appropriate, but given that we are dealing with abundances, something
that accounts for the mean-variance relationship might be needed.</p>
</div>
<div class="section level2">
<h2 id="code-box-11-1-sample-variance-covariance-matrices-on-r">Code Box 11.1: Sample variance-covariance matrices on
<code>R</code><a class="anchor" aria-label="anchor" href="#code-box-11-1-sample-variance-covariance-matrices-on-r"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/traitecoevo" class="external-link">smatr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">leaflife</span><span class="op">)</span>
<span class="va">Yleaf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">leaflife</span><span class="op">$</span><span class="va">lma</span>,<span class="va">leaflife</span><span class="op">$</span><span class="va">longev</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Yleaf</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lma"</span>,<span class="st">"longev"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">Yleaf</span><span class="op">)</span>
<span class="co">#&gt;              lma     longev</span>
<span class="co">#&gt; lma    4186.0264 36.7905011</span>
<span class="co">#&gt; longev   36.7905  0.8232901</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;              Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="co">#&gt; Sepal.Length    0.6856935  -0.0424340    1.2743154   0.5162707</span>
<span class="co">#&gt; Sepal.Width    -0.0424340   0.1899794   -0.3296564  -0.1216394</span>
<span class="co">#&gt; Petal.Length    1.2743154  -0.3296564    3.1162779   1.2956094</span>
<span class="co">#&gt; Petal.Width     0.5162707  -0.1216394    1.2956094   0.5810063</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-11-2-fitting-a-multivariate-linear-model-to-the-leaf-economics-data-">Code Box 11.2: Fitting a multivariate linear model to the leaf
economics data.<a class="anchor" aria-label="anchor" href="#code-box-11-2-fitting-a-multivariate-linear-model-to-the-leaf-economics-data-"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/traitecoevo" class="external-link">smatr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">leaflife</span><span class="op">)</span>
<span class="va">Yleaf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">leaflife</span><span class="op">$</span><span class="va">lma</span>,<span class="va">leaflife</span><span class="op">$</span><span class="va">longev</span><span class="op">)</span>
<span class="va">ft_leaf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Yleaf</span><span class="op">~</span><span class="va">rain</span><span class="op">*</span><span class="va">soilp</span>, data<span class="op">=</span><span class="va">leaflife</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_leaf</span>, test<span class="op">=</span><span class="st">"Wilks"</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Variance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;             Df   Wilks approx F num Df den Df    Pr(&gt;F)    </span>
<span class="co">#&gt; (Intercept)  1 0.11107  248.096      2     62 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; rain         1 0.68723   14.108      2     62 8.917e-06 ***</span>
<span class="co">#&gt; soilp        1 0.93478    2.163      2     62    0.1236    </span>
<span class="co">#&gt; rain:soilp   1 0.95093    1.600      2     62    0.2102    </span>
<span class="co">#&gt; Residuals   63                                             </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">leaflife</span><span class="op">$</span><span class="va">lma</span><span class="op">~</span><span class="va">leaflife</span><span class="op">$</span><span class="va">longev</span>, xlab<span class="op">=</span><span class="st">"Leaf longevity (years)"</span>,
                     ylab<span class="op">=</span><span class="st">"Leaf mass per area (mg/mm^2)"</span>,
                     col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">leaflife</span><span class="op">$</span><span class="va">rain</span>,<span class="va">leaflife</span><span class="op">$</span><span class="va">soilp</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"high rain, high soilp"</span>,
         <span class="st">"low rain, high soilp"</span>, <span class="st">"high rain, low soilp"</span>,
         <span class="st">"low rain, low soilp"</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, pch<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/box11.2plot-1.png" alt=""><p class="caption">plot of chunk box11.2plot</p>
</div>
<p><em>What is the nature of the rainfall effect?</em></p>
<p>The red dots look to be higher than the black dots, and the blue dots
look to be higher than the green dots. This suggests that at low
rainfall, thicker leaves (larger mass per unit area) are needed to
achieve the same longevity. Or equivalently, at low rainfall, leaves of
a given LMA don’t live as long.</p>
</div>
<div class="section level2">
<h2 id="code-box-11-3-checking-multivariate-linear-model-assumptions-for-leaf-economics-data">Code Box 11.3: Checking multivariate linear model assumptions for
leaf economics data<a class="anchor" aria-label="anchor" href="#code-box-11-3-checking-multivariate-linear-model-assumptions-for-leaf-economics-data"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ecostats</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_leaf</span>,which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/box11.3-1.png" alt=""><p class="caption">plot of chunk box11.3</p>
</div>
<p>(Note that <code>plotenvelope</code> was run with just
<code>99</code> iterations, to speed up computation time.)</p>
<p><em>What do you think about the model assumptions made here?</em></p>
<p>They aren’t looking great – the residual vs fits plot has a bit of a
fan shape, confirmed by the scale-location plot, which has an increasing
trend that does not stay inside its simulation envelope. This suggests
that variability increases as the mean increases, so maybe we should be
transforming data.</p>
</div>
<div class="section level2">
<h2 id="code-box-11-4-a-multivariate-linear-model-for-the-leaf-economics-data-using-mvabund">Code Box 11.4: A multivariate linear model for the leaf economics
data using <code>mvabund</code><a class="anchor" aria-label="anchor" href="#code-box-11-4-a-multivariate-linear-model-for-the-leaf-economics-data-using-mvabund"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span>
<span class="va">ftmany_leaf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/manylm.html" class="external-link">manylm</a></span><span class="op">(</span><span class="va">Yleaf</span><span class="op">~</span><span class="va">rain</span><span class="op">*</span><span class="va">soilp</span>, data<span class="op">=</span><span class="va">leaflife</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ftmany_leaf</span>,cor.type<span class="op">=</span><span class="st">"R"</span>,test<span class="op">=</span><span class="st">"LR"</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Variance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: manylm(formula = Yleaf ~ rain * soilp, data = leaflife)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Overall test for all response variables</span>
<span class="co">#&gt; Test statistics:</span>
<span class="co">#&gt;             Res.Df Df.diff val(LR) Pr(&gt;LR)   </span>
<span class="co">#&gt; (Intercept)     66                           </span>
<span class="co">#&gt; rain            65       1  23.941   0.002 **</span>
<span class="co">#&gt; soilp           64       1   4.475   0.117   </span>
<span class="co">#&gt; rain:soilp      63       1   3.371   0.231   </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Arguments:</span>
<span class="co">#&gt;  Test statistics calculated assuming unconstrained correlation response </span>
<span class="co">#&gt;  P-value calculated using 999 iterations via residual (without replacement) resampling.</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-11-4-transforming-ians-leaf-economics-data">Exercise 11.4: Transforming Ian’s leaf economics data<a class="anchor" aria-label="anchor" href="#exercise-11-4-transforming-ians-leaf-economics-data"></a>
</h2>
<p><em>Repeat the analyses and assumption checks of Code Boxes 11.2-11.3
on log-transformed data. Do assumptions look more reasonable here? Are
results any different?</em></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">YleafLog</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Yleaf</span><span class="op">)</span>
<span class="va">ft_leafLog</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">YleafLog</span><span class="op">~</span><span class="va">rain</span><span class="op">*</span><span class="va">soilp</span>, data<span class="op">=</span><span class="va">leaflife</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">ft_leafLog</span>, test<span class="op">=</span><span class="st">"Wilks"</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Variance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;             Df   Wilks approx F num Df den Df    Pr(&gt;F)    </span>
<span class="co">#&gt; (Intercept)  1 0.00239  12947.3      2     62 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; rain         1 0.65969     16.0      2     62 2.509e-06 ***</span>
<span class="co">#&gt; soilp        1 0.91520      2.9      2     62   0.06413 .  </span>
<span class="co">#&gt; rain:soilp   1 0.96231      1.2      2     62   0.30389    </span>
<span class="co">#&gt; Residuals   63                                             </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_leafLog</span>,which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/ex11.4-1.png" alt=""><p class="caption">plot of chunk ex11.4</p>
</div>
<p><em>Is this what you expected to happen?</em></p>
<p>Assumptions are looking more reasonable now, there is no longer a
fan-shape nor appreciable right-skew in the data. This is what I
expected because (as mentioned in the question) size variables tend to
make more sense when viewed on a proportional scale. MANOVA results were
generally similar, although test statistics (<code>approx F</code>) for
main effects were slightly larger, in keeping with the general result
that you can see signals more clearly when reducing skew in data
(procedures tend to be more <em>efficient</em> when their underlying
assumptions are more reasonable).</p>
</div>
<div class="section level2">
<h2 id="exercise-11-5-transforming-edgars-data">Exercise 11.5: Transforming Edgar’s data?<a class="anchor" aria-label="anchor" href="#exercise-11-5-transforming-edgars-data"></a>
</h2>
<p><em>Fit a linear model to predict petal length from the remaining
flower variables and check assumptions. Is there any evidence of
lack-of-fit? (This would imply a problem with the multivariate normality
assumptions.)</em></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>
<span class="va">iris</span><span class="op">$</span><span class="va">Yflower</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="va">ft_iris</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Yflower</span><span class="op">~</span><span class="va">Species</span>,data<span class="op">=</span><span class="va">iris</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_iris</span>,which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/ex11.5Un-1.png" alt=""><p class="caption">plot of chunk ex11.5Un</p>
</div>
<p>This doesn’t look too bad, but there is a moderate fan-shape, evident
in an increasing trend in the scale-location plot, which drifts outside
its simulation envelope. The trend is not strong however, with the
y-axis predictions ranging from 0.6 to 1 (varying over a factor of about
1.5).</p>
<p><em>Does a log-transformation help at all?</em></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span><span class="op">$</span><span class="va">YfLog</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">ft_irisLog</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">YfLog</span><span class="op">~</span><span class="va">Species</span>,data<span class="op">=</span><span class="va">iris</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotenvelope.html">plotenvelope</a></span><span class="op">(</span><span class="va">ft_irisLog</span>,which<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,n.sim<span class="op">=</span><span class="fl">99</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/ex11.5Log-1.png" alt=""><p class="caption">plot of chunk ex11.5Log</p>
</div>
<p>Oh well that’s disappointing! The log-transformation hasn’t made
things much better, reversing the fan-shape and the trend in the
scale-location plot (although again it is not a strong trend). Residuals
now appear quite non-normal with some long tails, especially at the
lower end. The issue is largely with petal variables (blue/green), we
would get a slightly better plot if we only log-transformed sepal
measurements. The main issue we saw previously - an increasing trend on
the scale-location plot - is however less of an issue now (note the
trend line covers a smaller range of values, from about 0.7 to 0.9).</p>
</div>
<div class="section level2">
<h2 id="code-box-11-5-preparing-spider-data-for-analysis-on-lme4-or-glmmtmb">Code Box 11.5: Preparing spider data for analysis on
<code>lme4</code> or <code>glmmTMB</code><a class="anchor" aria-label="anchor" href="#code-box-11-5-preparing-spider-data-for-analysis-on-lme4-or-glmmtmb"></a>
</h2>
<p>Petrus’s data from Exercise 11.3 are available in the
<code>mvabund</code> package, but with abundances for 12 different
species. First we will calculate the abundance of the three most
abundant genera:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">spider</span><span class="op">)</span>
<span class="va">Alop</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>
<span class="va">Pard</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>
<span class="va">Troc</span> <span class="op">=</span> <span class="va">spider</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span>,<span class="fl">11</span><span class="op">]</span>
<span class="va">spidGeneraWide</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rows<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">28</span>,<span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">Alop</span>,<span class="va">Pard</span>,<span class="va">Troc</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spidGeneraWide</span><span class="op">)</span>
<span class="co">#&gt;   rows   soil.dry       moss Alop Pard Troc</span>
<span class="co">#&gt; 1    1 -0.1720862  0.6289186   35  117   57</span>
<span class="co">#&gt; 2    2  0.7146218 -0.6870394    2   54   65</span>
<span class="co">#&gt; 3    3  0.1062154  0.1916410   37   93   66</span>
<span class="co">#&gt; 4    4  0.2507444  0.1916410    8  131   86</span>
<span class="co">#&gt; 5    5  0.6728333 -1.4299919   21  214   91</span>
<span class="co">#&gt; 6    6  1.1247181  0.1916410    6   62   63</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spiderGeneraLong</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">spidGeneraWide</span>,id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rows"</span>,<span class="st">"soil.dry"</span>,<span class="st">"moss"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">spiderGeneraLong</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"genus"</span>,<span class="st">"abundance"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spiderGeneraLong</span><span class="op">)</span>
<span class="co">#&gt;   rows   soil.dry       moss genus abundance</span>
<span class="co">#&gt; 1    1 -0.1720862  0.6289186  Alop        35</span>
<span class="co">#&gt; 2    2  0.7146218 -0.6870394  Alop         2</span>
<span class="co">#&gt; 3    3  0.1062154  0.1916410  Alop        37</span>
<span class="co">#&gt; 4    4  0.2507444  0.1916410  Alop         8</span>
<span class="co">#&gt; 5    5  0.6728333 -1.4299919  Alop        21</span>
<span class="co">#&gt; 6    6  1.1247181  0.1916410  Alop         6</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-box-11-6-fitting-a-hierarchical-glm-to-spider-data-on-glmmtmb">Code Box 11.6: Fitting a hierarchical GLM to spider data on
<code>glmmTMB</code><a class="anchor" aria-label="anchor" href="#code-box-11-6-fitting-a-hierarchical-glm-to-spider-data-on-glmmtmb"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/glmmTMB/glmmTMB" class="external-link">glmmTMB</a></span><span class="op">)</span>
<span class="va">spid_glmm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">~</span><span class="va">genus</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">genus</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">genus</span>
 <span class="op">+</span><span class="op">(</span><span class="fl">0</span><span class="op">+</span><span class="va">genus</span><span class="op">|</span><span class="va">rows</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"poisson"</span>,data<span class="op">=</span><span class="va">spiderGeneraLong</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">spid_glmm</span><span class="op">)</span>
<span class="co">#&gt;  Family: poisson  ( log )</span>
<span class="co">#&gt; Formula:          abundance ~ genus + soil.dry:genus + moss:genus + (0 + genus |      rows)</span>
<span class="co">#&gt; Data: spiderGeneraLong</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span>
<span class="co">#&gt;    681.1    717.5   -325.5    651.1       69 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Conditional model:</span>
<span class="co">#&gt;  Groups Name      Variance Std.Dev. Corr      </span>
<span class="co">#&gt;  rows   genusAlop 1.3576   1.1652             </span>
<span class="co">#&gt;         genusPard 1.5900   1.2610   0.75      </span>
<span class="co">#&gt;         genusTroc 0.7682   0.8765   0.59 0.82 </span>
<span class="co">#&gt; Number of obs: 84, groups:  rows, 28</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Conditional model:</span>
<span class="co">#&gt;                    Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)          1.9843     0.2463   8.058 7.76e-16 ***</span>
<span class="co">#&gt; genusPard            1.0846     0.2100   5.165 2.41e-07 ***</span>
<span class="co">#&gt; genusTroc            0.6072     0.2335   2.600  0.00932 ** </span>
<span class="co">#&gt; genusAlop:soil.dry  -0.6012     0.3284  -1.831  0.06716 .  </span>
<span class="co">#&gt; genusPard:soil.dry   1.4041     0.3704   3.791  0.00015 ***</span>
<span class="co">#&gt; genusTroc:soil.dry   1.4108     0.2950   4.782 1.74e-06 ***</span>
<span class="co">#&gt; genusAlop:moss       0.3435     0.3322   1.034  0.30103    </span>
<span class="co">#&gt; genusPard:moss       0.7361     0.3547   2.075  0.03796 *  </span>
<span class="co">#&gt; genusTroc:moss      -0.2033     0.2648  -0.768  0.44264    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p><em>Can you see any differences in response of different spider
genera to environmental conditions?</em></p>
<p><code>Pard</code> and <code>Trop</code> seem to increase in response
to <code>soil.dry</code>, significantly so, whereas <code>Alop</code>
decreases. There is a suggestion of a difference in <code>moss</code>
response as well, with a difference of 0.93 in slope between
<code>Pard</code> and <code>Troc</code>, which is reasonably large
compared to standard errors.</p>
</div>
<div class="section level2">
<h2 id="code-box-11-7-mcmcglmm-fit-to-petruss-spider-genus-data">Code Box 11.7: MCMCglmm fit to Petrus’s spider genus data<a class="anchor" aria-label="anchor" href="#code-box-11-7-mcmcglmm-fit-to-petruss-spider-genus-data"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MCMCglmm</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">ft_MCMC</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MCMCglmm/man/MCMCglmm.html" class="external-link">MCMCglmm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Alop</span>,<span class="va">Pard</span>,<span class="va">Troc</span><span class="op">)</span><span class="op">~</span><span class="va">trait</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">trait</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">trait</span>,
   rcov<span class="op">=</span><span class="op">~</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">units</span>,data<span class="op">=</span><span class="va">spidGeneraWide</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"poisson"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.000214</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 1000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.186036</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 2000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.207750</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 3000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.214000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.214607</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.219536</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 6000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.220250</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 7000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.222143</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.221500</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 9000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.221071</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 10000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.222321</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 11000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.219536</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 12000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.217964</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 13000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.218321</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Iterations = 3001:12991</span>
<span class="co">#&gt;  Thinning interval  = 10</span>
<span class="co">#&gt;  Sample size  = 1000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  DIC: 515.7024 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  R-structure:  ~us(trait):units</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           post.mean l-95% CI u-95% CI eff.samp</span>
<span class="co">#&gt; traitAlop:traitAlop.units    1.9674   0.6896    3.396    171.9</span>
<span class="co">#&gt; traitPard:traitAlop.units    1.5216   0.5111    2.619    750.4</span>
<span class="co">#&gt; traitTroc:traitAlop.units    0.8476   0.1973    1.620    735.5</span>
<span class="co">#&gt; traitAlop:traitPard.units    1.5216   0.5111    2.619    750.4</span>
<span class="co">#&gt; traitPard:traitPard.units    2.1081   1.0427    3.557    624.8</span>
<span class="co">#&gt; traitTroc:traitPard.units    1.2399   0.5337    2.169    738.7</span>
<span class="co">#&gt; traitAlop:traitTroc.units    0.8476   0.1973    1.620    735.5</span>
<span class="co">#&gt; traitPard:traitTroc.units    1.2399   0.5337    2.169    738.7</span>
<span class="co">#&gt; traitTroc:traitTroc.units    1.0877   0.4375    1.837    545.8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Location effects: cbind(Alop, Pard, Troc) ~ trait + soil.dry:trait + moss:trait </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                    post.mean l-95% CI u-95% CI eff.samp  pMCMC    </span>
<span class="co">#&gt; (Intercept)          1.96106  1.40677  2.56137    564.0 &lt;0.001 ***</span>
<span class="co">#&gt; traitPard            1.10316  0.62128  1.55902    307.0 &lt;0.001 ***</span>
<span class="co">#&gt; traitTroc            0.60433  0.07406  1.12209    314.2  0.028 *  </span>
<span class="co">#&gt; traitAlop:soil.dry  -0.60527 -1.38983  0.14573    797.5  0.102    </span>
<span class="co">#&gt; traitPard:soil.dry   1.44406  0.61769  2.22122    741.5 &lt;0.001 ***</span>
<span class="co">#&gt; traitTroc:soil.dry   1.46411  0.76420  2.04801    353.2 &lt;0.001 ***</span>
<span class="co">#&gt; traitAlop:moss       0.35515 -0.34662  1.14501    683.7  0.332    </span>
<span class="co">#&gt; traitPard:moss       0.76450 -0.01952  1.60829    902.7  0.064 .  </span>
<span class="co">#&gt; traitTroc:moss      -0.19314 -0.76568  0.37943    646.0  0.498    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p><em>How do results compare to the model fitted using
<code>glmmTMB</code>?</em></p>
<p>Estimates of parameters in the mean model (intercepts, slopes) are
quite similar and seem to have similar levels of significance also.
Variance-covariance parameters for the random effects are presented in a
different format however – <code>MCMCglmm</code> directly reports values
of <span class="math inline">\(\boldsymbol{\Sigma}\)</span>, whereas
<code>glmmTMB</code> reports variances and correlations. We can convert
<code>MCMCglmm</code> values to correlations, which is best done by
taking the MCMC samples, transforming each individual one, then finding
the posterior mean:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.7483585</span></code></pre></div>
<p>which returns a value very similar to the correlation in the
<code>glmmTMB</code> output. Note however that the variances are quite
different, <em>e.g.</em> for <code>Alop</code> we have a posterior mean
of 1.97 for <code>MCMCglmm</code> but an estimate of 1.38 for
<code>glmmTMB</code>. The reason for this is that <code>glmmTMB</code>
uses maximum likelihood, and its point estimate corresponds more closely
to a posterior mode than a posterior mean. Estimating these posterior
densities using histograms:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,breaks<span class="op">=</span><span class="fl">15</span>,xlab<span class="op">=</span><span class="st">"Alop variance"</span>,main<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">spid_glmm</span><span class="op">)</span><span class="op">$</span><span class="va">varcor</span><span class="op">$</span><span class="va">cond</span><span class="op">$</span><span class="va">rows</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span>,breaks<span class="op">=</span><span class="fl">15</span>,xlab<span class="op">=</span><span class="st">"Pard variance"</span>,main<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">spid_glmm</span><span class="op">)</span><span class="op">$</span><span class="va">varcor</span><span class="op">$</span><span class="va">cond</span><span class="op">$</span><span class="va">rows</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="fl">9</span><span class="op">]</span>,breaks<span class="op">=</span><span class="fl">15</span>,xlab<span class="op">=</span><span class="st">"Troc variance"</span>,main<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">spid_glmm</span><span class="op">)</span><span class="op">$</span><span class="va">varcor</span><span class="op">$</span><span class="va">cond</span><span class="op">$</span><span class="va">rows</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/code11.7hists-1.png" alt=""><p class="caption">plot of chunk code11.7hists</p>
</div>
<p>The posterior modes show much closer agreement to the
<code>glmmTMB</code> variance estimates, although still tending to be
slightly larger.</p>
</div>
<div class="section level2">
<h2 id="exercise-11-6-different-effects-on-different-spider-genera">Exercise 11.6: Different effects on different spider genera?<a class="anchor" aria-label="anchor" href="#exercise-11-6-different-effects-on-different-spider-genera"></a>
</h2>
<p><em>Use <code>spiderGeneraLong</code> to fit a model that assumes all
spiders respond in the same way to their environment.</em></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spid_sameResponse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">~</span><span class="va">genus</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">+</span><span class="va">moss</span>
 <span class="op">+</span><span class="op">(</span><span class="fl">0</span><span class="op">+</span><span class="va">genus</span><span class="op">|</span><span class="va">rows</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"poisson"</span>,data<span class="op">=</span><span class="va">spiderGeneraLong</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">spid_sameResponse</span><span class="op">)</span>
<span class="co">#&gt;  Family: poisson  ( log )</span>
<span class="co">#&gt; Formula:          abundance ~ genus + soil.dry + moss + (0 + genus | rows)</span>
<span class="co">#&gt; Data: spiderGeneraLong</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span>
<span class="co">#&gt;    736.6    763.3   -357.3    714.6       73 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Conditional model:</span>
<span class="co">#&gt;  Groups Name      Variance Std.Dev. Corr      </span>
<span class="co">#&gt;  rows   genusAlop 6.6327   2.5754             </span>
<span class="co">#&gt;         genusPard 2.3031   1.5176   0.63      </span>
<span class="co">#&gt;         genusTroc 0.7952   0.8917   0.10 0.67 </span>
<span class="co">#&gt; Number of obs: 84, groups:  rows, 28</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Conditional model:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)   1.8623     0.5123   3.635 0.000278 ***</span>
<span class="co">#&gt; genusPard     1.2207     0.4187   2.915 0.003553 ** </span>
<span class="co">#&gt; genusTroc     0.7931     0.5335   1.487 0.137088    </span>
<span class="co">#&gt; soil.dry      0.9635     0.5288   1.822 0.068451 .  </span>
<span class="co">#&gt; moss         -0.3894     0.2991  -1.302 0.192993    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p><em>Now use <code>anova</code> to compare this model to
<code>spid_glmm</code>.</em></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">spid_sameResponse</span>,<span class="va">spid_glmm</span><span class="op">)</span>
<span class="co">#&gt; Data: spiderGeneraLong</span>
<span class="co">#&gt; Models:</span>
<span class="co">#&gt; spid_sameResponse: abundance ~ genus + soil.dry + moss + (0 + genus | rows), zi=~0, disp=~1</span>
<span class="co">#&gt; spid_glmm: abundance ~ genus + soil.dry:genus + moss:genus + (0 + genus | , zi=~0, disp=~1</span>
<span class="co">#&gt; spid_glmm:     rows), zi=~0, disp=~1</span>
<span class="co">#&gt;                   Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    </span>
<span class="co">#&gt; spid_sameResponse 11 736.58 763.32 -357.29   714.58                             </span>
<span class="co">#&gt; spid_glmm         15 681.08 717.54 -325.54   651.08 63.505      4  5.313e-13 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p><em>Is there evidence that different spider genera respond in
different ways to their environment?</em></p>
<p>Yes!</p>
</div>
<div class="section level2">
<h2 id="code-for-figure-11-4">Code for Figure 11.4<a class="anchor" aria-label="anchor" href="#code-for-figure-11-4"></a>
</h2>
<p>To simplify referencing of parameters let’s refit with no intercept
in the model</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">spid_glmm0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">~</span><span class="fl">0</span><span class="op">+</span><span class="va">genus</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">genus</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">genus</span>
   <span class="op">+</span><span class="op">(</span><span class="fl">0</span><span class="op">+</span><span class="va">genus</span><span class="op">|</span><span class="va">rows</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"poisson"</span>,data<span class="op">=</span><span class="va">spiderGeneraLong</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span><span class="op">~</span><span class="va">soil.dry</span>,data<span class="op">=</span><span class="va">spiderGeneraLong</span>,type<span class="op">=</span><span class="st">"n"</span>,yaxt<span class="op">=</span><span class="st">"n"</span>,
       ylab<span class="op">=</span><span class="st">"Abundance[log scale]"</span>,xlab<span class="op">=</span><span class="st">"Soil dryness [standardised]"</span><span class="op">)</span>
  <span class="va">yTicks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">50</span>,<span class="fl">100</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">yTicks</span><span class="op">)</span>,labels<span class="op">=</span><span class="va">yTicks</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">iVar</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nlevels.html" class="external-link">nlevels</a></span><span class="op">(</span><span class="va">spiderGeneraLong</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span><span class="op">~</span><span class="va">soil.dry</span>,
           data<span class="op">=</span><span class="va">spiderGeneraLong</span><span class="op">[</span><span class="va">spiderGeneraLong</span><span class="op">$</span><span class="va">genus</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">spiderGeneraLong</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span><span class="op">[</span><span class="va">iVar</span><span class="op">]</span>,<span class="op">]</span>,col<span class="op">=</span><span class="va">iVar</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="va">spid_glmm0</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="va">iVar</span><span class="op">]</span>, <span class="va">spid_glmm0</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">+</span><span class="va">iVar</span><span class="op">]</span>,col<span class="op">=</span><span class="va">iVar</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,<span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">spiderGeneraLong</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,pch<span class="op">=</span><span class="fl">1</span>,cex<span class="op">=</span><span class="fl">0.9</span>,y.intersp<span class="op">=</span><span class="fl">1.0</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/fig11.4-1.png" alt=""><p class="caption">plot of chunk fig11.4</p>
</div>
<p>But note this plot excludes absences… there are only a few for these
taxa. But in other situations with many zeros, a lot of data would be
missing from a plot constructed in this way, unless you get
creative!</p>
</div>
<div class="section level2">
<h2 id="code-box-11-8-diagnostic-plots-for-a-hierarchical-glm-of-petruss-spider-data">Code Box 11.8: Diagnostic plots for a hierarchical GLM of Petrus’s
spider data<a class="anchor" aria-label="anchor" href="#code-box-11-8-diagnostic-plots-for-a-hierarchical-glm-of-petruss-spider-data"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.75</span>,<span class="fl">0</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://florianhartig.github.io/DHARMa/" class="external-link">DHARMa</a></span><span class="op">)</span>
<span class="va">spidFits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">spid_glmm</span>,re.form<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>
<span class="va">res_spid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html" class="external-link">simulateResiduals</a></span><span class="op">(</span><span class="va">spid_glmm</span><span class="op">)</span><span class="op">$</span><span class="va">scaledResiduals</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spidFits</span>,<span class="va">res_spid</span>,col<span class="op">=</span><span class="va">spiderGeneraLong</span><span class="op">$</span><span class="va">genus</span>, xlab<span class="op">=</span><span class="st">"Fitted values"</span>, ylab<span class="op">=</span><span class="st">"Dunn-Smyth residuals"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="st">"olivedrab"</span><span class="op">)</span>
<span class="fu"><a href="../reference/addSmooth.html">addSmooth</a></span><span class="op">(</span><span class="va">spidFits</span>,<span class="va">res_spid</span><span class="op">)</span> <span class="co"># a function in ecostats package to add smoother and confidence band</span>
<span class="fu"><a href="../reference/qqenvelope.html">qqenvelope</a></span><span class="op">(</span><span class="va">res_spid</span>,col<span class="op">=</span><span class="va">spiderGeneraLong</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/code11.8-1.png" alt=""><p class="caption">plot of chunk code11.8</p>
</div>
<p><em>What do these plots tell us about model assumptions?</em></p>
<p>There is no evidence in these plots of violations of model
assumptions.</p>
</div>
<div class="section level2">
<h2 id="code-box-11-9-diagnosing-convergence-in-a-mcmcglmm-fit">Code Box 11.9: Diagnosing convergence in a MCMCglmm fit<a class="anchor" aria-label="anchor" href="#code-box-11-9-diagnosing-convergence-in-a-mcmcglmm-fit"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">ft_MCMC2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCglmm/man/MCMCglmm.html" class="external-link">MCMCglmm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Alop</span>,<span class="va">Pard</span>,<span class="va">Troc</span><span class="op">)</span><span class="op">~</span><span class="va">trait</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">trait</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">trait</span>,
rcov<span class="op">=</span><span class="op">~</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">units</span>,data<span class="op">=</span><span class="va">spidGeneraWide</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"poisson"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.000286</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 1000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.185036</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 2000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.205036</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 3000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.213000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.229357</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.230929</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 6000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.236750</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 7000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.238821</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.231536</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 9000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.233607</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 10000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.229786</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 11000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.237571</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 12000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.237393</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 13000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.233786</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="va">ft_MCMC3</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCglmm/man/MCMCglmm.html" class="external-link">MCMCglmm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Alop</span>,<span class="va">Pard</span>,<span class="va">Troc</span><span class="op">)</span><span class="op">~</span><span class="va">trait</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">trait</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">trait</span>,
rcov<span class="op">=</span><span class="op">~</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">units</span>,data<span class="op">=</span><span class="va">spidGeneraWide</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"poisson"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.000321</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 1000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.181964</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 2000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.210643</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 3000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.214429</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.236429</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.243071</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 6000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.238143</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 7000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.238464</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.244143</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 9000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.242000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 10000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.235464</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 11000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.238321</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 12000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.245214</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 13000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.238143</span>
<span class="va">whichPlot</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">9</span><span class="op">)</span> <span class="co"># indices of unique variance-covariance parameters</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">whichPlot</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.5</span>,<span class="fl">1.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">iPlot</span> <span class="kw">in</span> <span class="va">whichPlot</span><span class="op">)</span>
<span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot.default</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">iPlot</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lwd<span class="op">=</span><span class="fl">0.3</span>,yaxt<span class="op">=</span><span class="st">"n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ft_MCMC2</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">iPlot</span><span class="op">]</span>,col<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ft_MCMC3</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">iPlot</span><span class="op">]</span>,col<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">)</span><span class="op">[</span><span class="va">iPlot</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="figure">
<img src="figure/code11.9-1.png" alt=""><p class="caption">plot of chunk code11.9</p>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">whichPlot</span><span class="op">]</span>,<span class="va">ft_MCMC2</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">whichPlot</span><span class="op">]</span>,
<span class="va">ft_MCMC3</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">whichPlot</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Potential scale reduction factors:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Point est. Upper C.I.</span>
<span class="co">#&gt; traitAlop:traitAlop.units       1.00       1.00</span>
<span class="co">#&gt; traitPard:traitAlop.units       1.00       1.01</span>
<span class="co">#&gt; traitTroc:traitAlop.units       1.00       1.00</span>
<span class="co">#&gt; traitPard:traitPard.units       1.01       1.02</span>
<span class="co">#&gt; traitTroc:traitPard.units       1.00       1.01</span>
<span class="co">#&gt; traitTroc:traitTroc.units       1.00       1.01</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate psrf</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1.02</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-11-7-non-converging-model-for-petruss-alopecosa-species">Exercise 11.7: Non-converging model for Petrus’s Alopecosa
species<a class="anchor" aria-label="anchor" href="#exercise-11-7-non-converging-model-for-petruss-alopecosa-species"></a>
</h2>
<p><em>Try to fit a hierarchical GLM, along the lines of Code Boxes 11.6
and 11.7, to the three Alopecosa species.</em></p>
<p>First try using <code>glmmTMB</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spider3Wide</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rows<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">28</span>, <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">spider</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="va">spider3Long</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">spider3Wide</span>,id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rows"</span>,<span class="st">"soil.dry"</span>,<span class="st">"moss"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">spider3Long</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"abundance"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spider3Long</span><span class="op">)</span>
<span class="co">#&gt;   rows   soil.dry       moss  species abundance</span>
<span class="co">#&gt; 1    1 -0.1720862  0.6289186 Alopacce        25</span>
<span class="co">#&gt; 2    2  0.7146218 -0.6870394 Alopacce         0</span>
<span class="co">#&gt; 3    3  0.1062154  0.1916410 Alopacce        15</span>
<span class="co">#&gt; 4    4  0.2507444  0.1916410 Alopacce         2</span>
<span class="co">#&gt; 5    5  0.6728333 -1.4299919 Alopacce         1</span>
<span class="co">#&gt; 6    6  1.1247181  0.1916410 Alopacce         0</span>

<span class="va">spid_glmm3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">~</span><span class="va">species</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">species</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">species</span>
   <span class="op">+</span><span class="op">(</span><span class="fl">0</span><span class="op">+</span><span class="va">species</span><span class="op">|</span><span class="va">rows</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"poisson"</span>,data<span class="op">=</span><span class="va">spider3Long</span><span class="op">)</span>
<span class="co">#&gt; Warning in fitTMB(TMBStruc): Model convergence problem; non-positive-definite Hessian matrix. See</span>
<span class="co">#&gt; vignette('troubleshooting')</span>
<span class="co">#&gt; Warning in fitTMB(TMBStruc): Model convergence problem; singular convergence (7). See vignette('troubleshooting')</span></code></pre></div>
<p>Uh oh, non-convergence. Try using <code>MCMCglmm</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">ft_MCMC2</span><span class="op">=</span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCglmm/man/MCMCglmm.html" class="external-link">MCMCglmm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Alopacce</span>,<span class="va">Alopcune</span>,<span class="va">Alopfabr</span><span class="op">)</span><span class="op">~</span><span class="va">trait</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">trait</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">trait</span>,
rcov<span class="op">=</span><span class="op">~</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">units</span>,data<span class="op">=</span><span class="va">spider3Wide</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"poisson"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#this one returns an error</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.000214</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 1000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.182714</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 2000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.018536</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 3000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.009429</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.014821</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.013643</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 6000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.008107</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 7000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.005179</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.007893</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 9000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.003679</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 10000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.002143</span>
<span class="co">#&gt; Error in MCMCglmm(cbind(Alopacce, Alopcune, Alopfabr) ~ trait + soil.dry:trait +  : </span>
<span class="co">#&gt;   ill-conditioned G/R structure (CN = 35410684926832716.000000): use proper priors if you haven't or rescale data if you have</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="va">ft_MCMC</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCglmm/man/MCMCglmm.html" class="external-link">MCMCglmm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Alopacce</span>,<span class="va">Alopcune</span>,<span class="va">Alopfabr</span><span class="op">)</span><span class="op">~</span><span class="va">trait</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">trait</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">trait</span>,
rcov<span class="op">=</span><span class="op">~</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">units</span>,data<span class="op">=</span><span class="va">spider3Wide</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"poisson"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.000250</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 1000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.182607</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 2000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.062679</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 3000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.035679</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.018500</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.011643</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 6000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.009071</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 7000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.004071</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.002714</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 9000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.001750</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 10000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.002179</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 11000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.001571</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 12000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.002036</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 13000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.002321</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="va">ft_MCMC2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCglmm/man/MCMCglmm.html" class="external-link">MCMCglmm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Alopacce</span>,<span class="va">Alopcune</span>,<span class="va">Alopfabr</span><span class="op">)</span><span class="op">~</span><span class="va">trait</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">trait</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">trait</span>,
rcov<span class="op">=</span><span class="op">~</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">units</span>,data<span class="op">=</span><span class="va">spider3Wide</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"poisson"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.000143</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 1000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.237036</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 2000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.054286</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 3000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.045607</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.013393</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.012286</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 6000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.010893</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 7000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.005464</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.004714</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 9000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.003929</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 10000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.002464</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 11000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.002179</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 12000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.003607</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 13000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.002357</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>
<span class="va">ft_MCMC3</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCglmm/man/MCMCglmm.html" class="external-link">MCMCglmm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Alopacce</span>,<span class="va">Alopcune</span>,<span class="va">Alopfabr</span><span class="op">)</span><span class="op">~</span><span class="va">trait</span><span class="op">+</span><span class="va">soil.dry</span><span class="op">:</span><span class="va">trait</span><span class="op">+</span><span class="va">moss</span><span class="op">:</span><span class="va">trait</span>,
rcov<span class="op">=</span><span class="op">~</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">units</span>,data<span class="op">=</span><span class="va">spider3Wide</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"poisson"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.000250</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 1000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.145679</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 2000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.029393</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 3000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.039321</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 4000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.022536</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.004929</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 6000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.004786</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 7000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.006286</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.006536</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 9000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.004929</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 10000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.002000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 11000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.001393</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 12000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.001893</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        MCMC iteration = 13000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Acceptance ratio for liability set 1 = 0.000964</span>
<span class="va">whichPlot</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">9</span><span class="op">)</span> <span class="co"># indices of unique variance-covariance parameters</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">whichPlot</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.5</span>,<span class="fl">1.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">iPlot</span> <span class="kw">in</span> <span class="va">whichPlot</span><span class="op">)</span>
<span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot.default</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">iPlot</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lwd<span class="op">=</span><span class="fl">0.3</span>,yaxt<span class="op">=</span><span class="st">"n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ft_MCMC2</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">iPlot</span><span class="op">]</span>,col<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ft_MCMC3</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">iPlot</span><span class="op">]</span>,col<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">)</span><span class="op">[</span><span class="va">iPlot</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="figure">
<img src="figure/ex11.7mcmc-1.png" alt=""><p class="caption">plot of chunk ex11.7mcmc</p>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="va">ft_MCMC</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">whichPlot</span><span class="op">]</span>,<span class="va">ft_MCMC2</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">whichPlot</span><span class="op">]</span>,
<span class="va">ft_MCMC3</span><span class="op">$</span><span class="va">VCV</span><span class="op">[</span>,<span class="va">whichPlot</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Potential scale reduction factors:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                                   Point est. Upper C.I.</span>
<span class="co">#&gt; traitAlopacce:traitAlopacce.units       1.74       2.97</span>
<span class="co">#&gt; traitAlopcune:traitAlopacce.units       1.31       1.90</span>
<span class="co">#&gt; traitAlopfabr:traitAlopacce.units       2.87       6.04</span>
<span class="co">#&gt; traitAlopcune:traitAlopcune.units       1.45       2.31</span>
<span class="co">#&gt; traitAlopfabr:traitAlopcune.units       2.56       4.96</span>
<span class="co">#&gt; traitAlopfabr:traitAlopfabr.units       3.00       9.29</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate psrf</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 4.53</span></code></pre></div>
<p>Roughly every second run returns an error, but sometimes that doesn’t
happen. You can see issues however from the trace plot, where the
different chains clearly do not mix – you should not be able to
distinguish a trend with colour, but for some parameters, one chain
(colour) has values consistently larger than another so is clearly not
sampling from the same distribution. The Gelman-Rubin statistics are not
close to 1!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
